<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.45">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../versions.html" rel="next">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Library API</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">For Developers (Inference)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Documentation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Modelling Syntax and Interface</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-14-using-turing-quick-start/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quick Start</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-09-using-turing-advanced/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Usage</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Turing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">For Developers (PPL)</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">For Developers (Inference)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../versions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Versions</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/TuringTutorials/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/TuringTutorials/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">For Developers (Inference)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-23.979191554774193</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-23.979191554774193</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([-1.4220193195645854, -1.3705713732058624, 0.4143192774775949]), MALAState{Vector{Float64}}([-1.4220193195645854, -1.3705713732058624, 0.4143192774775949]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -2.262     -3.40984   -2.94371   …  -4.16538   -4.81327   -4.81327
  0.387892  -0.969299   0.614576      0.206143  -0.939222  -0.939222
  1.82459    3.03609    4.27962       4.9912     5.59279    5.59279</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.01101     1.00578
  0.00726126  0.998617
  5.00168     0.991829</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip340">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip340)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip341">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip340)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip342">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip342)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip342)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip342)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip342)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip342)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip340)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip340)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip340)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip340)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip340)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip340)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip340)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip342)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1554.06 2640.76,1554.06 "></polyline>
<polyline clip-path="url(#clip342)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1246.76 2640.76,1246.76 "></polyline>
<polyline clip-path="url(#clip342)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,939.452 2640.76,939.452 "></polyline>
<polyline clip-path="url(#clip342)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,632.147 2640.76,632.147 "></polyline>
<polyline clip-path="url(#clip342)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,324.842 2640.76,324.842 "></polyline>
<polyline clip-path="url(#clip340)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip340)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1554.06 170.644,1554.06 "></polyline>
<polyline clip-path="url(#clip340)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1246.76 170.644,1246.76 "></polyline>
<polyline clip-path="url(#clip340)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,939.452 170.644,939.452 "></polyline>
<polyline clip-path="url(#clip340)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,632.147 170.644,632.147 "></polyline>
<polyline clip-path="url(#clip340)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,324.842 170.644,324.842 "></polyline>
<path clip-path="url(#clip340)" d="M49.5521 1554.51 L79.2279 1554.51 L79.2279 1558.45 L49.5521 1558.45 L49.5521 1554.51 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M99.8991 1552.2 Q96.7509 1552.2 94.8991 1554.35 Q93.0704 1556.5 93.0704 1560.25 Q93.0704 1563.98 94.8991 1566.16 Q96.7509 1568.31 99.8991 1568.31 Q103.047 1568.31 104.876 1566.16 Q106.728 1563.98 106.728 1560.25 Q106.728 1556.5 104.876 1554.35 Q103.047 1552.2 99.8991 1552.2 M109.181 1537.55 L109.181 1541.8 Q107.422 1540.97 105.617 1540.53 Q103.834 1540.09 102.075 1540.09 Q97.4454 1540.09 94.9917 1543.22 Q92.5612 1546.34 92.2139 1552.66 Q93.5797 1550.65 95.6398 1549.58 Q97.7 1548.49 100.177 1548.49 Q105.385 1548.49 108.394 1551.67 Q111.427 1554.81 111.427 1560.25 Q111.427 1565.58 108.279 1568.79 Q105.131 1572.01 99.8991 1572.01 Q93.9037 1572.01 90.7325 1567.43 Q87.5612 1562.82 87.5612 1554.1 Q87.5612 1545.9 91.45 1541.04 Q95.3389 1536.16 101.89 1536.16 Q103.649 1536.16 105.431 1536.5 Q107.237 1536.85 109.181 1537.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M50.3623 1247.21 L80.0381 1247.21 L80.0381 1251.14 L50.3623 1251.14 L50.3623 1247.21 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M104.297 1245.4 Q107.654 1246.12 109.529 1248.39 Q111.427 1250.66 111.427 1253.99 Q111.427 1259.11 107.908 1261.91 Q104.39 1264.71 97.9083 1264.71 Q95.7324 1264.71 93.4176 1264.27 Q91.126 1263.85 88.6723 1262.99 L88.6723 1258.48 Q90.6167 1259.62 92.9315 1260.19 Q95.2463 1260.77 97.7695 1260.77 Q102.168 1260.77 104.459 1259.04 Q106.774 1257.3 106.774 1253.99 Q106.774 1250.93 104.621 1249.22 Q102.492 1247.49 98.6722 1247.49 L94.6445 1247.49 L94.6445 1243.64 L98.8574 1243.64 Q102.306 1243.64 104.135 1242.28 Q105.964 1240.89 105.964 1238.3 Q105.964 1235.63 104.066 1234.22 Q102.191 1232.79 98.6722 1232.79 Q96.7509 1232.79 94.5519 1233.2 Q92.3528 1233.62 89.7139 1234.5 L89.7139 1230.33 Q92.376 1229.59 94.6908 1229.22 Q97.0287 1228.85 99.0889 1228.85 Q104.413 1228.85 107.515 1231.28 Q110.617 1233.69 110.617 1237.81 Q110.617 1240.68 108.973 1242.67 Q107.33 1244.64 104.297 1245.4 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M99.4824 925.25 Q95.8713 925.25 94.0426 928.815 Q92.2371 932.357 92.2371 939.486 Q92.2371 946.593 94.0426 950.158 Q95.8713 953.699 99.4824 953.699 Q103.117 953.699 104.922 950.158 Q106.751 946.593 106.751 939.486 Q106.751 932.357 104.922 928.815 Q103.117 925.25 99.4824 925.25 M99.4824 921.547 Q105.293 921.547 108.348 926.153 Q111.427 930.736 111.427 939.486 Q111.427 948.213 108.348 952.82 Q105.293 957.403 99.4824 957.403 Q93.6723 957.403 90.5936 952.82 Q87.538 948.213 87.538 939.486 Q87.538 930.736 90.5936 926.153 Q93.6723 921.547 99.4824 921.547 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M104.297 630.793 Q107.654 631.51 109.529 633.779 Q111.427 636.047 111.427 639.381 Q111.427 644.496 107.908 647.297 Q104.39 650.098 97.9083 650.098 Q95.7324 650.098 93.4176 649.658 Q91.126 649.242 88.6723 648.385 L88.6723 643.871 Q90.6167 645.006 92.9315 645.584 Q95.2463 646.163 97.7695 646.163 Q102.168 646.163 104.459 644.427 Q106.774 642.691 106.774 639.381 Q106.774 636.325 104.621 634.612 Q102.492 632.876 98.6722 632.876 L94.6445 632.876 L94.6445 629.034 L98.8574 629.034 Q102.306 629.034 104.135 627.668 Q105.964 626.279 105.964 623.686 Q105.964 621.024 104.066 619.612 Q102.191 618.177 98.6722 618.177 Q96.7509 618.177 94.5519 618.594 Q92.3528 619.01 89.7139 619.89 L89.7139 615.723 Q92.376 614.983 94.6908 614.612 Q97.0287 614.242 99.0889 614.242 Q104.413 614.242 107.515 616.673 Q110.617 619.08 110.617 623.2 Q110.617 626.071 108.973 628.061 Q107.33 630.029 104.297 630.793 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip340)" d="M99.8991 322.979 Q96.7509 322.979 94.8991 325.132 Q93.0704 327.284 93.0704 331.034 Q93.0704 334.761 94.8991 336.937 Q96.7509 339.09 99.8991 339.09 Q103.047 339.09 104.876 336.937 Q106.728 334.761 106.728 331.034 Q106.728 327.284 104.876 325.132 Q103.047 322.979 99.8991 322.979 M109.181 308.326 L109.181 312.585 Q107.422 311.752 105.617 311.312 Q103.834 310.872 102.075 310.872 Q97.4454 310.872 94.9917 313.997 Q92.5612 317.122 92.2139 323.442 Q93.5797 321.428 95.6398 320.363 Q97.7 319.275 100.177 319.275 Q105.385 319.275 108.394 322.446 Q111.427 325.595 111.427 331.034 Q111.427 336.358 108.279 339.576 Q105.131 342.794 99.8991 342.794 Q93.9037 342.794 90.7325 338.21 Q87.5612 333.604 87.5612 324.877 Q87.5612 316.683 91.45 311.821 Q95.3389 306.937 101.89 306.937 Q103.649 306.937 105.431 307.284 Q107.237 307.632 109.181 308.326 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip342)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1171.16 224.541,1302.57 226.891,1376.39 229.242,1317.47 231.592,1465.86 233.943,1371.07 236.293,1464.24 238.644,1461.47 240.994,1410.77 243.345,1614.78 245.695,1610.33 248.046,1485.39 250.396,1467.92 252.747,1587.78 255.097,1334.37 257.448,1521.44 259.798,1625.94 262.148,1475.47 264.499,1680.39 266.849,1472.06 269.2,1338.25 271.55,1366.12 273.901,1656.93 276.251,1430.79 278.602,1352.3 280.952,1217.5 283.303,1584.91 285.653,1306.93 288.004,1439.89 290.354,1552.1 292.705,1469.46 295.055,1336.95 297.406,1507.1 299.756,1448.46 302.107,1338.01 304.457,1416.81 306.807,1619.7 309.158,1514.76 311.508,1501.6 313.859,1360.12 316.209,1404.17 318.56,1202.98 320.91,1552.59 323.261,1260.58 325.611,1441.69 327.962,1488.64 330.312,1272.85 332.663,1299.94 335.013,1566.99 337.364,1473.15 339.714,1527.24 342.065,1691.07 344.415,1402.49 346.765,1419.04 349.116,1437.09 351.466,1481.2 353.817,1257.98 356.167,1449.62 358.518,1330.63 360.868,1626.72 363.219,1258.77 365.569,1470.69 367.92,1506.66 370.27,1411.9 372.621,1449.27 374.971,1379.08 377.322,1407.32 379.672,1515.49 382.023,1577.91 384.373,1325.24 386.724,1453.59 389.074,1440.71 391.424,1367.99 393.775,1436.68 396.125,1346.16 398.476,1356.26 400.826,1434.54 403.177,1525.12 405.527,1602.3 407.878,1376.69 410.228,1415.01 412.579,1509.06 414.929,1429.22 417.28,1260.66 419.63,1523.31 421.981,1405.55 424.331,1388.05 426.682,1383.82 429.032,1281.86 431.382,1408.02 433.733,1291.17 436.083,1494.01 438.434,1512.5 440.784,1489.07 443.135,1225.08 445.485,1505.52 447.836,1558.29 450.186,1607 452.537,1388.96 454.887,1492.26 457.238,1533.6 459.588,1345.4 461.939,1427.59 464.289,1702.19 466.64,1527.49 468.99,1443.08 471.341,1199.94 473.691,1381.66 476.041,1452.43 478.392,1401.04 480.742,1366.85 483.093,1409.16 485.443,1513.49 487.794,1443.8 490.144,1278.98 492.495,1694.78 494.845,1617.83 497.196,1345.96 499.546,1568.51 501.897,1243.19 504.247,1404.82 506.598,1517.66 508.948,1516.4 511.299,1288.51 513.649,1458.8 515.999,1432.8 518.35,1430.56 520.7,1561.24 523.051,1546.02 525.401,1449.14 527.752,1460.55 530.102,1560.08 532.453,1515.4 534.803,1563.06 537.154,1474.02 539.504,1536.3 541.855,1434.52 544.205,1422.06 546.556,1564.54 548.906,1550.78 551.257,1599.87 553.607,1521.5 555.958,1503.87 558.308,1431.26 560.658,1432.65 563.009,1528.82 565.359,1420.28 567.71,1477.39 570.06,1548.8 572.411,1438.93 574.761,1425.33 577.112,1387.57 579.462,1296.56 581.813,1614.17 584.163,1327.22 586.514,1533.94 588.864,1355.45 591.215,1436.24 593.565,1372.9 595.916,1371.14 598.266,1374.61 600.616,1264.08 602.967,1410.93 605.317,1360.59 607.668,1591.45 610.018,1414.41 612.369,1629.61 614.719,1592.07 617.07,1422.59 619.42,1409.12 621.771,1643.13 624.121,1406.17 626.472,1300.74 628.822,1648.32 631.173,1418.55 633.523,1260.02 635.874,1447.21 638.224,1413.31 640.575,1450.51 642.925,1549.81 645.275,1291.48 647.626,1350.3 649.976,1335.16 652.327,1484.14 654.677,1514.9 657.028,1360.02 659.378,1434.46 661.729,1385.6 664.079,1338.06 666.43,1541.02 668.78,1396.84 671.131,1412.34 673.481,1534.06 675.832,1241.97 678.182,1367.3 680.533,1405.5 682.883,1583.91 685.233,1475.63 687.584,1268.97 689.934,1362.94 692.285,1594.24 694.635,1375.1 696.986,1620.56 699.336,1588.86 701.687,1517.49 704.037,1582.28 706.388,1530.81 708.738,1592.11 711.089,1398.18 713.439,1488.53 715.79,1430.58 718.14,1398.71 720.491,1366.69 722.841,1600.7 725.192,1429.54 727.542,1471.46 729.892,1283.97 732.243,1520.57 734.593,1590.82 736.944,1569.97 739.294,1334.88 741.645,1480.66 743.995,1660.63 746.346,1566.22 748.696,1329.23 751.047,1538.39 753.397,1269.21 755.748,1443.93 758.098,1454.75 760.449,1441.61 762.799,1419.14 765.15,1430.45 767.5,1342.08 769.85,1494.24 772.201,1448.16 774.551,1405.89 776.902,1460.53 779.252,1447.17 781.603,1502.9 783.953,1341.05 786.304,1700.19 788.654,1615.66 791.005,1502.71 793.355,1435.7 795.706,1529.83 798.056,1496.88 800.407,1378.24 802.757,1515.1 805.108,1599.97 807.458,1662.54 809.809,1479.49 812.159,1490.38 814.509,1512.67 816.86,1366.34 819.21,1346.01 821.561,1474.16 823.911,1595.63 826.262,1392.3 828.612,1409.12 830.963,1471.5 833.313,1352.56 835.664,1603.83 838.014,1565.92 840.365,1518.22 842.715,1452.55 845.066,1275.87 847.416,1467.35 849.767,1367.17 852.117,1436.86 854.467,1301.16 856.818,1380.14 859.168,1413.48 861.519,1240.61 863.869,1415.68 866.22,1635.53 868.57,1373.9 870.921,1388.05 873.271,1394.11 875.622,1342.59 877.972,1423.11 880.323,1352.24 882.673,1368.69 885.024,1420.77 887.374,1382.37 889.725,1729.57 892.075,1565.24 894.426,1577.4 896.776,1313.74 899.126,1552.17 901.477,1493.3 903.827,1555.15 906.178,1498.59 908.528,1491.19 910.879,1348.11 913.229,1528.55 915.58,1165.6 917.93,1508.78 920.281,1501.56 922.631,1569.31 924.982,1392.82 927.332,1543.1 929.683,1499.75 932.033,1496.87 934.384,1513.51 936.734,1464.22 939.084,1435.93 941.435,1579.9 943.785,1529.97 946.136,1380.63 948.486,1454.64 950.837,1476.95 953.187,1408.89 955.538,1404.74 957.888,1524.88 960.239,1488.01 962.589,1535.29 964.94,1501.77 967.29,1454.17 969.641,1584.19 971.991,1487.9 974.342,1298.64 976.692,1436.18 979.043,1596.78 981.393,1460.58 983.743,1399.2 986.094,1411.34 988.444,1569.71 990.795,1475.62 993.145,1478.65 995.496,1433.7 997.846,1531.52 1000.2,1496.06 1002.55,1529.66 1004.9,1461.41 1007.25,1497.22 1009.6,1489.95 1011.95,1543.91 1014.3,1373.43 1016.65,1281.15 1019,1414.88 1021.35,1419.91 1023.7,1689.68 1026.05,1398.96 1028.4,1252.44 1030.75,1464.69 1033.1,1342.79 1035.45,1508.23 1037.8,1531.89 1040.15,1488.6 1042.51,1751.15 1044.86,1550.3 1047.21,1258.15 1049.56,1548.35 1051.91,1382.65 1054.26,1236.94 1056.61,1239.94 1058.96,1634.8 1061.31,1449.58 1063.66,1464.85 1066.01,1555.79 1068.36,1600.65 1070.71,1468.69 1073.06,1354.49 1075.41,1678.81 1077.76,1397.33 1080.11,1395.72 1082.46,1436.37 1084.81,1424 1087.16,1435.5 1089.51,1472.05 1091.87,1301.55 1094.22,1455.23 1096.57,1489.08 1098.92,1338.13 1101.27,1569.38 1103.62,1390.29 1105.97,1448.73 1108.32,1342.77 1110.67,1506.36 1113.02,1410.49 1115.37,1488.55 1117.72,1330.5 1120.07,1557.81 1122.42,1686.99 1124.77,1499.55 1127.12,1417.77 1129.47,1506.74 1131.82,1431.56 1134.17,1430.37 1136.52,1490.73 1138.87,1476.69 1141.23,1609.24 1143.58,1569.52 1145.93,1559.38 1148.28,1369.31 1150.63,1452.71 1152.98,1396.63 1155.33,1412.1 1157.68,1374.89 1160.03,1478.27 1162.38,1475.18 1164.73,1542.48 1167.08,1419.42 1169.43,1280.58 1171.78,1532.8 1174.13,1554.11 1176.48,1299 1178.83,1420.05 1181.18,1411.2 1183.53,1378.28 1185.88,1415.62 1188.23,1297.62 1190.59,1520.26 1192.94,1443.31 1195.29,1445.81 1197.64,1562.33 1199.99,1476.37 1202.34,1474.38 1204.69,1514.55 1207.04,1589.2 1209.39,1411.37 1211.74,1416.15 1214.09,1568.24 1216.44,1350.12 1218.79,1424.12 1221.14,1528.22 1223.49,1442.15 1225.84,1498.2 1228.19,1487.68 1230.54,1322.11 1232.89,1489.67 1235.24,1468.75 1237.59,1537.76 1239.94,1362.5 1242.3,1356.14 1244.65,1226.15 1247,1338.77 1249.35,1585.73 1251.7,1305.37 1254.05,1276.75 1256.4,1377.64 1258.75,1428.22 1261.1,1495.87 1263.45,1457.94 1265.8,1387.93 1268.15,1304.94 1270.5,1397.28 1272.85,1375.76 1275.2,1493.26 1277.55,1398.8 1279.9,1378.11 1282.25,1447.84 1284.6,1503.97 1286.95,1494.11 1289.3,1674.24 1291.66,1452.58 1294.01,1588.95 1296.36,1606.07 1298.71,1467.11 1301.06,1372.54 1303.41,1536.67 1305.76,1400.4 1308.11,1479.12 1310.46,1569.1 1312.81,1511.85 1315.16,1491.1 1317.51,1405.92 1319.86,1281.49 1322.21,1312.39 1324.56,1438.64 1326.91,1632.61 1329.26,1438.56 1331.61,1484.22 1333.96,1356.98 1336.31,1524.9 1338.66,1429.35 1341.02,1278.73 1343.37,1305.21 1345.72,1364.06 1348.07,1503.38 1350.42,1361.2 1352.77,1519.05 1355.12,1522.13 1357.47,1497.85 1359.82,1588.9 1362.17,1431.98 1364.52,1409.99 1366.87,1444.15 1369.22,1513.09 1371.57,1499.69 1373.92,1492.1 1376.27,1488.84 1378.62,1376.17 1380.97,1249.57 1383.32,1315.25 1385.67,1362.78 1388.02,1338.21 1390.38,1515.02 1392.73,1415.19 1395.08,1540.27 1397.43,1504.22 1399.78,1563.43 1402.13,1634.9 1404.48,1430.78 1406.83,1476.49 1409.18,1509.16 1411.53,1411.37 1413.88,1648.42 1416.23,1457.68 1418.58,1500.78 1420.93,1509.17 1423.28,1685.52 1425.63,1451.81 1427.98,1281.66 1430.33,1414.14 1432.68,1390.97 1435.03,1594.11 1437.38,1287.64 1439.74,1449.18 1442.09,1380.53 1444.44,1490.02 1446.79,1399.98 1449.14,1471.86 1451.49,1505.42 1453.84,1391.51 1456.19,1410.12 1458.54,1248.47 1460.89,1277.79 1463.24,1464.95 1465.59,1529.32 1467.94,1560.79 1470.29,1393.03 1472.64,1420.31 1474.99,1367.54 1477.34,1400.7 1479.69,1478 1482.04,1462.63 1484.39,1594.67 1486.74,1363.99 1489.1,1486.05 1491.45,1420.78 1493.8,1348.87 1496.15,1585.79 1498.5,1486.42 1500.85,1493.06 1503.2,1354.36 1505.55,1498.56 1507.9,1351.33 1510.25,1366.58 1512.6,1359.07 1514.95,1347.61 1517.3,1491.96 1519.65,1476.56 1522,1577.79 1524.35,1579.66 1526.7,1313.18 1529.05,1575.93 1531.4,1408.44 1533.75,1555.15 1536.1,1322.16 1538.45,1335.09 1540.81,1373.72 1543.16,1527 1545.51,1398.67 1547.86,1434.27 1550.21,1381.9 1552.56,1386.67 1554.91,1589.78 1557.26,1428.21 1559.61,1302.85 1561.96,1356.05 1564.31,1337.64 1566.66,1385.59 1569.01,1468.9 1571.36,1632.28 1573.71,1426.81 1576.06,1436.84 1578.41,1391.27 1580.76,1516.91 1583.11,1455.99 1585.46,1322.12 1587.81,1564.36 1590.17,1596.03 1592.52,1481.02 1594.87,1382.6 1597.22,1463.06 1599.57,1423.86 1601.92,1464.87 1604.27,1554.69 1606.62,1358.28 1608.97,1247.94 1611.32,1504.84 1613.67,1507.69 1616.02,1483.97 1618.37,1361.03 1620.72,1513.81 1623.07,1419.1 1625.42,1423.8 1627.77,1632.66 1630.12,1435.68 1632.47,1346.85 1634.82,1486.77 1637.17,1440.7 1639.53,1365.14 1641.88,1343.3 1644.23,1640.39 1646.58,1667.83 1648.93,1314.26 1651.28,1353.65 1653.63,1485.32 1655.98,1437.78 1658.33,1504.93 1660.68,1588.99 1663.03,1446.74 1665.38,1488.45 1667.73,1359.6 1670.08,1428.57 1672.43,1361.64 1674.78,1633.97 1677.13,1659.73 1679.48,1387.51 1681.83,1295.96 1684.18,1388.26 1686.53,1317.19 1688.89,1503.84 1691.24,1546.44 1693.59,1513.95 1695.94,1558.64 1698.29,1312.19 1700.64,1449.52 1702.99,1369.8 1705.34,1352.91 1707.69,1675.6 1710.04,1340.92 1712.39,1456.76 1714.74,1211.4 1717.09,1489.29 1719.44,1706.48 1721.79,1181.22 1724.14,1519.59 1726.49,1206.03 1728.84,1431.9 1731.19,1411.12 1733.54,1455.86 1735.89,1335.51 1738.25,1419.85 1740.6,1495.99 1742.95,1509.12 1745.3,1411.78 1747.65,1423.05 1750,1378.73 1752.35,1629.48 1754.7,1496.4 1757.05,1609.14 1759.4,1626.32 1761.75,1517.64 1764.1,1561.75 1766.45,1499.44 1768.8,1500.8 1771.15,1499.03 1773.5,1410.46 1775.85,1364.66 1778.2,1520.49 1780.55,1488.51 1782.9,1387.65 1785.25,1504.29 1787.6,1482.79 1789.96,1380.29 1792.31,1411.3 1794.66,1366.79 1797.01,1421.87 1799.36,1426.86 1801.71,1456.7 1804.06,1521.58 1806.41,1403.53 1808.76,1413.76 1811.11,1440.93 1813.46,1424.3 1815.81,1403.02 1818.16,1362.94 1820.51,1326.05 1822.86,1608.13 1825.21,1508.55 1827.56,1429.78 1829.91,1438.78 1832.26,1566.21 1834.61,1435.3 1836.96,1683.83 1839.32,1313.21 1841.67,1520.03 1844.02,1468.01 1846.37,1265.86 1848.72,1525.02 1851.07,1545.18 1853.42,1468.14 1855.77,1477.14 1858.12,1420.84 1860.47,1436.5 1862.82,1243.81 1865.17,1468.65 1867.52,1326.68 1869.87,1457.35 1872.22,1471.43 1874.57,1500.09 1876.92,1423.77 1879.27,1634.15 1881.62,1328.47 1883.97,1450.64 1886.32,1491.95 1888.68,1685.33 1891.03,1397.99 1893.38,1509 1895.73,1392.05 1898.08,1538.66 1900.43,1539.91 1902.78,1491.08 1905.13,1488.05 1907.48,1386.19 1909.83,1295.82 1912.18,1234.55 1914.53,1530.31 1916.88,1395.21 1919.23,1524.99 1921.58,1492.11 1923.93,1400.05 1926.28,1397.98 1928.63,1324.27 1930.98,1735.06 1933.33,1392.43 1935.68,1434.51 1938.04,1468.86 1940.39,1611.02 1942.74,1422.62 1945.09,1628.88 1947.44,1353.3 1949.79,1501.53 1952.14,1316.24 1954.49,1534.42 1956.84,1328.71 1959.19,1314.11 1961.54,1216.75 1963.89,1575.16 1966.24,1645.07 1968.59,1613.33 1970.94,1476.38 1973.29,1469.71 1975.64,1441.25 1977.99,1622.89 1980.34,1586.63 1982.69,1452.06 1985.04,1567.99 1987.4,1433.95 1989.75,1581.76 1992.1,1537.28 1994.45,1348.49 1996.8,1424.75 1999.15,1371.61 2001.5,1397.25 2003.85,1409.15 2006.2,1437.48 2008.55,1374.59 2010.9,1320.02 2013.25,1573.4 2015.6,1441.49 2017.95,1445.28 2020.3,1429.59 2022.65,1568.53 2025,1516.93 2027.35,1416.2 2029.7,1498.15 2032.05,1486.69 2034.4,1543.32 2036.76,1206.45 2039.11,1496.24 2041.46,1543.95 2043.81,1344.24 2046.16,1449.76 2048.51,1293.64 2050.86,1347.67 2053.21,1555.23 2055.56,1639.83 2057.91,1476.95 2060.26,1489.32 2062.61,1332.67 2064.96,1424.31 2067.31,1546.17 2069.66,1444.52 2072.01,1509.17 2074.36,1482.48 2076.71,1437.28 2079.06,1382.33 2081.41,1626.64 2083.76,1628.58 2086.11,1517.94 2088.47,1428.54 2090.82,1261.57 2093.17,1472.59 2095.52,1383.08 2097.87,1375.68 2100.22,1486.82 2102.57,1465.41 2104.92,1525 2107.27,1606.02 2109.62,1415.57 2111.97,1368.85 2114.32,1380.37 2116.67,1393.63 2119.02,1621.53 2121.37,1423.79 2123.72,1375.24 2126.07,1451.06 2128.42,1430.01 2130.77,1519.26 2133.12,1460.2 2135.47,1332.39 2137.83,1421.92 2140.18,1434.86 2142.53,1701.45 2144.88,1493.91 2147.23,1396.78 2149.58,1563.83 2151.93,1540 2154.28,1626.04 2156.63,1415.77 2158.98,1503.73 2161.33,1317.29 2163.68,1374.73 2166.03,1668.66 2168.38,1483.76 2170.73,1606.58 2173.08,1483.59 2175.43,1503.97 2177.78,1523.64 2180.13,1439.58 2182.48,1496.5 2184.83,1599.4 2187.19,1662.86 2189.54,1416.33 2191.89,1343.99 2194.24,1410.48 2196.59,1609.27 2198.94,1320.43 2201.29,1517.83 2203.64,1321.46 2205.99,1351.93 2208.34,1459.91 2210.69,1565.6 2213.04,1384.37 2215.39,1569.92 2217.74,1399.6 2220.09,1346.91 2222.44,1489.19 2224.79,1426.79 2227.14,1401.43 2229.49,1312.11 2231.84,1504.6 2234.19,1342.59 2236.55,1559.46 2238.9,1461.31 2241.25,1595 2243.6,1278.23 2245.95,1357.51 2248.3,1428.73 2250.65,1453.14 2253,1404.68 2255.35,1471.11 2257.7,1527.6 2260.05,1419.76 2262.4,1387.19 2264.75,1377.07 2267.1,1395 2269.45,1397.79 2271.8,1484.45 2274.15,1600.03 2276.5,1586.9 2278.85,1423.13 2281.2,1298.81 2283.55,1436.85 2285.91,1479.48 2288.26,1363.65 2290.61,1356.02 2292.96,1579.22 2295.31,1472.38 2297.66,1405.42 2300.01,1598.75 2302.36,1480.38 2304.71,1506.98 2307.06,1370.56 2309.41,1386.56 2311.76,1516 2314.11,1571.63 2316.46,1519.97 2318.81,1398.05 2321.16,1467.86 2323.51,1373.43 2325.86,1415.37 2328.21,1348.86 2330.56,1463.26 2332.91,1383.73 2335.27,1460.51 2337.62,1396.18 2339.97,1530.68 2342.32,1525.61 2344.67,1392.2 2347.02,1258.06 2349.37,1469.47 2351.72,1480.52 2354.07,1422.78 2356.42,1607.04 2358.77,1607.49 2361.12,1463.82 2363.47,1326.21 2365.82,1435.32 2368.17,1511.93 2370.52,1481.41 2372.87,1439.18 2375.22,1364.31 2377.57,1381.41 2379.92,1498.91 2382.27,1646.27 2384.62,1374.72 2386.98,1424.51 2389.33,1670.65 2391.68,1509.69 2394.03,1427.32 2396.38,1337.02 2398.73,1336.76 2401.08,1472.11 2403.43,1376.11 2405.78,1373.18 2408.13,1403.99 2410.48,1389.18 2412.83,1507.9 2415.18,1586.39 2417.53,1467 2419.88,1451.78 2422.23,1623.96 2424.58,1511.25 2426.93,1433.37 2429.28,1456.17 2431.63,1533.39 2433.98,1519.06 2436.34,1346.81 2438.69,1229.72 2441.04,1556.86 2443.39,1311.03 2445.74,1453.03 2448.09,1320.7 2450.44,1611.33 2452.79,1326.49 2455.14,1512.16 2457.49,1460.29 2459.84,1422.96 2462.19,1432.11 2464.54,1420.6 2466.89,1349.07 2469.24,1598.79 2471.59,1264.71 2473.94,1639.28 2476.29,1447.97 2478.64,1408.25 2480.99,1539.49 2483.34,1543.38 2485.7,1499.28 2488.05,1595.09 2490.4,1550.34 2492.75,1628 2495.1,1445.52 2497.45,1452.37 2499.8,1404.55 2502.15,1559.29 2504.5,1515.06 2506.85,1552.49 2509.2,1411.37 2511.55,1527.57 2513.9,1533.66 2516.25,1515.73 2518.6,1516.06 2520.95,1435.15 2523.3,1541.57 2525.65,1456.42 2528,1454.79 2530.35,1471.44 2532.7,1530.87 2535.06,1382.4 2537.41,1423.69 2539.76,1325.37 2542.11,1567.26 2544.46,1475.99 2546.81,1251.01 2549.16,1399.52 2551.51,1305.82 2553.86,1438.25 2556.21,1590.42 2558.56,1488.68 2560.91,1456.63 2563.26,1549.36 2565.61,1535.45 2567.96,1598.5 2570.31,1641.95 "></polyline>
<polyline clip-path="url(#clip342)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,899.718 224.541,964.606 226.891,1030.12 229.242,875.62 231.592,789.743 233.943,1061.67 236.293,949.945 238.644,878.711 240.994,666.866 243.345,903.073 245.695,1056.55 248.046,1063.89 250.396,861.642 252.747,1000.78 255.097,855.194 257.448,974.45 259.798,1175.93 262.148,988.677 264.499,947.657 266.849,904.947 269.2,959.231 271.55,880.415 273.901,977.585 276.251,827.879 278.602,938.6 280.952,1058.55 283.303,1079.3 285.653,937.505 288.004,809.412 290.354,895.124 292.705,810.492 295.055,803.094 297.406,1062.85 299.756,926.821 302.107,1076.95 304.457,944.456 306.807,857.569 309.158,940.356 311.508,808.346 313.859,1166.13 316.209,1017.57 318.56,859.334 320.91,973.912 323.261,997.124 325.611,950.861 327.962,996.888 330.312,1025.21 332.663,903.308 335.013,1012.39 337.364,811.56 339.714,720.914 342.065,968.03 344.415,551.019 346.765,1037.59 349.116,881.793 351.466,939.706 353.817,1057.41 356.167,866.664 358.518,1055.04 360.868,893.696 363.219,1050.29 365.569,829.43 367.92,897.71 370.27,1086.14 372.621,1250.09 374.971,888.865 377.322,872.639 379.672,844.536 382.023,1031.5 384.373,898.504 386.724,883.805 389.074,871.9 391.424,887.214 393.775,1009.6 396.125,960.79 398.476,1005.23 400.826,986.315 403.177,805.289 405.527,1044.09 407.878,794.567 410.228,971.01 412.579,837.643 414.929,914.926 417.28,863.296 419.63,919.578 421.981,1152.44 424.331,960.136 426.682,866.196 429.032,959.77 431.382,986.841 433.733,989.779 436.083,939.044 438.434,907.769 440.784,926.139 443.135,757.392 445.485,1057.93 447.836,862.467 450.186,895.795 452.537,951.86 454.887,1098.65 457.238,1052.82 459.588,1144.66 461.939,673.702 464.289,857.042 466.64,826.472 468.99,845.293 471.341,933.426 473.691,1075.22 476.041,996.36 478.392,1025.51 480.742,1192.62 483.093,1089.5 485.443,823.406 487.794,828.88 490.144,893.02 492.495,940.4 494.845,1062.29 497.196,761.405 499.546,747.071 501.897,1009.74 504.247,1088.45 506.598,992.996 508.948,865.891 511.299,1048.17 513.649,892.685 515.999,1086.53 518.35,868.541 520.7,805.926 523.051,850.667 525.401,907.491 527.752,966.131 530.102,761.187 532.453,984.809 534.803,957.36 537.154,843.081 539.504,904.876 541.855,953.363 544.205,858.907 546.556,910.744 548.906,894.012 551.257,1022.12 553.607,994.196 555.958,910.679 558.308,962.697 560.658,983.589 563.009,926.832 565.359,970.545 567.71,989.193 570.06,795.886 572.411,761.625 574.761,817.539 577.112,943.258 579.462,1039.39 581.813,951.169 584.163,1116.33 586.514,871.105 588.864,826.345 591.215,1133.43 593.565,981.438 595.916,773.179 598.266,925.741 600.616,1164.43 602.967,751.782 605.317,916.769 607.668,794.167 610.018,1005.71 612.369,938.326 614.719,975.509 617.07,961.927 619.42,957.73 621.771,1125.51 624.121,1002.37 626.472,933.212 628.822,956.328 631.173,1008.22 633.523,989.15 635.874,923.284 638.224,910.233 640.575,790.963 642.925,982.148 645.275,930.858 647.626,773.185 649.976,886.456 652.327,992.027 654.677,983.687 657.028,907.715 659.378,1138.13 661.729,874.092 664.079,1115.76 666.43,1047.2 668.78,886.47 671.131,914.757 673.481,992.148 675.832,929.75 678.182,968.756 680.533,968.908 682.883,776.867 685.233,877.006 687.584,1053.92 689.934,1077.14 692.285,968.289 694.635,886.164 696.986,924.976 699.336,985.05 701.687,888.086 704.037,1179.52 706.388,1111.43 708.738,972.452 711.089,746.557 713.439,876.032 715.79,979.746 718.14,1124.86 720.491,822.455 722.841,964.063 725.192,972.406 727.542,1155.34 729.892,849.697 732.243,1121.17 734.593,864.202 736.944,954.094 739.294,1000.75 741.645,879.336 743.995,876.963 746.346,870.905 748.696,668.445 751.047,977.331 753.397,1027.53 755.748,885.16 758.098,1176.35 760.449,983.891 762.799,843.194 765.15,869.682 767.5,932.267 769.85,917.324 772.201,1146.63 774.551,861.02 776.902,919.226 779.252,973.935 781.603,912.859 783.953,923.821 786.304,886.572 788.654,1125.09 791.005,1069.72 793.355,1029.9 795.706,884.175 798.056,994.619 800.407,1173.07 802.757,1000.41 805.108,878.163 807.458,1015.29 809.809,932.87 812.159,1118.57 814.509,904.982 816.86,957.59 819.21,1066.31 821.561,1015.37 823.911,854.645 826.262,932.04 828.612,844.345 830.963,1055.05 833.313,1040.92 835.664,755.711 838.014,908.518 840.365,921.412 842.715,985.7 845.066,1026.66 847.416,848.572 849.767,781.34 852.117,863.134 854.467,884.059 856.818,919.983 859.168,748.328 861.519,1008.67 863.869,947.731 866.22,695.1 868.57,1002.15 870.921,1030.55 873.271,925.426 875.622,1074.84 877.972,980.34 880.323,1041.15 882.673,1084.33 885.024,1064.71 887.374,1006.72 889.725,888.134 892.075,825.245 894.426,864.012 896.776,881.63 899.126,755.126 901.477,882.604 903.827,872.239 906.178,767.022 908.528,942.304 910.879,976.731 913.229,1051.49 915.58,854.207 917.93,930.196 920.281,860.433 922.631,1012.51 924.982,1035.19 927.332,969.772 929.683,983.97 932.033,1028.19 934.384,775.096 936.734,964.818 939.084,870.709 941.435,926.103 943.785,1123.95 946.136,965.304 948.486,819.444 950.837,873.493 953.187,1176.86 955.538,874.979 957.888,851.738 960.239,968.592 962.589,855.476 964.94,863.131 967.29,953.396 969.641,897.553 971.991,943.002 974.342,981.872 976.692,941.856 979.043,892.35 981.393,872.83 983.743,1019.57 986.094,860.347 988.444,1056.08 990.795,907.342 993.145,907.03 995.496,1062.21 997.846,690.978 1000.2,770.091 1002.55,1046.63 1004.9,964.811 1007.25,962.59 1009.6,1047.13 1011.95,868.391 1014.3,1060.61 1016.65,953.402 1019,682.825 1021.35,1109.15 1023.7,1079.95 1026.05,929.21 1028.4,1077.06 1030.75,1059.91 1033.1,987.054 1035.45,888.94 1037.8,832.84 1040.15,1032.85 1042.51,833.689 1044.86,1025.19 1047.21,1031.22 1049.56,930.791 1051.91,880.582 1054.26,1030.35 1056.61,857.039 1058.96,981.909 1061.31,1040.87 1063.66,825.532 1066.01,922.409 1068.36,1018.07 1070.71,1013.87 1073.06,949.745 1075.41,958.401 1077.76,971.612 1080.11,994.069 1082.46,702.341 1084.81,941.093 1087.16,992.331 1089.51,991.014 1091.87,1044.5 1094.22,1115.25 1096.57,936.295 1098.92,974.346 1101.27,1025.47 1103.62,992.385 1105.97,933.784 1108.32,993.665 1110.67,1072.29 1113.02,862.861 1115.37,853.238 1117.72,981.353 1120.07,920.854 1122.42,1016.8 1124.77,755.151 1127.12,786.541 1129.47,1045.38 1131.82,904.97 1134.17,841.254 1136.52,951.466 1138.87,776.462 1141.23,878.924 1143.58,1067.22 1145.93,1009.22 1148.28,763.233 1150.63,741.782 1152.98,1080.4 1155.33,955.437 1157.68,845.716 1160.03,1077.81 1162.38,918.492 1164.73,1170.97 1167.08,1050.68 1169.43,1016.16 1171.78,888.591 1174.13,789.56 1176.48,883.482 1178.83,777.891 1181.18,899.35 1183.53,1081.39 1185.88,882.759 1188.23,819.219 1190.59,902.909 1192.94,976.966 1195.29,977.761 1197.64,1135.16 1199.99,965.264 1202.34,954.292 1204.69,946.134 1207.04,936.467 1209.39,890.42 1211.74,859.048 1214.09,835.718 1216.44,1010.63 1218.79,862.917 1221.14,825.25 1223.49,860.304 1225.84,736.924 1228.19,1018.39 1230.54,1024.97 1232.89,938.397 1235.24,788.926 1237.59,684.482 1239.94,1041.75 1242.3,1102.02 1244.65,793.69 1247,893.731 1249.35,972.182 1251.7,874.337 1254.05,855.272 1256.4,925.197 1258.75,1099.56 1261.1,953.146 1263.45,900.328 1265.8,1156.34 1268.15,864.301 1270.5,853.115 1272.85,1072.86 1275.2,1010.39 1277.55,975.062 1279.9,844.744 1282.25,1019.16 1284.6,858.385 1286.95,852.617 1289.3,933.959 1291.66,876.45 1294.01,865.292 1296.36,789.357 1298.71,1055.67 1301.06,1006.16 1303.41,897.911 1305.76,1107.54 1308.11,925.076 1310.46,1097.5 1312.81,976.486 1315.16,998.632 1317.51,1163.5 1319.86,1109.03 1322.21,1079.55 1324.56,1042.82 1326.91,929.914 1329.26,768.23 1331.61,964.591 1333.96,980.974 1336.31,881.176 1338.66,1046.89 1341.02,661.1 1343.37,929.286 1345.72,888.23 1348.07,822.961 1350.42,802.313 1352.77,968.258 1355.12,836.626 1357.47,1026.71 1359.82,1005.29 1362.17,1115.61 1364.52,909.502 1366.87,1038.94 1369.22,763.435 1371.57,949.197 1373.92,879.682 1376.27,964.599 1378.62,896.119 1380.97,968.797 1383.32,1006.4 1385.67,917.765 1388.02,931.676 1390.38,964.819 1392.73,863.729 1395.08,886.916 1397.43,807.133 1399.78,948.536 1402.13,984.091 1404.48,829.569 1406.83,757.025 1409.18,899.706 1411.53,945.626 1413.88,791.15 1416.23,932.125 1418.58,1072.2 1420.93,1100.14 1423.28,1157.49 1425.63,796.402 1427.98,1036.17 1430.33,722.295 1432.68,762.21 1435.03,708.553 1437.38,902.432 1439.74,766.946 1442.09,1057.24 1444.44,1004.45 1446.79,839.2 1449.14,899.608 1451.49,1050.45 1453.84,920.185 1456.19,980.53 1458.54,860.704 1460.89,1065.73 1463.24,1007.76 1465.59,801.841 1467.94,959.88 1470.29,853.808 1472.64,829.381 1474.99,1024.83 1477.34,968.16 1479.69,950.975 1482.04,897.638 1484.39,939.818 1486.74,1014.72 1489.1,1009.62 1491.45,987.806 1493.8,943.575 1496.15,1084.06 1498.5,873.594 1500.85,864.891 1503.2,814.658 1505.55,1109.77 1507.9,912.301 1510.25,824.195 1512.6,925.313 1514.95,829.312 1517.3,889.318 1519.65,954.791 1522,747.047 1524.35,1060.84 1526.7,987.067 1529.05,1006.11 1531.4,891.813 1533.75,974.285 1536.1,691.003 1538.45,949.562 1540.81,938.436 1543.16,847.095 1545.51,953.193 1547.86,935.296 1550.21,1077.75 1552.56,850.848 1554.91,821.622 1557.26,1023.9 1559.61,963.505 1561.96,995.731 1564.31,744.057 1566.66,819.256 1569.01,1008.77 1571.36,935.981 1573.71,774.859 1576.06,1016.86 1578.41,905.538 1580.76,797.326 1583.11,1127.02 1585.46,879.892 1587.81,842.723 1590.17,921.494 1592.52,878.193 1594.87,929.914 1597.22,927.378 1599.57,864.156 1601.92,790.344 1604.27,905.04 1606.62,999.647 1608.97,968.064 1611.32,1054.91 1613.67,1026.75 1616.02,762.842 1618.37,812.094 1620.72,966.959 1623.07,744.955 1625.42,1065.91 1627.77,1050.78 1630.12,858.189 1632.47,795.916 1634.82,740.415 1637.17,1012.95 1639.53,811.552 1641.88,724.665 1644.23,1007.13 1646.58,894.356 1648.93,967.547 1651.28,686.345 1653.63,895.316 1655.98,841.206 1658.33,1034.07 1660.68,881.429 1663.03,844.988 1665.38,1056.71 1667.73,941.093 1670.08,884.275 1672.43,1211.16 1674.78,1037.58 1677.13,884.807 1679.48,835.661 1681.83,1053.48 1684.18,953.297 1686.53,1157.29 1688.89,916.429 1691.24,1033.71 1693.59,729.64 1695.94,867.593 1698.29,901.756 1700.64,897.68 1702.99,1012.07 1705.34,886.174 1707.69,779.738 1710.04,820.523 1712.39,818.838 1714.74,1064.94 1717.09,913.685 1719.44,906.58 1721.79,1061.74 1724.14,987.287 1726.49,873.042 1728.84,970.501 1731.19,966.134 1733.54,999.241 1735.89,805.036 1738.25,966.431 1740.6,916.175 1742.95,784.744 1745.3,888.707 1747.65,932.07 1750,1167.1 1752.35,990.991 1754.7,1040.39 1757.05,1015.37 1759.4,986.318 1761.75,968.894 1764.1,836.43 1766.45,947.303 1768.8,888.305 1771.15,1027.64 1773.5,954.619 1775.85,889.196 1778.2,879.333 1780.55,1024.41 1782.9,1097.06 1785.25,971.79 1787.6,1018.54 1789.96,1018.15 1792.31,996.297 1794.66,817.049 1797.01,1002.97 1799.36,1008.36 1801.71,971.214 1804.06,869.961 1806.41,827.698 1808.76,744.753 1811.11,982.562 1813.46,889.074 1815.81,818.465 1818.16,846.161 1820.51,941.291 1822.86,1094.09 1825.21,1152.77 1827.56,1029.17 1829.91,1053.09 1832.26,809.827 1834.61,748.654 1836.96,822.401 1839.32,938.523 1841.67,827.735 1844.02,902.369 1846.37,1012.22 1848.72,1205.11 1851.07,1065.1 1853.42,959.123 1855.77,885.832 1858.12,847.611 1860.47,894.989 1862.82,1070.8 1865.17,1089.81 1867.52,868.05 1869.87,720.508 1872.22,750.373 1874.57,981.562 1876.92,783.49 1879.27,824.322 1881.62,822.231 1883.97,957.54 1886.32,1043.35 1888.68,996.606 1891.03,1028.28 1893.38,922.224 1895.73,913.302 1898.08,956.159 1900.43,1033.98 1902.78,1099.1 1905.13,935.919 1907.48,992.855 1909.83,1097.57 1912.18,971.043 1914.53,828.294 1916.88,924.557 1919.23,910.724 1921.58,899.599 1923.93,865.012 1926.28,1015.94 1928.63,925.576 1930.98,953.391 1933.33,1029.11 1935.68,970.474 1938.04,1016.51 1940.39,912.218 1942.74,892.153 1945.09,883.09 1947.44,977.449 1949.79,882.653 1952.14,903.691 1954.49,1171.81 1956.84,973.324 1959.19,992.32 1961.54,936.533 1963.89,912.928 1966.24,841.77 1968.59,929.804 1970.94,746.702 1973.29,1016.37 1975.64,1022.24 1977.99,915.469 1980.34,913.112 1982.69,810.721 1985.04,774.796 1987.4,1014.15 1989.75,830.377 1992.1,905.321 1994.45,968.206 1996.8,1048.66 1999.15,792.13 2001.5,1118.44 2003.85,930.937 2006.2,945.528 2008.55,866.306 2010.9,897.62 2013.25,830.496 2015.6,884.188 2017.95,931.792 2020.3,876.086 2022.65,893.368 2025,914.674 2027.35,936.039 2029.7,1123.52 2032.05,851.697 2034.4,881.725 2036.76,935.296 2039.11,915.923 2041.46,988.94 2043.81,935.546 2046.16,800.347 2048.51,873.266 2050.86,882.793 2053.21,804.133 2055.56,1053.75 2057.91,1041.64 2060.26,952.102 2062.61,949.161 2064.96,951.763 2067.31,1087.63 2069.66,959.185 2072.01,689.06 2074.36,994.438 2076.71,930.791 2079.06,1031.93 2081.41,821.544 2083.76,1011.81 2086.11,834.452 2088.47,933.775 2090.82,891.211 2093.17,861.308 2095.52,1009.01 2097.87,911.028 2100.22,914.832 2102.57,943.424 2104.92,651.532 2107.27,784.672 2109.62,1061.77 2111.97,960.525 2114.32,1102.2 2116.67,836.032 2119.02,986.008 2121.37,1032.25 2123.72,970.19 2126.07,778.49 2128.42,884.664 2130.77,846.101 2133.12,870.468 2135.47,1249.43 2137.83,895.05 2140.18,899.403 2142.53,861.257 2144.88,1120.53 2147.23,963.272 2149.58,602.447 2151.93,976.953 2154.28,1186.75 2156.63,811.252 2158.98,992.606 2161.33,878.383 2163.68,767.29 2166.03,870.599 2168.38,1044.31 2170.73,682.409 2173.08,831.912 2175.43,1025.37 2177.78,841.442 2180.13,1080.18 2182.48,1062.71 2184.83,877.672 2187.19,980.301 2189.54,1035.71 2191.89,1048.32 2194.24,946.091 2196.59,725.223 2198.94,957.971 2201.29,1025.19 2203.64,986.75 2205.99,963.714 2208.34,972.909 2210.69,987.788 2213.04,923.634 2215.39,979.972 2217.74,930.305 2220.09,1073.14 2222.44,765.052 2224.79,991.691 2227.14,732.606 2229.49,864.672 2231.84,928.904 2234.19,780.018 2236.55,960.188 2238.9,1067.38 2241.25,967.785 2243.6,1002.5 2245.95,1034.77 2248.3,985.715 2250.65,1087.37 2253,910.217 2255.35,730.507 2257.7,784.226 2260.05,1015.84 2262.4,1038.69 2264.75,1006.52 2267.1,1076.58 2269.45,1084.82 2271.8,961.458 2274.15,920.709 2276.5,820.713 2278.85,908.7 2281.2,980.717 2283.55,874.787 2285.91,1079.84 2288.26,942.2 2290.61,748.665 2292.96,1000.44 2295.31,956.549 2297.66,960.77 2300.01,1028.32 2302.36,891.231 2304.71,833.767 2307.06,750.485 2309.41,994.321 2311.76,931.563 2314.11,897.626 2316.46,975.597 2318.81,904.7 2321.16,1117.1 2323.51,1049.31 2325.86,1091.71 2328.21,888.393 2330.56,988.794 2332.91,767.875 2335.27,833.146 2337.62,981.109 2339.97,968.497 2342.32,880.614 2344.67,1036.97 2347.02,1125.83 2349.37,975.007 2351.72,926.651 2354.07,810.536 2356.42,1067.41 2358.77,954.227 2361.12,934.358 2363.47,1024.08 2365.82,981.902 2368.17,917.249 2370.52,781.61 2372.87,1086.47 2375.22,995.043 2377.57,839.15 2379.92,937.508 2382.27,826.463 2384.62,892.133 2386.98,967.785 2389.33,1075.26 2391.68,998.456 2394.03,924.837 2396.38,1072.2 2398.73,958.476 2401.08,934.65 2403.43,926.818 2405.78,878.61 2408.13,980.989 2410.48,1066.68 2412.83,1005.48 2415.18,928.173 2417.53,1038.15 2419.88,861.536 2422.23,795.683 2424.58,860.69 2426.93,1128.44 2429.28,945.031 2431.63,983.856 2433.98,854.944 2436.34,826.464 2438.69,1078.77 2441.04,1077.18 2443.39,978.311 2445.74,924.112 2448.09,1045.76 2450.44,960.665 2452.79,1161.82 2455.14,862.53 2457.49,998.302 2459.84,1000.12 2462.19,995.639 2464.54,953.062 2466.89,727.39 2469.24,667.703 2471.59,908.092 2473.94,817.93 2476.29,989.257 2478.64,742.844 2480.99,859.484 2483.34,747.493 2485.7,882.161 2488.05,840.426 2490.4,938.367 2492.75,942.343 2495.1,1010.93 2497.45,949.92 2499.8,1062.44 2502.15,960.229 2504.5,993.333 2506.85,917.423 2509.2,1148.53 2511.55,996.504 2513.9,1029.43 2516.25,958.535 2518.6,901.866 2520.95,951.743 2523.3,920.529 2525.65,777.912 2528,1025.83 2530.35,884.358 2532.7,1107.8 2535.06,901.37 2537.41,835.686 2539.76,1160.14 2542.11,1084.9 2544.46,1032.71 2546.81,1012.58 2549.16,884.972 2551.51,799.92 2553.86,996.384 2556.21,958.745 2558.56,1055.81 2560.91,709.853 2563.26,996.045 2565.61,934.118 2567.96,978.97 2570.31,911.28 "></polyline>
<polyline clip-path="url(#clip342)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,752.55 224.541,482.334 226.891,325.729 229.242,501.598 231.592,512.877 233.943,547.06 236.293,516.154 238.644,504.858 240.994,511.282 243.345,511.289 245.695,490.62 248.046,255.785 250.396,472.903 252.747,383.866 255.097,483.209 257.448,556.428 259.798,392.487 262.148,485.757 264.499,389.289 266.849,470.263 269.2,516.263 271.55,509.435 273.901,440.183 276.251,393.609 278.602,266.491 280.952,323.919 283.303,684.327 285.653,420.293 288.004,457.741 290.354,477.221 292.705,504.526 295.055,237.709 297.406,358.564 299.756,198.424 302.107,437.333 304.457,360.533 306.807,641.992 309.158,310.425 311.508,470.205 313.859,545.04 316.209,274.168 318.56,441.825 320.91,475.355 323.261,427.914 325.611,540.861 327.962,383.708 330.312,493.168 332.663,478.327 335.013,96.8724 337.364,378.175 339.714,499.849 342.065,481.358 344.415,510.004 346.765,483.794 349.116,512.719 351.466,462.798 353.817,489.201 356.167,344.951 358.518,421.353 360.868,434.774 363.219,695.337 365.569,238.969 367.92,451.678 370.27,424.07 372.621,323.612 374.971,635.191 377.322,421.642 379.672,251.091 382.023,400.139 384.373,465.457 386.724,415.652 389.074,468.974 391.424,519.307 393.775,355.531 396.125,307.372 398.476,414.997 400.826,368.671 403.177,468.511 405.527,369.18 407.878,366.964 410.228,512.728 412.579,449.231 414.929,298.526 417.28,528.023 419.63,465.362 421.981,388.707 424.331,525.394 426.682,362.611 429.032,329.092 431.382,308.947 433.733,669.005 436.083,627.127 438.434,371.565 440.784,342.635 443.135,363.857 445.485,302.438 447.836,318.592 450.186,407.392 452.537,337.216 454.887,368.77 457.238,634.439 459.588,305.089 461.939,295.372 464.289,361.479 466.64,372.278 468.99,465.284 471.341,490.671 473.691,519.214 476.041,471.333 478.392,284.501 480.742,337.965 483.093,288.614 485.443,438.173 487.794,641.725 490.144,329.584 492.495,553.783 494.845,451.908 497.196,484.179 499.546,561.927 501.897,505.854 504.247,288.176 506.598,361.905 508.948,482.613 511.299,505.261 513.649,386.511 515.999,486.159 518.35,274.528 520.7,431.862 523.051,429.236 525.401,672.955 527.752,284.558 530.102,550.2 532.453,441.251 534.803,325.755 537.154,290.145 539.504,302.545 541.855,489.969 544.205,226.755 546.556,427.698 548.906,433.121 551.257,425.474 553.607,289.388 555.958,271.622 558.308,332.584 560.658,369.608 563.009,378.566 565.359,579.405 567.71,405.961 570.06,466.474 572.411,272.39 574.761,535.737 577.112,601.814 579.462,411.919 581.813,281.741 584.163,444.811 586.514,428.279 588.864,559.703 591.215,353.072 593.565,407.407 595.916,302.328 598.266,342.418 600.616,438.412 602.967,687.931 605.317,474.118 607.668,380.236 610.018,595.92 612.369,559.699 614.719,406.014 617.07,366.069 619.42,444.573 621.771,290.362 624.121,402.096 626.472,347.325 628.822,526.162 631.173,437.834 633.523,358.541 635.874,479.459 638.224,614.493 640.575,600.342 642.925,424.582 645.275,435.551 647.626,354.533 649.976,373.298 652.327,576.276 654.677,366.604 657.028,504.034 659.378,461.573 661.729,360.226 664.079,287.635 666.43,356.562 668.78,283.222 671.131,312.085 673.481,359.231 675.832,373.302 678.182,538.285 680.533,359.726 682.883,596.551 685.233,344.5 687.584,610.14 689.934,374.049 692.285,525.697 694.635,443.271 696.986,454.635 699.336,397.667 701.687,402.535 704.037,311.914 706.388,420.501 708.738,321.73 711.089,357.387 713.439,492.663 715.79,380.208 718.14,449.914 720.491,531.789 722.841,513.63 725.192,593.823 727.542,446.869 729.892,579.13 732.243,359.469 734.593,519.607 736.944,456.985 739.294,306.238 741.645,496.782 743.995,331.477 746.346,434.886 748.696,317.241 751.047,570.736 753.397,479.488 755.748,314.613 758.098,352.027 760.449,401.786 762.799,389.661 765.15,467.893 767.5,505.149 769.85,506.112 772.201,406.717 774.551,319.232 776.902,321.043 779.252,348.639 781.603,392.456 783.953,348.957 786.304,444.183 788.654,216.445 791.005,418.313 793.355,264.927 795.706,462.189 798.056,268.806 800.407,414.948 802.757,312.744 805.108,393.721 807.458,455.157 809.809,475.721 812.159,195.561 814.509,374.904 816.86,530.423 819.21,485.722 821.561,224.801 823.911,406.455 826.262,363.988 828.612,484.015 830.963,376.704 833.313,426.192 835.664,514.712 838.014,433.418 840.365,206.037 842.715,378.262 845.066,508.599 847.416,476.482 849.767,356.496 852.117,361.65 854.467,559.819 856.818,343.879 859.168,525.366 861.519,604.248 863.869,385.51 866.22,360.781 868.57,491.579 870.921,566.611 873.271,321.738 875.622,570.82 877.972,472.431 880.323,592.757 882.673,591.831 885.024,426.274 887.374,390.105 889.725,268.135 892.075,422.961 894.426,308.467 896.776,606.899 899.126,522.298 901.477,455.487 903.827,240.569 906.178,506.499 908.528,427.4 910.879,364.74 913.229,511.194 915.58,482.637 917.93,239.294 920.281,561.124 922.631,491.6 924.982,481.228 927.332,252.919 929.683,426.92 932.033,496.362 934.384,511.825 936.734,367.456 939.084,457.155 941.435,505.191 943.785,577.528 946.136,265.43 948.486,536.56 950.837,167.874 953.187,554.527 955.538,338.436 957.888,303.875 960.239,288.542 962.589,287.291 964.94,417.74 967.29,379.205 969.641,453.23 971.991,303.013 974.342,505.08 976.692,416.56 979.043,515.128 981.393,357.388 983.743,463.852 986.094,561.436 988.444,615.15 990.795,351.168 993.145,466.18 995.496,368.482 997.846,562.316 1000.2,445.579 1002.55,575.023 1004.9,203.429 1007.25,393.142 1009.6,485.211 1011.95,537.665 1014.3,325.595 1016.65,671.776 1019,122.964 1021.35,321.219 1023.7,412.795 1026.05,361.747 1028.4,218.255 1030.75,429.738 1033.1,429.671 1035.45,411.824 1037.8,380.567 1040.15,369.826 1042.51,453.141 1044.86,430.087 1047.21,447.944 1049.56,332.89 1051.91,184.129 1054.26,517.244 1056.61,290.585 1058.96,398.767 1061.31,368.272 1063.66,471.526 1066.01,474.772 1068.36,282.003 1070.71,440.145 1073.06,477.77 1075.41,474.303 1077.76,457.141 1080.11,358.238 1082.46,507.815 1084.81,363.354 1087.16,231.12 1089.51,463.385 1091.87,380.698 1094.22,358.191 1096.57,414.294 1098.92,457.256 1101.27,370.979 1103.62,379.176 1105.97,401.518 1108.32,517.501 1110.67,503.599 1113.02,507.893 1115.37,444.615 1117.72,490.984 1120.07,429.127 1122.42,430.525 1124.77,532.31 1127.12,511.38 1129.47,486.257 1131.82,349.048 1134.17,352.156 1136.52,400.631 1138.87,657.083 1141.23,324.966 1143.58,566.729 1145.93,303.206 1148.28,508.315 1150.63,461.688 1152.98,299.192 1155.33,507.809 1157.68,364.243 1160.03,406.833 1162.38,552.686 1164.73,443.114 1167.08,433.284 1169.43,412.184 1171.78,461.786 1174.13,388.221 1176.48,370.156 1178.83,477.78 1181.18,645.21 1183.53,412.725 1185.88,337.492 1188.23,523.546 1190.59,547.504 1192.94,515.927 1195.29,519.787 1197.64,342.731 1199.99,250.015 1202.34,191.326 1204.69,530.872 1207.04,327.827 1209.39,503.349 1211.74,542.448 1214.09,609.406 1216.44,463.648 1218.79,437.486 1221.14,461.706 1223.49,640.737 1225.84,483.283 1228.19,466.176 1230.54,537.944 1232.89,260.347 1235.24,561.806 1237.59,497.065 1239.94,548.587 1242.3,444.213 1244.65,611.027 1247,362.782 1249.35,337.032 1251.7,341.531 1254.05,339.647 1256.4,353.68 1258.75,519.12 1261.1,497.458 1263.45,364.146 1265.8,490.03 1268.15,358.489 1270.5,411.348 1272.85,548.287 1275.2,273.413 1277.55,468.722 1279.9,374.316 1282.25,437.361 1284.6,346.48 1286.95,348.617 1289.3,704.541 1291.66,452.138 1294.01,518.015 1296.36,155.989 1298.71,449.435 1301.06,452.346 1303.41,503.967 1305.76,368.253 1308.11,480.999 1310.46,466.034 1312.81,346.832 1315.16,483.312 1317.51,467.17 1319.86,542.31 1322.21,484.448 1324.56,410.161 1326.91,431.708 1329.26,387.889 1331.61,360.056 1333.96,362.705 1336.31,572.801 1338.66,325.825 1341.02,336.56 1343.37,364.976 1345.72,528.26 1348.07,398.964 1350.42,436.434 1352.77,520.753 1355.12,460.805 1357.47,422.079 1359.82,433.352 1362.17,408.406 1364.52,340.501 1366.87,551.81 1369.22,323.166 1371.57,200.245 1373.92,473.649 1376.27,635.247 1378.62,389.829 1380.97,347.329 1383.32,269.806 1385.67,451.704 1388.02,584.579 1390.38,440.853 1392.73,415.272 1395.08,454.824 1397.43,450.805 1399.78,363.819 1402.13,428.428 1404.48,562.59 1406.83,534.082 1409.18,468.526 1411.53,349.02 1413.88,458.333 1416.23,445.526 1418.58,505.101 1420.93,476.577 1423.28,429.489 1425.63,450.135 1427.98,429.195 1430.33,505.485 1432.68,430.942 1435.03,217.89 1437.38,636.296 1439.74,531.147 1442.09,373.354 1444.44,487.177 1446.79,304.744 1449.14,566.898 1451.49,408.757 1453.84,273.336 1456.19,508.685 1458.54,428.162 1460.89,448.194 1463.24,436.306 1465.59,518.714 1467.94,564.572 1470.29,336.99 1472.64,389.55 1474.99,610.104 1477.34,502.528 1479.69,572.16 1482.04,454.354 1484.39,340.191 1486.74,397.955 1489.1,276.347 1491.45,628.252 1493.8,481.086 1496.15,475.568 1498.5,431.986 1500.85,574.48 1503.2,490.579 1505.55,406.934 1507.9,636.988 1510.25,394.237 1512.6,370.968 1514.95,447.782 1517.3,224.535 1519.65,393.367 1522,499.792 1524.35,401.311 1526.7,514.64 1529.05,446.848 1531.4,360.728 1533.75,544.479 1536.1,530.11 1538.45,495.586 1540.81,455.23 1543.16,377.502 1545.51,444.711 1547.86,338.523 1550.21,400.223 1552.56,210.973 1554.91,516.098 1557.26,329.278 1559.61,475.179 1561.96,347.005 1564.31,687.045 1566.66,472.681 1569.01,333.77 1571.36,375.329 1573.71,628.277 1576.06,395.664 1578.41,410.591 1580.76,424.357 1583.11,454.888 1585.46,563.827 1587.81,669.784 1590.17,398.463 1592.52,364.13 1594.87,450.687 1597.22,373.721 1599.57,655.855 1601.92,402.213 1604.27,305.664 1606.62,416.484 1608.97,597.51 1611.32,512.066 1613.67,419.502 1616.02,527.344 1618.37,351.045 1620.72,383.898 1623.07,596.189 1625.42,353.889 1627.77,459.877 1630.12,508.471 1632.47,516.579 1634.82,381.942 1637.17,408.668 1639.53,445.922 1641.88,343.994 1644.23,382.834 1646.58,427.284 1648.93,397.907 1651.28,350.517 1653.63,262.729 1655.98,351.658 1658.33,425.683 1660.68,532.032 1663.03,248.399 1665.38,419.533 1667.73,464.738 1670.08,243.546 1672.43,271.1 1674.78,411.16 1677.13,329.36 1679.48,475.612 1681.83,519.189 1684.18,457.08 1686.53,399.709 1688.89,438.3 1691.24,304.254 1693.59,291.788 1695.94,446.757 1698.29,339.245 1700.64,605.812 1702.99,298.252 1705.34,296.482 1707.69,450.296 1710.04,362.692 1712.39,440.227 1714.74,344.738 1717.09,488.956 1719.44,363.089 1721.79,407.225 1724.14,323.126 1726.49,389.548 1728.84,464.075 1731.19,583.501 1733.54,354.15 1735.89,447.097 1738.25,152.238 1740.6,444.796 1742.95,445.291 1745.3,372.42 1747.65,562.571 1750,384.853 1752.35,415.044 1754.7,424.301 1757.05,538.031 1759.4,425.17 1761.75,615.128 1764.1,318.934 1766.45,360.381 1768.8,443.401 1771.15,331.704 1773.5,558.496 1775.85,416.395 1778.2,326.268 1780.55,508.429 1782.9,430.735 1785.25,483.624 1787.6,407.276 1789.96,509.056 1792.31,485.004 1794.66,550.042 1797.01,183.309 1799.36,474.605 1801.71,188.643 1804.06,530.568 1806.41,436.865 1808.76,356.627 1811.11,347.694 1813.46,409.698 1815.81,450.764 1818.16,500.971 1820.51,334.46 1822.86,567.602 1825.21,532.146 1827.56,332.109 1829.91,392.867 1832.26,372.322 1834.61,585.012 1836.96,404.465 1839.32,479.915 1841.67,320.479 1844.02,379.165 1846.37,317.919 1848.72,501.545 1851.07,516.598 1853.42,274.258 1855.77,336.691 1858.12,390.066 1860.47,433.738 1862.82,475.331 1865.17,462.673 1867.52,381.875 1869.87,486.823 1872.22,502.118 1874.57,513.807 1876.92,303.691 1879.27,422.222 1881.62,369.173 1883.97,300.882 1886.32,398.956 1888.68,484.209 1891.03,408.529 1893.38,480.518 1895.73,384.1 1898.08,474.019 1900.43,531.086 1902.78,516.429 1905.13,543.009 1907.48,276.611 1909.83,347.12 1912.18,591.562 1914.53,508.943 1916.88,367.375 1919.23,371.611 1921.58,373.106 1923.93,249.599 1926.28,432.689 1928.63,477.552 1930.98,487.09 1933.33,191.74 1935.68,512.032 1938.04,588.192 1940.39,426.003 1942.74,360.698 1945.09,473.184 1947.44,389.554 1949.79,471.068 1952.14,405.703 1954.49,496.382 1956.84,577.076 1959.19,638.707 1961.54,267.541 1963.89,446.535 1966.24,377.755 1968.59,375.846 1970.94,486.538 1973.29,370.836 1975.64,459.948 1977.99,490.419 1980.34,352.984 1982.69,126.99 1985.04,443.777 1987.4,400.78 1989.75,385.176 1992.1,511.175 1994.45,475.492 1996.8,516.191 1999.15,495.973 2001.5,411.758 2003.85,272.025 2006.2,427.256 2008.55,656.701 2010.9,367.476 2013.25,299.179 2015.6,583.242 2017.95,259.9 2020.3,444.26 2022.65,452.353 2025,695.502 2027.35,478.203 2029.7,741.217 2032.05,576.892 2034.4,475.304 2036.76,497.459 2039.11,525.958 2041.46,604.476 2043.81,413.576 2046.16,523.738 2048.51,326.217 2050.86,405.27 2053.21,458.019 2055.56,477.456 2057.91,561.207 2060.26,494.199 2062.61,325.632 2064.96,448.339 2067.31,334.354 2069.66,486.274 2072.01,529.657 2074.36,403.681 2076.71,518.672 2079.06,511.805 2081.41,572.199 2083.76,590.284 2086.11,628.832 2088.47,523.179 2090.82,488.868 2093.17,429.653 2095.52,584.512 2097.87,286 2100.22,390.814 2102.57,513.628 2104.92,410.68 2107.27,306.138 2109.62,442.05 2111.97,602.484 2114.32,384.443 2116.67,622.744 2119.02,483.349 2121.37,515.941 2123.72,337.58 2126.07,472.535 2128.42,495.367 2130.77,422.876 2133.12,317.94 2135.47,323.572 2137.83,351.524 2140.18,439.231 2142.53,478.709 2144.88,465.739 2147.23,498.364 2149.58,626.93 2151.93,465.917 2154.28,223.738 2156.63,381.545 2158.98,570.549 2161.33,616.195 2163.68,460.564 2166.03,342.026 2168.38,440.357 2170.73,362.148 2173.08,393.052 2175.43,340.34 2177.78,394.231 2180.13,396.674 2182.48,456.46 2184.83,436.434 2187.19,462.596 2189.54,383.622 2191.89,267.148 2194.24,369.496 2196.59,277.776 2198.94,446.353 2201.29,564.141 2203.64,477.721 2205.99,561.032 2208.34,597.887 2210.69,243.212 2213.04,290.591 2215.39,460.914 2217.74,374.544 2220.09,408.773 2222.44,255.464 2224.79,449.676 2227.14,483.369 2229.49,368.935 2231.84,500.618 2234.19,395.636 2236.55,321.131 2238.9,437.236 2241.25,529.95 2243.6,486.784 2245.95,462.921 2248.3,353.805 2250.65,322.379 2253,470.846 2255.35,460.842 2257.7,233.742 2260.05,356.832 2262.4,499.512 2264.75,522.807 2267.1,494.085 2269.45,397.478 2271.8,384.798 2274.15,673.405 2276.5,327.236 2278.85,534.034 2281.2,416.302 2283.55,280.654 2285.91,395.326 2288.26,500.551 2290.61,563.127 2292.96,399.546 2295.31,489.325 2297.66,430.135 2300.01,296.592 2302.36,419.692 2304.71,344.306 2307.06,309.021 2309.41,431.515 2311.76,364.851 2314.11,446.61 2316.46,470.308 2318.81,400.309 2321.16,366.098 2323.51,362.446 2325.86,523.364 2328.21,539.157 2330.56,410.638 2332.91,476.687 2335.27,513.882 2337.62,308.156 2339.97,413.868 2342.32,315.637 2344.67,352.063 2347.02,537.915 2349.37,421.544 2351.72,517.776 2354.07,493.322 2356.42,456.167 2358.77,621.316 2361.12,329.529 2363.47,370.408 2365.82,478.447 2368.17,339.069 2370.52,469.315 2372.87,463.239 2375.22,531.584 2377.57,390.452 2379.92,566.173 2382.27,401.873 2384.62,463.008 2386.98,443.087 2389.33,547.418 2391.68,539.57 2394.03,535.853 2396.38,573.526 2398.73,535.787 2401.08,451.462 2403.43,427.256 2405.78,400.275 2408.13,512.714 2410.48,343.203 2412.83,573.09 2415.18,401.044 2417.53,725.123 2419.88,99.3714 2422.23,463.456 2424.58,425.61 2426.93,512.578 2429.28,221.48 2431.63,551.438 2433.98,493.431 2436.34,486.997 2438.69,303.376 2441.04,472.301 2443.39,424.679 2445.74,427.589 2448.09,390.015 2450.44,473.32 2452.79,319.417 2455.14,566.729 2457.49,518.977 2459.84,430.539 2462.19,297.88 2464.54,309.277 2466.89,288.067 2469.24,488.716 2471.59,517.307 2473.94,228.667 2476.29,256.781 2478.64,330.51 2480.99,611.234 2483.34,621.333 2485.7,364.907 2488.05,472.395 2490.4,540.272 2492.75,444.695 2495.1,311.55 2497.45,390.304 2499.8,465.876 2502.15,374.518 2504.5,504.164 2506.85,645.035 2509.2,321.572 2511.55,366.826 2513.9,483.133 2516.25,534.533 2518.6,433.401 2520.95,224.935 2523.3,436.564 2525.65,342.567 2528,568.182 2530.35,360.621 2532.7,450.231 2535.06,600.584 2537.41,348.944 2539.76,550.76 2542.11,282.167 2544.46,393.189 2546.81,376.672 2549.16,188.051 2551.51,571.362 2553.86,403.927 2556.21,467.442 2558.56,415.979 2560.91,376.658 2563.26,561.15 2565.61,501.304 2567.96,334.741 2570.31,525.265 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -2.79689   -3.00567   -4.75273   …  -4.64606    -4.49917  -4.47824
  0.953337   0.249266   0.155615      0.0205679   1.07473   2.0608
  3.39163    3.75003    4.05266       3.60797     5.72693   5.44206

[:, :, 2] =
 -2.02424   -4.01055    -4.14177   -4.08873  …  -5.01299   -3.55283  -3.75933
 -0.246758   0.0699339  -0.819305  -2.32065      0.954589   1.52139   2.1341
  2.30915    5.29847     5.72956    5.93952      5.6413     4.00877   6.79224

[:, :, 3] =
 -0.979384  -3.40394  -6.51355    …  -6.21366  -5.05767   -5.11592
 -0.721879  -0.58799  -0.0013033     -1.49706  -0.227537  -0.695405
  5.20513    5.38305   4.26738        5.1995    6.638      6.4692

[:, :, 4] =
 -4.31777   -3.53444   -4.41962   …  -5.45792   -3.28909  -5.03669
 -0.767408  -0.317044   0.614841     -0.483872  -1.09722  -0.379507
  1.55174    3.152      4.86635       4.79736    4.17495   5.13708</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.96782    1.00807
  0.0307655  0.998459
  5.01238    0.999441</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.62 seconds
Compute duration  = 2.62 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold">  ess_bulk </span> <span class="ansi-bold">  ess_tail </span> <span class="ansi-bold">    rhat </span>  ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>  ⋯

        x[1]   -5.0117    0.9993    0.0172   3392.1952   5231.7104    1.0002   ⋯
        x[2]   -0.0129    1.0127    0.0183   3056.8739   4880.7472    0.9999   ⋯
        x[3]    5.0004    0.9959    0.0170   3434.0233   5169.4433    1.0003   ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

        x[1]   -6.9875   -5.6939   -5.0090   -4.3362   -3.0776
        x[2]   -2.0023   -0.6861   -0.0040    0.6763    1.9370
        x[3]    3.0600    4.3218    5.0047    5.6797    6.9442
</pre>
</div>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.74 seconds
Compute duration  = 1.74 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold">  ess_bulk </span> <span class="ansi-bold">  ess_tail </span> <span class="ansi-bold">    rhat </span>  ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>  ⋯

           x    0.4999    0.1859    0.0028   4260.3529   5399.5244    1.0000   ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

           x    0.1505    0.3626    0.4975    0.6382    0.8473
</pre>
</div>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.26 seconds
Compute duration  = 0.26 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold"> ess_bulk </span> <span class="ansi-bold"> ess_tail </span> <span class="ansi-bold">    rhat </span> <span class="ansi-bold"> e</span> ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  </span> ⋯

           x    0.4427    0.2011    0.0334    31.1701        NaN    1.1268     ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

           x    0.2034    0.2127    0.4319    0.5932    0.8026
</pre>
</div>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre>DomainError with Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.7206911860855486,1.0,0.0):
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] <span class="ansi-bold">#371</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [2] <span class="ansi-bold">check_args</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">utils.jl:89</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [3] <span class="ansi-bold">#Normal#370</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [4] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:36</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [5] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:42</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [6] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">compiler.jl:579</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [7] <span class="ansi-bold">demo</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">__model__</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">__varinfo__</span>::DynamicPPL.ThreadSafeVarInfo<span class="ansi-bright-black-fg">{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Base.RefValue{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}</span>, <span class="ansi-bright-black-fg">__context__</span>::DynamicPPL.DefaultContext<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/turing-docs/turing-docs/tutorials/docs-17-implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:454</span>
  [8] <span class="ansi-bold">_evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:963</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [9] <span class="ansi-bold">evaluate_threadsafe!!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">varinfo</span>::DynamicPPL.TypedVarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}</span>, <span class="ansi-bright-black-fg">context</span>::DynamicPPL.DefaultContext<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:952</span>
 [10] <span class="ansi-bold">evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:887</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [11] <span class="ansi-bold">logdensity</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logdensityfunction.jl:94</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [12] <span class="ansi-bold">Fix1</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">./</span><span style="text-decoration:underline" class="ansi-bright-black-fg">operators.jl:1118</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [13] <span class="ansi-bold">vector_mode_dual_eval!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::Base.Fix1<span class="ansi-bright-black-fg">{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}}</span>, <span class="ansi-bright-black-fg">cfg</span>::ForwardDiff.GradientConfig<span class="ansi-bright-black-fg">{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">ForwardDiff</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/PcZ48/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">apiutils.jl:24</span>
 [14] <span class="ansi-bold">vector_mode_gradient!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">result</span>::DiffResults.MutableDiffResult<span class="ansi-bright-black-fg">{1, Float64, Tuple{Vector{Float64}}}</span>, <span class="ansi-bright-black-fg">f</span>::Base.Fix1<span class="ansi-bright-black-fg">{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">cfg</span>::ForwardDiff.GradientConfig<span class="ansi-bright-black-fg">{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">ForwardDiff</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/PcZ48/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">gradient.jl:96</span>
 [15] <span class="ansi-bold">gradient!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/PcZ48/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">gradient.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [16] <span class="ansi-bold">gradient!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/PcZ48/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">gradient.jl:35</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [17] <span class="ansi-bold">logdensity_and_gradient</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/LogDensityProblemsAD/rBlLq/ext/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">LogDensityProblemsADForwardDiffExt.jl:118</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [18] <span class="ansi-bold">leapfrog_step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity<span class="ansi-bright-black-fg">{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">p</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">ϵ</span>::Int64, <span class="ansi-bright-black-fg">M</span>::UniformScaling<span class="ansi-bright-black-fg">{Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/turing-docs/turing-docs/tutorials/docs-17-implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:303</span>
 [19] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model_wrapper</span>::AbstractMCMC.LogDensityModel<span class="ansi-bright-black-fg">{LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}}</span>, <span class="ansi-bright-black-fg">sampler</span>::MALA<span class="ansi-bright-black-fg">{Int64, UniformScaling{Bool}}</span>, <span class="ansi-bright-black-fg">state</span>::MALAState<span class="ansi-bright-black-fg">{Vector{Float64}}</span>; <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/turing-docs/turing-docs/tutorials/docs-17-implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:274</span>
 [20] <span class="ansi-bold">step</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/work/turing-docs/turing-docs/tutorials/docs-17-implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:256</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [21] <span class="ansi-bold">#step#108</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:90</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [22] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler_wrapper</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">state</span>::Turing.Inference.TuringState<span class="ansi-bright-black-fg">{MALAState{Vector{Float64}}, LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-yellow-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:79</span>
 [23] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/YrmkI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:176</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [24] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/YrmkI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:16</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [25] <span class="ansi-bold">mcmcsample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">progress</span>::Bool, <span class="ansi-bright-black-fg">progressname</span>::String, <span class="ansi-bright-black-fg">callback</span>::Nothing, <span class="ansi-bright-black-fg">discard_initial</span>::Int64, <span class="ansi-bright-black-fg">thinning</span>::Int64, <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">AbstractMCMC</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/YrmkI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:120</span>
 [26] <span class="ansi-bold">sample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">resume_from</span>::Nothing, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{progress::Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:93</span>
 [27] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:83</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [28] <span class="ansi-bold">#sample#4</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:263</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [29] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:256</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [30] <span class="ansi-bold">#sample#3</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:253</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [31] top-level scope
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/work/turing-docs/turing-docs/tutorials/docs-17-implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:456</span></pre>
</div>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.57 seconds
Compute duration  = 0.57 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold"> ess_bulk </span> <span class="ansi-bold"> ess_tail </span> <span class="ansi-bold">    rhat </span> <span class="ansi-bold"> e</span> ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  </span> ⋯

          σ²    0.8242    0.5488    0.0234   400.7468   109.5858    1.0017     ⋯
           x    0.0170    0.8412    0.0321   889.0948   663.3776    1.0000     ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

          σ²    0.1434    0.3924    0.6945    1.1224    2.1428
           x   -1.6746   -0.3824    0.0216    0.3814    1.9177
</pre>
</div>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.05 seconds
Compute duration  = 3.05 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold"> ess_bulk </span> <span class="ansi-bold"> ess_tail </span> <span class="ansi-bold">    rhat </span> <span class="ansi-bold"> e</span> ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  </span> ⋯

          σ²    0.8677    0.5685    0.0337   163.9772    52.9747    1.0012     ⋯
           x    0.0421    1.0387    0.0633   391.9540   308.7708    1.0139     ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

          σ²    0.0755    0.4233    0.7481    1.2269    2.2075
           x   -1.8912   -0.4260    0.0026    0.4110    2.4016
</pre>
</div>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../versions.html" class="pagination-link" aria-label="Versions">
        <span class="nav-page-text">Versions</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/TuringTutorials/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/TuringTutorials/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>
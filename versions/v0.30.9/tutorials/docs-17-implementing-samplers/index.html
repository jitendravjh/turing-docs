<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.1">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Library API</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.30" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.30</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.30">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">For Developers (Inference)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Documentation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Modelling Syntax and Interface</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-14-using-turing-quick-start/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quick Start</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-09-using-turing-advanced/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Usage</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Turing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">For Developers (PPL)</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">For Developers (Inference)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">For Developers (Inference)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-16.90825219481289</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-16.90825219481289</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([-0.9709069847865812, -0.008876519922317862, 1.3444807094835234]), MALAState{Vector{Float64}}([-0.9709069847865812, -0.008876519922317862, 1.3444807094835234]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -0.567713  -2.49761  -3.63957  -5.3101   …  -5.253    -4.62107  -4.69658
  1.12555    1.38517  -0.39739  -0.33484     -1.60686  -2.00765  -1.28858
  1.84637    3.63836   3.80962   4.40478      5.97572   5.24262   6.15589</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.01272     0.999794
  0.00689772  0.991975
  4.96915     0.992393</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip940">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip940)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip941">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip940)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip942">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip942)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip942)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip942)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip942)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip942)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip940)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip940)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip940)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip940)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip940)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip940)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip940)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip940)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip940)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip940)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip940)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip940)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip940)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip940)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip940)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip940)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip940)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip940)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip940)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip940)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip942)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1527.83 2640.76,1527.83 "></polyline>
<polyline clip-path="url(#clip942)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1221.92 2640.76,1221.92 "></polyline>
<polyline clip-path="url(#clip942)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,916.003 2640.76,916.003 "></polyline>
<polyline clip-path="url(#clip942)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,610.09 2640.76,610.09 "></polyline>
<polyline clip-path="url(#clip942)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,304.177 2640.76,304.177 "></polyline>
<polyline clip-path="url(#clip940)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip940)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1527.83 170.644,1527.83 "></polyline>
<polyline clip-path="url(#clip940)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1221.92 170.644,1221.92 "></polyline>
<polyline clip-path="url(#clip940)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,916.003 170.644,916.003 "></polyline>
<polyline clip-path="url(#clip940)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,610.09 170.644,610.09 "></polyline>
<polyline clip-path="url(#clip940)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,304.177 170.644,304.177 "></polyline>
<path clip-path="url(#clip940)" d="M49.5521 1528.28 L79.2279 1528.28 L79.2279 1532.22 L49.5521 1532.22 L49.5521 1528.28 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip940)" d="M99.8991 1525.97 Q96.7509 1525.97 94.8991 1528.12 Q93.0704 1530.27 93.0704 1534.02 Q93.0704 1537.75 94.8991 1539.92 Q96.7509 1542.08 99.8991 1542.08 Q103.047 1542.08 104.876 1539.92 Q106.728 1537.75 106.728 1534.02 Q106.728 1530.27 104.876 1528.12 Q103.047 1525.97 99.8991 1525.97 M109.181 1511.31 L109.181 1515.57 Q107.422 1514.74 105.617 1514.3 Q103.834 1513.86 102.075 1513.86 Q97.4454 1513.86 94.9917 1516.99 Q92.5612 1520.11 92.2139 1526.43 Q93.5797 1524.42 95.6398 1523.35 Q97.7 1522.26 100.177 1522.26 Q105.385 1522.26 108.394 1525.43 Q111.427 1528.58 111.427 1534.02 Q111.427 1539.35 108.279 1542.56 Q105.131 1545.78 99.8991 1545.78 Q93.9037 1545.78 90.7325 1541.2 Q87.5612 1536.59 87.5612 1527.86 Q87.5612 1519.67 91.45 1514.81 Q95.3389 1509.93 101.89 1509.93 Q103.649 1509.93 105.431 1510.27 Q107.237 1510.62 109.181 1511.31 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip940)" d="M50.3623 1222.37 L80.0381 1222.37 L80.0381 1226.3 L50.3623 1226.3 L50.3623 1222.37 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip940)" d="M104.297 1220.56 Q107.654 1221.28 109.529 1223.55 Q111.427 1225.82 111.427 1229.15 Q111.427 1234.27 107.908 1237.07 Q104.39 1239.87 97.9083 1239.87 Q95.7324 1239.87 93.4176 1239.43 Q91.126 1239.01 88.6723 1238.16 L88.6723 1233.64 Q90.6167 1234.78 92.9315 1235.35 Q95.2463 1235.93 97.7695 1235.93 Q102.168 1235.93 104.459 1234.2 Q106.774 1232.46 106.774 1229.15 Q106.774 1226.09 104.621 1224.38 Q102.492 1222.65 98.6722 1222.65 L94.6445 1222.65 L94.6445 1218.8 L98.8574 1218.8 Q102.306 1218.8 104.135 1217.44 Q105.964 1216.05 105.964 1213.46 Q105.964 1210.79 104.066 1209.38 Q102.191 1207.95 98.6722 1207.95 Q96.7509 1207.95 94.5519 1208.36 Q92.3528 1208.78 89.7139 1209.66 L89.7139 1205.49 Q92.376 1204.75 94.6908 1204.38 Q97.0287 1204.01 99.0889 1204.01 Q104.413 1204.01 107.515 1206.44 Q110.617 1208.85 110.617 1212.97 Q110.617 1215.84 108.973 1217.83 Q107.33 1219.8 104.297 1220.56 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip940)" d="M99.4824 901.802 Q95.8713 901.802 94.0426 905.367 Q92.2371 908.909 92.2371 916.038 Q92.2371 923.145 94.0426 926.709 Q95.8713 930.251 99.4824 930.251 Q103.117 930.251 104.922 926.709 Q106.751 923.145 106.751 916.038 Q106.751 908.909 104.922 905.367 Q103.117 901.802 99.4824 901.802 M99.4824 898.098 Q105.293 898.098 108.348 902.705 Q111.427 907.288 111.427 916.038 Q111.427 924.765 108.348 929.371 Q105.293 933.955 99.4824 933.955 Q93.6723 933.955 90.5936 929.371 Q87.538 924.765 87.538 916.038 Q87.538 907.288 90.5936 902.705 Q93.6723 898.098 99.4824 898.098 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip940)" d="M104.297 608.736 Q107.654 609.454 109.529 611.722 Q111.427 613.991 111.427 617.324 Q111.427 622.44 107.908 625.241 Q104.39 628.041 97.9083 628.041 Q95.7324 628.041 93.4176 627.602 Q91.126 627.185 88.6723 626.329 L88.6723 621.815 Q90.6167 622.949 92.9315 623.528 Q95.2463 624.106 97.7695 624.106 Q102.168 624.106 104.459 622.37 Q106.774 620.634 106.774 617.324 Q106.774 614.268 104.621 612.555 Q102.492 610.819 98.6722 610.819 L94.6445 610.819 L94.6445 606.977 L98.8574 606.977 Q102.306 606.977 104.135 605.611 Q105.964 604.222 105.964 601.63 Q105.964 598.968 104.066 597.556 Q102.191 596.12 98.6722 596.12 Q96.7509 596.12 94.5519 596.537 Q92.3528 596.954 89.7139 597.833 L89.7139 593.667 Q92.376 592.926 94.6908 592.556 Q97.0287 592.185 99.0889 592.185 Q104.413 592.185 107.515 594.616 Q110.617 597.023 110.617 601.143 Q110.617 604.014 108.973 606.005 Q107.33 607.972 104.297 608.736 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip940)" d="M99.8991 302.313 Q96.7509 302.313 94.8991 304.466 Q93.0704 306.619 93.0704 310.369 Q93.0704 314.096 94.8991 316.272 Q96.7509 318.425 99.8991 318.425 Q103.047 318.425 104.876 316.272 Q106.728 314.096 106.728 310.369 Q106.728 306.619 104.876 304.466 Q103.047 302.313 99.8991 302.313 M109.181 287.661 L109.181 291.92 Q107.422 291.087 105.617 290.647 Q103.834 290.207 102.075 290.207 Q97.4454 290.207 94.9917 293.332 Q92.5612 296.457 92.2139 302.776 Q93.5797 300.763 95.6398 299.698 Q97.7 298.61 100.177 298.61 Q105.385 298.61 108.394 301.781 Q111.427 304.929 111.427 310.369 Q111.427 315.693 108.279 318.911 Q105.131 322.128 99.8991 322.128 Q93.9037 322.128 90.7325 317.545 Q87.5612 312.938 87.5612 304.212 Q87.5612 296.017 91.45 291.156 Q95.3389 286.272 101.89 286.272 Q103.649 286.272 105.431 286.619 Q107.237 286.966 109.181 287.661 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip942)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,973.894 224.541,1296.42 226.891,1384.2 229.242,1331.75 231.592,1391.87 233.943,1376.23 236.293,1418.36 238.644,1373.61 240.994,1517.4 243.345,1548.73 245.695,1519.06 248.046,1483.36 250.396,1338.04 252.747,1474.13 255.097,1363.91 257.448,1670.59 259.798,1265.93 262.148,1375.14 264.499,1535.2 266.849,1378.14 269.2,1473.51 271.55,1496.93 273.901,1517.64 276.251,1426.82 278.602,1331.47 280.952,1456.32 283.303,1505.42 285.653,1235.12 288.004,1364.49 290.354,1485.48 292.705,1308.75 295.055,1388.19 297.406,1324.96 299.756,1312.3 302.107,1490.28 304.457,1207.62 306.807,1455.59 309.158,1517.84 311.508,1458.86 313.859,1462.88 316.209,1275.29 318.56,1628.61 320.91,1307.76 323.261,1323.39 325.611,1263.73 327.962,1378.92 330.312,1468.57 332.663,1322.56 335.013,1495.16 337.364,1619.57 339.714,1343.6 342.065,1491.14 344.415,1362.79 346.765,1453.13 349.116,1438.83 351.466,1324.85 353.817,1548.56 356.167,1479.66 358.518,1474.89 360.868,1306.14 363.219,1512.89 365.569,1376.21 367.92,1575.12 370.27,1407.71 372.621,1321.26 374.971,1446.59 377.322,1324.8 379.672,1436.25 382.023,1508.39 384.373,1345.22 386.724,1570.66 389.074,1506.1 391.424,1241.21 393.775,1400.15 396.125,1484.6 398.476,1497.75 400.826,1347.12 403.177,1295.96 405.527,1379.36 407.878,1477 410.228,1370.5 412.579,1476.02 414.929,1399.43 417.28,1500.88 419.63,1377.64 421.981,1474.37 424.331,1167.15 426.682,1312.63 429.032,1465.14 431.382,1446.21 433.733,1520.62 436.083,1301.88 438.434,1397.19 440.784,1341.63 443.135,1328.78 445.485,1489.12 447.836,1408.7 450.186,1501.86 452.537,1473.14 454.887,1448.33 457.238,1459.56 459.588,1606.86 461.939,1434.86 464.289,1301.47 466.64,1600.41 468.99,1492.29 471.341,1322.98 473.691,1382.88 476.041,1494.9 478.392,1450.72 480.742,1475.73 483.093,1520.77 485.443,1527.25 487.794,1556.33 490.144,1359.58 492.495,1653.86 494.845,1399.15 497.196,1505.73 499.546,1542.39 501.897,1576.82 504.247,1538.15 506.598,1360.59 508.948,1281.19 511.299,1346.16 513.649,1516.95 515.999,1522.45 518.35,1668.44 520.7,1414.4 523.051,1462.98 525.401,1618.29 527.752,1558.93 530.102,1669.03 532.453,1349.34 534.803,1434.47 537.154,1413.17 539.504,1398.08 541.855,1378.53 544.205,1539.61 546.556,1391.8 548.906,1456.16 551.257,1531.22 553.607,1572.01 555.958,1372.77 558.308,1527.05 560.658,1559.36 563.009,1641.39 565.359,1641.12 567.71,1351.76 570.06,1439.27 572.411,1638.77 574.761,1471.61 577.112,1517.44 579.462,1466.32 581.813,1557.64 584.163,1365.16 586.514,1462.98 588.864,1316.23 591.215,1538.31 593.565,1473.08 595.916,1482.4 598.266,1331.66 600.616,1538.98 602.967,1518.07 605.317,1593.44 607.668,1440.28 610.018,1203.49 612.369,1623.82 614.719,1293.19 617.07,1519.42 619.42,1484.59 621.771,1351.58 624.121,1532.2 626.472,1477.06 628.822,1555.56 631.173,1387.64 633.523,1308.36 635.874,1345.69 638.224,1302.54 640.575,1417.92 642.925,1461.62 645.275,1439.92 647.626,1634.35 649.976,1508.06 652.327,1499.03 654.677,1298.11 657.028,1451.32 659.378,1525.35 661.729,1281.48 664.079,1372.16 666.43,1373.14 668.78,1533.8 671.131,1394.69 673.481,1378.22 675.832,1283.61 678.182,1628.2 680.533,1535.85 682.883,1518.86 685.233,1575 687.584,1560.65 689.934,1189.81 692.285,1420.79 694.635,1546.93 696.986,1371.19 699.336,1605.36 701.687,1433.34 704.037,1243.81 706.388,1628.24 708.738,1391.51 711.089,1535.03 713.439,1324.45 715.79,1265.4 718.14,1519.64 720.491,1408.22 722.841,1519.43 725.192,1324.18 727.542,1348.46 729.892,1275.3 732.243,1427.87 734.593,1518.86 736.944,1421.91 739.294,1583.55 741.645,1436.89 743.995,1535.11 746.346,1400.57 748.696,1247.48 751.047,1327.13 753.397,1603.64 755.748,1311.76 758.098,1396.11 760.449,1428.89 762.799,1342.25 765.15,1467.57 767.5,1276.84 769.85,1357.46 772.201,1316.03 774.551,1435.25 776.902,1420.99 779.252,1352.85 781.603,1516.18 783.953,1444.01 786.304,1466.23 788.654,1377.53 791.005,1518.91 793.355,1349 795.706,1468.84 798.056,1489.46 800.407,1588.48 802.757,1373.39 805.108,1334.86 807.458,1252.48 809.809,1473.12 812.159,1410.15 814.509,1403.48 816.86,1343.39 819.21,1394.92 821.561,1418.62 823.911,1439.85 826.262,1550.11 828.612,1484.1 830.963,1321.31 833.313,1527.29 835.664,1431.32 838.014,1519.27 840.365,1455.68 842.715,1472.71 845.066,1462.85 847.416,1432.92 849.767,1582.68 852.117,1384.82 854.467,1194.61 856.818,1425.25 859.168,1529.85 861.519,1502.93 863.869,1406.24 866.22,1381.35 868.57,1442.07 870.921,1442.56 873.271,1311.24 875.622,1543.05 877.972,1354.84 880.323,1379.71 882.673,1478.85 885.024,1412.21 887.374,1437.58 889.725,1589.24 892.075,1595.86 894.426,1408.61 896.776,1528.82 899.126,1262.39 901.477,1402.84 903.827,1357.16 906.178,1523.68 908.528,1469.19 910.879,1379.68 913.229,1399.3 915.58,1480.88 917.93,1502.06 920.281,1751.15 922.631,1374.11 924.982,1516.49 927.332,1327.5 929.683,1564.54 932.033,1400.17 934.384,1455.67 936.734,1180.09 939.084,1308.72 941.435,1550.54 943.785,1286.8 946.136,1514.57 948.486,1377.23 950.837,1473.37 953.187,1287.69 955.538,1365.47 957.888,1500.19 960.239,1443.9 962.589,1441.71 964.94,1631.69 967.29,1523.46 969.641,1506.92 971.991,1559.63 974.342,1369.26 976.692,1680.79 979.043,1387.79 981.393,1299.57 983.743,1363.71 986.094,1449.46 988.444,1377.03 990.795,1445.46 993.145,1256.11 995.496,1530.43 997.846,1242.35 1000.2,1668.85 1002.55,1600.91 1004.9,1393.78 1007.25,1567.58 1009.6,1494.44 1011.95,1570.87 1014.3,1335.23 1016.65,1610.63 1019,1489.09 1021.35,1442.14 1023.7,1536.84 1026.05,1344.34 1028.4,1351.35 1030.75,1427.51 1033.1,1480.96 1035.45,1503.06 1037.8,1412.67 1040.15,1388.1 1042.51,1422.74 1044.86,1460.15 1047.21,1422.5 1049.56,1413.36 1051.91,1401.86 1054.26,1245.83 1056.61,1554.21 1058.96,1614.98 1061.31,1425.76 1063.66,1558.27 1066.01,1496.4 1068.36,1355.83 1070.71,1261.18 1073.06,1474.95 1075.41,1564.17 1077.76,1517.2 1080.11,1352.23 1082.46,1390.29 1084.81,1474.37 1087.16,1358.03 1089.51,1523.03 1091.87,1378.73 1094.22,1338.77 1096.57,1291.32 1098.92,1336.38 1101.27,1447.93 1103.62,1327.94 1105.97,1263.95 1108.32,1615.91 1110.67,1415.11 1113.02,1280.93 1115.37,1392.56 1117.72,1267.33 1120.07,1462.77 1122.42,1467.3 1124.77,1587.73 1127.12,1390.85 1129.47,1294.33 1131.82,1519.94 1134.17,1596.88 1136.52,1459.52 1138.87,1412.88 1141.23,1385.94 1143.58,1680.11 1145.93,1394.66 1148.28,1300.11 1150.63,1567.75 1152.98,1386.64 1155.33,1453.85 1157.68,1456.95 1160.03,1271.15 1162.38,1550.09 1164.73,1403.16 1167.08,1469.87 1169.43,1337.23 1171.78,1269.52 1174.13,1392.88 1176.48,1646.65 1178.83,1262.11 1181.18,1397.36 1183.53,1377.7 1185.88,1479.64 1188.23,1448.37 1190.59,1438.32 1192.94,1248.68 1195.29,1559.53 1197.64,1411.74 1199.99,1535 1202.34,1479.59 1204.69,1351.98 1207.04,1351.71 1209.39,1353.91 1211.74,1447.37 1214.09,1307.63 1216.44,1560.62 1218.79,1506.76 1221.14,1170.37 1223.49,1395.76 1225.84,1421.64 1228.19,1638.85 1230.54,1104.9 1232.89,1563.6 1235.24,1442.26 1237.59,1543.81 1239.94,1318.73 1242.3,1426.35 1244.65,1433.24 1247,1575.58 1249.35,1541.05 1251.7,1501.42 1254.05,1460.49 1256.4,1529.73 1258.75,1360.16 1261.1,1359.88 1263.45,1456.14 1265.8,1556.19 1268.15,1584.98 1270.5,1624.89 1272.85,1410.14 1275.2,1495.86 1277.55,1517.42 1279.9,1389.86 1282.25,1402.3 1284.6,1318.57 1286.95,1513.69 1289.3,1391.99 1291.66,1562.49 1294.01,1432.86 1296.36,1554.58 1298.71,1386.52 1301.06,1442.25 1303.41,1445.76 1305.76,1353.97 1308.11,1514.61 1310.46,1372.28 1312.81,1308.55 1315.16,1343.01 1317.51,1357.91 1319.86,1483.44 1322.21,1347.33 1324.56,1519.65 1326.91,1409.06 1329.26,1425.59 1331.61,1273.26 1333.96,1604.79 1336.31,1384.52 1338.66,1352.06 1341.02,1487.73 1343.37,1481.9 1345.72,1238.43 1348.07,1308.61 1350.42,1439.74 1352.77,1406.24 1355.12,1606.39 1357.47,1324.95 1359.82,1324.34 1362.17,1381.64 1364.52,1477.15 1366.87,1427.14 1369.22,1365.39 1371.57,1434.75 1373.92,1492.19 1376.27,1407.9 1378.62,1332.76 1380.97,1609.65 1383.32,1565.29 1385.67,1298.72 1388.02,1353.81 1390.38,1390.21 1392.73,1349.6 1395.08,1224.23 1397.43,1489.06 1399.78,1315.27 1402.13,1397.09 1404.48,1503.25 1406.83,1487.71 1409.18,1525.37 1411.53,1293.97 1413.88,1242.27 1416.23,1611.36 1418.58,1390.4 1420.93,1391.91 1423.28,1382.79 1425.63,1310.25 1427.98,1401.52 1430.33,1489.84 1432.68,1453.44 1435.03,1413.72 1437.38,1482.24 1439.74,1300.39 1442.09,1391.14 1444.44,1390.58 1446.79,1345.32 1449.14,1428.16 1451.49,1373.78 1453.84,1379.66 1456.19,1497.47 1458.54,1305.97 1460.89,1398.32 1463.24,1418.49 1465.59,1652.11 1467.94,1415.94 1470.29,1261.39 1472.64,1364.09 1474.99,1516.08 1477.34,1411 1479.69,1365.64 1482.04,1510.05 1484.39,1405.31 1486.74,1440.32 1489.1,1400.14 1491.45,1452.48 1493.8,1656.55 1496.15,1616.32 1498.5,1376.32 1500.85,1456.37 1503.2,1363.54 1505.55,1540.9 1507.9,1439.83 1510.25,1427.25 1512.6,1375.79 1514.95,1440.96 1517.3,1683.28 1519.65,1288.79 1522,1409.41 1524.35,1452.99 1526.7,1570.95 1529.05,1360.42 1531.4,1506.24 1533.75,1280.01 1536.1,1294.45 1538.45,1443.91 1540.81,1501.06 1543.16,1404.09 1545.51,1630.94 1547.86,1347.83 1550.21,1446 1552.56,1313.03 1554.91,1382.71 1557.26,1305.84 1559.61,1309.63 1561.96,1309.1 1564.31,1393.87 1566.66,1427.35 1569.01,1371.8 1571.36,1377.38 1573.71,1370.99 1576.06,1474.93 1578.41,1275.69 1580.76,1335.46 1583.11,1481.3 1585.46,1237.82 1587.81,1355 1590.17,1356.68 1592.52,1393.18 1594.87,1317.62 1597.22,1467.54 1599.57,1524.55 1601.92,1478.61 1604.27,1297.82 1606.62,1393.07 1608.97,1446.15 1611.32,1400.6 1613.67,1452.92 1616.02,1505.11 1618.37,1388.02 1620.72,1307.7 1623.07,1571.11 1625.42,1460.22 1627.77,1420.76 1630.12,1380.83 1632.47,1576.65 1634.82,1338.93 1637.17,1396.8 1639.53,1371.87 1641.88,1526.37 1644.23,1260.08 1646.58,1434.11 1648.93,1416.17 1651.28,1313.03 1653.63,1480.28 1655.98,1322.52 1658.33,1428.26 1660.68,1553.73 1663.03,1473.67 1665.38,1532.15 1667.73,1329.28 1670.08,1555.11 1672.43,1362.77 1674.78,1458.45 1677.13,1305.33 1679.48,1519.61 1681.83,1407.18 1684.18,1438.4 1686.53,1662.88 1688.89,1502.1 1691.24,1372.44 1693.59,1506.59 1695.94,1422.71 1698.29,1374.71 1700.64,1373.5 1702.99,1515.16 1705.34,1536.24 1707.69,1359.1 1710.04,1537.61 1712.39,1374.32 1714.74,1408.12 1717.09,1425.61 1719.44,1277.89 1721.79,1352.24 1724.14,1313.73 1726.49,1424.57 1728.84,1488.39 1731.19,1520.83 1733.54,1353.34 1735.89,1410.09 1738.25,1472.53 1740.6,1540.07 1742.95,1301.25 1745.3,1287.62 1747.65,1379.3 1750,1367 1752.35,1316.03 1754.7,1440.13 1757.05,1521.98 1759.4,1514.27 1761.75,1332.09 1764.1,1662.93 1766.45,1674.64 1768.8,1402.75 1771.15,1458.72 1773.5,1420.95 1775.85,1326.63 1778.2,1423.42 1780.55,1556.27 1782.9,1520.25 1785.25,1381.69 1787.6,1338.58 1789.96,1331.3 1792.31,1484.04 1794.66,1375.97 1797.01,1460.46 1799.36,1562.34 1801.71,1533.49 1804.06,1408.52 1806.41,1575.43 1808.76,1346.87 1811.11,1466.14 1813.46,1468.52 1815.81,1625.9 1818.16,1609.58 1820.51,1564.24 1822.86,1264 1825.21,1396.66 1827.56,1437.77 1829.91,1618.75 1832.26,1703.05 1834.61,1480.09 1836.96,1336.76 1839.32,1299.23 1841.67,1547.49 1844.02,1511.6 1846.37,1410.41 1848.72,1347.12 1851.07,1374.84 1853.42,1547.16 1855.77,1382.39 1858.12,1457.12 1860.47,1248.88 1862.82,1586.34 1865.17,1341.22 1867.52,1461.49 1869.87,1318.52 1872.22,1404.42 1874.57,1245.87 1876.92,1696.33 1879.27,1366.48 1881.62,1339.32 1883.97,1212.18 1886.32,1504.11 1888.68,1414.1 1891.03,1440.78 1893.38,1615.77 1895.73,1568.08 1898.08,1420.07 1900.43,1337.44 1902.78,1306.99 1905.13,1444.58 1907.48,1293.54 1909.83,1426.88 1912.18,1742.64 1914.53,1287.42 1916.88,1533.68 1919.23,1398.24 1921.58,1493.5 1923.93,1541.84 1926.28,1606.78 1928.63,1429.97 1930.98,1415.01 1933.33,1403.66 1935.68,1641.31 1938.04,1452.06 1940.39,1392.81 1942.74,1388.78 1945.09,1533.32 1947.44,1385.21 1949.79,1451.59 1952.14,1462.71 1954.49,1422.61 1956.84,1215.73 1959.19,1239.83 1961.54,1284.07 1963.89,1432.85 1966.24,1487.18 1968.59,1563.4 1970.94,1413.52 1973.29,1502.2 1975.64,1300.68 1977.99,1415.63 1980.34,1247.38 1982.69,1367.64 1985.04,1293.85 1987.4,1278.52 1989.75,1447.95 1992.1,1498.94 1994.45,1397.07 1996.8,1454.72 1999.15,1536.41 2001.5,1553.78 2003.85,1287.4 2006.2,1353.32 2008.55,1187.42 2010.9,1303.66 2013.25,1365.73 2015.6,1425.7 2017.95,1363.07 2020.3,1312.21 2022.65,1346.11 2025,1424.16 2027.35,1565.98 2029.7,1302.32 2032.05,1432.09 2034.4,1251.78 2036.76,1305.76 2039.11,1500.51 2041.46,1443.12 2043.81,1417.52 2046.16,1647.95 2048.51,1463.94 2050.86,1344.42 2053.21,1374.99 2055.56,1369.73 2057.91,1420.74 2060.26,1453.58 2062.61,1389.93 2064.96,1397.49 2067.31,1418.89 2069.66,1473.6 2072.01,1586.97 2074.36,1587.47 2076.71,1412.63 2079.06,1248.23 2081.41,1581.33 2083.76,1350.58 2086.11,1409.94 2088.47,1476.91 2090.82,1684.05 2093.17,1533.34 2095.52,1331.66 2097.87,1428.44 2100.22,1473.73 2102.57,1413.9 2104.92,1564.16 2107.27,1505.93 2109.62,1393.9 2111.97,1495.51 2114.32,1340.26 2116.67,1471.46 2119.02,1423.46 2121.37,1556.68 2123.72,1620.13 2126.07,1463.43 2128.42,1509.62 2130.77,1540.79 2133.12,1319.25 2135.47,1433.94 2137.83,1409.71 2140.18,1283.63 2142.53,1306.74 2144.88,1296.09 2147.23,1349.62 2149.58,1511.17 2151.93,1455.4 2154.28,1465.32 2156.63,1397.84 2158.98,1322.94 2161.33,1261.14 2163.68,1519.16 2166.03,1322.33 2168.38,1366.93 2170.73,1348.05 2173.08,1567.38 2175.43,1412.04 2177.78,1392.38 2180.13,1411.24 2182.48,1379.35 2184.83,1441.48 2187.19,1640.46 2189.54,1427.91 2191.89,1365.71 2194.24,1360.74 2196.59,1407.58 2198.94,1380.4 2201.29,1425.67 2203.64,1265.96 2205.99,1444.57 2208.34,1380.15 2210.69,1547.42 2213.04,1456.22 2215.39,1275.51 2217.74,1650.77 2220.09,1411.05 2222.44,1269.52 2224.79,1305.1 2227.14,1494.49 2229.49,1444.14 2231.84,1599.07 2234.19,1349.48 2236.55,1424.6 2238.9,1336.64 2241.25,1578.7 2243.6,1455.77 2245.95,1434.87 2248.3,1349.43 2250.65,1517 2253,1501.02 2255.35,1405.77 2257.7,1175.94 2260.05,1416 2262.4,1406.82 2264.75,1538.21 2267.1,1408.97 2269.45,1633.64 2271.8,1510 2274.15,1490.39 2276.5,1391.52 2278.85,1476.22 2281.2,1526.94 2283.55,1607.19 2285.91,1363.92 2288.26,1305.05 2290.61,1329.29 2292.96,1396.95 2295.31,1556.74 2297.66,1374.33 2300.01,1294.26 2302.36,1482.94 2304.71,1564.46 2307.06,1416.6 2309.41,1425.97 2311.76,1450.35 2314.11,1214.93 2316.46,1466.84 2318.81,1630.39 2321.16,1460.18 2323.51,1363.85 2325.86,1479.89 2328.21,1431.08 2330.56,1326.08 2332.91,1518.8 2335.27,1338.02 2337.62,1086.49 2339.97,1431.52 2342.32,1430.47 2344.67,1380.49 2347.02,1475.53 2349.37,1324.79 2351.72,1369.5 2354.07,1600.14 2356.42,1435.08 2358.77,1389.12 2361.12,1307.4 2363.47,1290.33 2365.82,1426.54 2368.17,1539.8 2370.52,1336.32 2372.87,1280.7 2375.22,1350.45 2377.57,1445.79 2379.92,1313.82 2382.27,1494.82 2384.62,1373.36 2386.98,1386.93 2389.33,1374.44 2391.68,1393.25 2394.03,1511.65 2396.38,1360.91 2398.73,1430.88 2401.08,1578.98 2403.43,1515 2405.78,1431 2408.13,1590.54 2410.48,1345.05 2412.83,1465.88 2415.18,1430.21 2417.53,1327.23 2419.88,1425.08 2422.23,1599.02 2424.58,1588.44 2426.93,1439.14 2429.28,1506.33 2431.63,1478.69 2433.98,1247.31 2436.34,1480.03 2438.69,1501.63 2441.04,1483.64 2443.39,1575.09 2445.74,1354.12 2448.09,1473.47 2450.44,1438.94 2452.79,1199.06 2455.14,1489.79 2457.49,1474.68 2459.84,1467.73 2462.19,1367.5 2464.54,1527.71 2466.89,1504.74 2469.24,1515.08 2471.59,1426.99 2473.94,1367.34 2476.29,1550.74 2478.64,1344.92 2480.99,1436.64 2483.34,1421.37 2485.7,1397.71 2488.05,1536.91 2490.4,1455.6 2492.75,1162.76 2495.1,1405.6 2497.45,1323.55 2499.8,1279.99 2502.15,1468.26 2504.5,1379.4 2506.85,1250.43 2509.2,1256.7 2511.55,1407.75 2513.9,1499.87 2516.25,1698.28 2518.6,1487.16 2520.95,1457.65 2523.3,1354.93 2525.65,1402.21 2528,1504.73 2530.35,1455.81 2532.7,1545.05 2535.06,1560.09 2537.41,1494.94 2539.76,1393.6 2542.11,1389.29 2544.46,1380.32 2546.81,1318.15 2549.16,1484.39 2551.51,1492.45 2553.86,1479.22 2556.21,1442.94 2558.56,1358.48 2560.91,1499.71 2563.26,1267.27 2565.61,1318.36 2567.96,1348.91 2570.31,1328.04 "></polyline>
<polyline clip-path="url(#clip942)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,801.23 224.541,967.959 226.891,886.32 229.242,892.655 231.592,857.927 233.943,798.912 236.293,982.954 238.644,838.73 240.994,1076.94 243.345,817.038 245.695,863.835 248.046,1028.18 250.396,977.753 252.747,978.557 255.097,823.205 257.448,975.696 259.798,940.36 262.148,994.762 264.499,873.032 266.849,653.298 269.2,822.45 271.55,1067.98 273.901,1038.89 276.251,1128.39 278.602,1059.65 280.952,843.682 283.303,888.815 285.653,753.449 288.004,835.603 290.354,1056.66 292.705,1022.76 295.055,826.816 297.406,701.997 299.756,942.566 302.107,878.411 304.457,964.292 306.807,976.842 309.158,921.395 311.508,1032.3 313.859,777.38 316.209,868.391 318.56,774.846 320.91,996.622 323.261,786.99 325.611,856.583 327.962,899.761 330.312,772.667 332.663,898.241 335.013,935.203 337.364,858.277 339.714,932.362 342.065,885.357 344.415,1086.31 346.765,829.935 349.116,733.304 351.466,1077.57 353.817,1068.06 356.167,897.181 358.518,766.39 360.868,977.94 363.219,1105.45 365.569,986.314 367.92,706.632 370.27,976.679 372.621,937.866 374.971,913.465 377.322,916.373 379.672,961.379 382.023,1010.76 384.373,890.162 386.724,849.588 389.074,903.765 391.424,850.379 393.775,707.626 396.125,918.462 398.476,907.22 400.826,806.684 403.177,902.777 405.527,944.364 407.878,968.14 410.228,944.645 412.579,935.874 414.929,896.923 417.28,922.244 419.63,919.119 421.981,939.933 424.331,1021.67 426.682,967.599 429.032,701.803 431.382,967.156 433.733,998.478 436.083,890.168 438.434,858.616 440.784,886.923 443.135,952.756 445.485,1026.15 447.836,969.276 450.186,827.001 452.537,861.242 454.887,809.097 457.238,939.701 459.588,1027.38 461.939,723.004 464.289,806.429 466.64,991.774 468.99,898.856 471.341,904.573 473.691,897.552 476.041,934.406 478.392,1056.36 480.742,965.196 483.093,835.088 485.443,969.705 487.794,838.049 490.144,895.656 492.495,870.942 494.845,874.044 497.196,1133.94 499.546,1048.69 501.897,1023.97 504.247,941.615 506.598,1048.7 508.948,866.444 511.299,889.029 513.649,923.984 515.999,943.314 518.35,916.33 520.7,810.542 523.051,903.287 525.401,961.095 527.752,1006.21 530.102,834.841 532.453,963.24 534.803,953.366 537.154,613.11 539.504,916.702 541.855,1014.98 544.205,755.122 546.556,675.426 548.906,1019.14 551.257,914.038 553.607,1034.49 555.958,922.34 558.308,910.276 560.658,859.991 563.009,1109.32 565.359,819.253 567.71,1023.25 570.06,1083.43 572.411,1062.31 574.761,981.379 577.112,978.238 579.462,849.045 581.813,697.816 584.163,1050.21 586.514,1062.73 588.864,751.96 591.215,883.041 593.565,976.344 595.916,753.518 598.266,972.189 600.616,901.677 602.967,788.3 605.317,988.944 607.668,845.151 610.018,925.22 612.369,911.8 614.719,771.606 617.07,1030.24 619.42,841.772 621.771,940.017 624.121,1057.77 626.472,764.52 628.822,960.109 631.173,770.749 633.523,1055.92 635.874,909.113 638.224,1003.28 640.575,747.544 642.925,841.61 645.275,749.383 647.626,1069.68 649.976,1060.97 652.327,912.066 654.677,932.312 657.028,1054.59 659.378,892.24 661.729,837.912 664.079,739.054 666.43,901.552 668.78,887.321 671.131,963.414 673.481,759.444 675.832,899.198 678.182,1011.78 680.533,874.652 682.883,1044.48 685.233,807.363 687.584,930.037 689.934,904.741 692.285,607.437 694.635,756.352 696.986,935.461 699.336,1065.31 701.687,835.047 704.037,881.02 706.388,807.069 708.738,898.347 711.089,892.904 713.439,947.463 715.79,823.53 718.14,960.039 720.491,747.007 722.841,971.476 725.192,927.012 727.542,990.633 729.892,1030.81 732.243,837.003 734.593,1078.62 736.944,979.439 739.294,1094.2 741.645,998.348 743.995,930.351 746.346,744.921 748.696,916.88 751.047,911.24 753.397,868.038 755.748,858.169 758.098,887.31 760.449,993.584 762.799,934.209 765.15,948.162 767.5,927.479 769.85,931.578 772.201,938.601 774.551,1105.61 776.902,1042.6 779.252,826.038 781.603,889.352 783.953,920.236 786.304,812.261 788.654,905.215 791.005,891.93 793.355,1069.28 795.706,813.247 798.056,1023.83 800.407,856.192 802.757,894.326 805.108,805.987 807.458,977.799 809.809,826.979 812.159,1078.09 814.509,731.269 816.86,885.703 819.21,920.824 821.561,879.002 823.911,990.315 826.262,875.703 828.612,804.469 830.963,932.309 833.313,974.261 835.664,803.94 838.014,837.041 840.365,949.671 842.715,863.282 845.066,829.203 847.416,755.993 849.767,837.473 852.117,952.398 854.467,893.575 856.818,808.194 859.168,992.398 861.519,1044.25 863.869,921.512 866.22,866.901 868.57,1019.37 870.921,791.406 873.271,855.161 875.622,659.174 877.972,916.598 880.323,1192.79 882.673,991.945 885.024,984.645 887.374,930.483 889.725,903.285 892.075,895.631 894.426,926.09 896.776,852.096 899.126,1090.79 901.477,959.432 903.827,910.705 906.178,902.648 908.528,961.446 910.879,844.375 913.229,1011.63 915.58,947.472 917.93,961.995 920.281,927.734 922.631,954.579 924.982,769.798 927.332,785.819 929.683,884.6 932.033,869.06 934.384,1038.45 936.734,890.957 939.084,1002.5 941.435,893.654 943.785,828.524 946.136,865.059 948.486,993.101 950.837,853.879 953.187,1042.47 955.538,986.575 957.888,965.524 960.239,769.063 962.589,879.535 964.94,1054.47 967.29,1091.31 969.641,1052.06 971.991,868.285 974.342,1010.39 976.692,764.102 979.043,960.424 981.393,935.848 983.743,990.816 986.094,934.66 988.444,1004.98 990.795,983.205 993.145,968.351 995.496,1015.52 997.846,915.587 1000.2,909.04 1002.55,1001.55 1004.9,882.706 1007.25,1017.61 1009.6,869.013 1011.95,776.378 1014.3,837.792 1016.65,930.582 1019,1039.03 1021.35,968.428 1023.7,948.965 1026.05,1004.37 1028.4,899.8 1030.75,1067.77 1033.1,890.412 1035.45,767.234 1037.8,985.815 1040.15,990.461 1042.51,895.117 1044.86,970.42 1047.21,1056.71 1049.56,983.747 1051.91,845.225 1054.26,1095.77 1056.61,1000.21 1058.96,912.014 1061.31,777.215 1063.66,1055.28 1066.01,1001.63 1068.36,1021.29 1070.71,1036.03 1073.06,870.493 1075.41,881.351 1077.76,885.661 1080.11,915.205 1082.46,700.307 1084.81,820.633 1087.16,864.687 1089.51,911.379 1091.87,936.771 1094.22,883.632 1096.57,970.795 1098.92,716.368 1101.27,1053.85 1103.62,1162 1105.97,904.846 1108.32,916.038 1110.67,615.272 1113.02,807.469 1115.37,855.816 1117.72,872.121 1120.07,1046.85 1122.42,993.599 1124.77,936.677 1127.12,961.759 1129.47,807.221 1131.82,705.81 1134.17,901.233 1136.52,894.468 1138.87,919.393 1141.23,929.228 1143.58,975.042 1145.93,961.892 1148.28,707.136 1150.63,758.997 1152.98,803.458 1155.33,981.157 1157.68,882.852 1160.03,971.427 1162.38,1072.54 1164.73,722.983 1167.08,1016.08 1169.43,860.648 1171.78,1083.72 1174.13,1017.27 1176.48,905.058 1178.83,1056.61 1181.18,879.552 1183.53,851.493 1185.88,1059.09 1188.23,889.827 1190.59,937.241 1192.94,928.288 1195.29,746.756 1197.64,781.246 1199.99,941.861 1202.34,1146.69 1204.69,986.179 1207.04,940.969 1209.39,763.798 1211.74,856.88 1214.09,916.474 1216.44,1153.86 1218.79,878.124 1221.14,980.492 1223.49,987.709 1225.84,944.021 1228.19,929.991 1230.54,878.501 1232.89,906.618 1235.24,937.775 1237.59,905.327 1239.94,677.533 1242.3,849.712 1244.65,788.095 1247,1074.87 1249.35,913.471 1251.7,974.833 1254.05,881.301 1256.4,797.014 1258.75,904.375 1261.1,1073.74 1263.45,906.704 1265.8,849.251 1268.15,988.541 1270.5,953.659 1272.85,952.635 1275.2,790.204 1277.55,858.367 1279.9,1105.06 1282.25,865.254 1284.6,1056.04 1286.95,1065.59 1289.3,855.574 1291.66,787.989 1294.01,791.983 1296.36,809.427 1298.71,868.534 1301.06,1047.81 1303.41,919.568 1305.76,927.783 1308.11,886.794 1310.46,804.508 1312.81,834.919 1315.16,757.425 1317.51,1017.95 1319.86,970.503 1322.21,912.225 1324.56,959.018 1326.91,999.103 1329.26,804.441 1331.61,958.054 1333.96,960.702 1336.31,1014.8 1338.66,1173.98 1341.02,960.317 1343.37,825.325 1345.72,845.069 1348.07,950.965 1350.42,879.776 1352.77,1052.8 1355.12,1014.98 1357.47,942.876 1359.82,882.97 1362.17,838.814 1364.52,917.797 1366.87,709.473 1369.22,1077.18 1371.57,1007.5 1373.92,794.987 1376.27,1023.28 1378.62,823.834 1380.97,933.192 1383.32,916.103 1385.67,887.398 1388.02,932.765 1390.38,927.324 1392.73,829.179 1395.08,870.196 1397.43,875.268 1399.78,828.606 1402.13,1004.59 1404.48,864.052 1406.83,1115.2 1409.18,868.264 1411.53,916.61 1413.88,1066.24 1416.23,868.244 1418.58,1114.57 1420.93,1060.95 1423.28,975.979 1425.63,904.967 1427.98,888.656 1430.33,890.364 1432.68,869.135 1435.03,1099.22 1437.38,969.264 1439.74,981.267 1442.09,936.803 1444.44,848.728 1446.79,913.167 1449.14,916.552 1451.49,746.053 1453.84,1001.57 1456.19,826.269 1458.54,819.765 1460.89,795.612 1463.24,889.747 1465.59,731.977 1467.94,924.469 1470.29,895.096 1472.64,1127.5 1474.99,1255.12 1477.34,895.286 1479.69,961.179 1482.04,885.315 1484.39,803.927 1486.74,855.898 1489.1,739.686 1491.45,752.297 1493.8,960.846 1496.15,1066.36 1498.5,963.665 1500.85,823.609 1503.2,960.651 1505.55,932.13 1507.9,913.865 1510.25,1008.96 1512.6,992.824 1514.95,1030.5 1517.3,1113.65 1519.65,783.189 1522,749.234 1524.35,895.676 1526.7,936.85 1529.05,888.382 1531.4,1149.88 1533.75,959.715 1536.1,927.778 1538.45,941.128 1540.81,921.239 1543.16,967.962 1545.51,734.079 1547.86,1021.6 1550.21,1079.03 1552.56,781.716 1554.91,837.196 1557.26,879.902 1559.61,982.158 1561.96,940.991 1564.31,815.815 1566.66,954.64 1569.01,1022.63 1571.36,1004.31 1573.71,800.749 1576.06,912.848 1578.41,933.923 1580.76,925.924 1583.11,1028.79 1585.46,943.837 1587.81,1106.36 1590.17,942.707 1592.52,791.501 1594.87,929.258 1597.22,878.105 1599.57,919.107 1601.92,914.798 1604.27,867.646 1606.62,906.414 1608.97,899.425 1611.32,913.644 1613.67,996.504 1616.02,788.271 1618.37,864.01 1620.72,895.389 1623.07,776.261 1625.42,875.81 1627.77,882.306 1630.12,1043.79 1632.47,1135.33 1634.82,973.221 1637.17,880.531 1639.53,1091.87 1641.88,1001.29 1644.23,1019.54 1646.58,842.987 1648.93,809.356 1651.28,1036.41 1653.63,1123.35 1655.98,893.617 1658.33,929.232 1660.68,1137.06 1663.03,962.763 1665.38,665.259 1667.73,1005.01 1670.08,938.716 1672.43,648.587 1674.78,901.493 1677.13,927.871 1679.48,935.152 1681.83,879.816 1684.18,914.095 1686.53,1000.53 1688.89,778.848 1691.24,883.319 1693.59,996.386 1695.94,936.027 1698.29,814.05 1700.64,864.957 1702.99,940.587 1705.34,910.403 1707.69,862.076 1710.04,917.292 1712.39,990.635 1714.74,746.721 1717.09,1038.17 1719.44,989.774 1721.79,975.684 1724.14,897.425 1726.49,957.061 1728.84,862.989 1731.19,900.791 1733.54,1154.37 1735.89,941.303 1738.25,862.865 1740.6,945.965 1742.95,951.008 1745.3,796.826 1747.65,1026.89 1750,823.807 1752.35,1005.74 1754.7,710.082 1757.05,1026.95 1759.4,1019.72 1761.75,780.628 1764.1,894.073 1766.45,950.926 1768.8,1070.12 1771.15,1061.92 1773.5,974.7 1775.85,1080.86 1778.2,897.942 1780.55,785.144 1782.9,874.135 1785.25,1055.24 1787.6,938.258 1789.96,866.212 1792.31,831.925 1794.66,891.602 1797.01,958.494 1799.36,1132.43 1801.71,850.558 1804.06,909.506 1806.41,842.721 1808.76,826.052 1811.11,799.959 1813.46,953.332 1815.81,1012.91 1818.16,884.936 1820.51,793.739 1822.86,764.967 1825.21,1040.45 1827.56,898.043 1829.91,868.613 1832.26,1121.18 1834.61,973.718 1836.96,845.665 1839.32,709.771 1841.67,717.737 1844.02,980.97 1846.37,948.489 1848.72,816.877 1851.07,999.587 1853.42,754.977 1855.77,1013.39 1858.12,983.307 1860.47,751.413 1862.82,939.808 1865.17,902.802 1867.52,864.404 1869.87,815.893 1872.22,1052.56 1874.57,958.68 1876.92,801.042 1879.27,828.769 1881.62,862.92 1883.97,1027.29 1886.32,864.079 1888.68,866.702 1891.03,850.9 1893.38,1103.48 1895.73,916.89 1898.08,968.366 1900.43,812.004 1902.78,937.132 1905.13,915.683 1907.48,912.483 1909.83,993.856 1912.18,938.094 1914.53,786.81 1916.88,834.398 1919.23,973.366 1921.58,993.339 1923.93,1042.51 1926.28,937.138 1928.63,968.725 1930.98,1078.29 1933.33,1108.71 1935.68,753.522 1938.04,824.34 1940.39,887.661 1942.74,913.607 1945.09,1036.24 1947.44,937.072 1949.79,971.885 1952.14,1037.35 1954.49,878.024 1956.84,1175.79 1959.19,1024.23 1961.54,990.927 1963.89,826.469 1966.24,670.243 1968.59,817.233 1970.94,961.537 1973.29,966.885 1975.64,869.098 1977.99,956.504 1980.34,1025 1982.69,891.898 1985.04,942.265 1987.4,931.604 1989.75,858.772 1992.1,940.651 1994.45,928.449 1996.8,992.43 1999.15,756.103 2001.5,754.506 2003.85,1127.7 2006.2,933.342 2008.55,900.554 2010.9,955.977 2013.25,828.103 2015.6,842.803 2017.95,895.736 2020.3,894.797 2022.65,814.228 2025,922.785 2027.35,1001.2 2029.7,851.41 2032.05,1022.91 2034.4,947.506 2036.76,916.867 2039.11,887.603 2041.46,928.623 2043.81,980.212 2046.16,895.657 2048.51,835.956 2050.86,1070.43 2053.21,828.942 2055.56,855.166 2057.91,1064.76 2060.26,1032.19 2062.61,1067.64 2064.96,1040.81 2067.31,845.374 2069.66,716.23 2072.01,667.201 2074.36,739.112 2076.71,767.825 2079.06,953.042 2081.41,848.868 2083.76,1042.59 2086.11,939.25 2088.47,928.292 2090.82,867.646 2093.17,1124.39 2095.52,950.257 2097.87,1135.2 2100.22,1141.51 2102.57,990.508 2104.92,888.498 2107.27,836.506 2109.62,729.533 2111.97,841.932 2114.32,953.447 2116.67,903.991 2119.02,874.996 2121.37,958.894 2123.72,988.094 2126.07,987.757 2128.42,1078.88 2130.77,915.349 2133.12,910.654 2135.47,1085.95 2137.83,1100.96 2140.18,961.22 2142.53,717.668 2144.88,825.719 2147.23,864.368 2149.58,803.987 2151.93,888.738 2154.28,1036.27 2156.63,1008.18 2158.98,994.577 2161.33,936.268 2163.68,945.912 2166.03,828.098 2168.38,970.546 2170.73,923.783 2173.08,868.343 2175.43,873.248 2177.78,985.385 2180.13,1000.35 2182.48,1073.33 2184.83,927.221 2187.19,912.214 2189.54,1017.71 2191.89,838.301 2194.24,906.941 2196.59,1112.05 2198.94,946.351 2201.29,1034.18 2203.64,866.204 2205.99,1016.22 2208.34,813.848 2210.69,997.016 2213.04,911.594 2215.39,913.679 2217.74,938.952 2220.09,813.364 2222.44,758.602 2224.79,955.434 2227.14,978.995 2229.49,949.395 2231.84,766.445 2234.19,1028.85 2236.55,874.66 2238.9,948.374 2241.25,954.633 2243.6,948.417 2245.95,1032.95 2248.3,1060.85 2250.65,829.039 2253,993.701 2255.35,763.853 2257.7,975.701 2260.05,1031.53 2262.4,915.498 2264.75,876.294 2267.1,848.515 2269.45,826.489 2271.8,811.697 2274.15,972.764 2276.5,1264.79 2278.85,1082.93 2281.2,917.346 2283.55,785.123 2285.91,1127.98 2288.26,779.422 2290.61,981.505 2292.96,996.301 2295.31,1008.97 2297.66,1015.48 2300.01,982.805 2302.36,911.275 2304.71,956.933 2307.06,772.22 2309.41,780.609 2311.76,1067.91 2314.11,969.456 2316.46,944.869 2318.81,955.737 2321.16,886.961 2323.51,1046.54 2325.86,814.173 2328.21,812.062 2330.56,756.768 2332.91,1011.43 2335.27,973.92 2337.62,965.951 2339.97,977.947 2342.32,780.337 2344.67,732.197 2347.02,976.702 2349.37,790.313 2351.72,875.835 2354.07,828.624 2356.42,861.676 2358.77,867.465 2361.12,920.462 2363.47,992.746 2365.82,1026.61 2368.17,833.219 2370.52,811.531 2372.87,835.143 2375.22,779.25 2377.57,928.946 2379.92,849.343 2382.27,845.649 2384.62,889.517 2386.98,860.335 2389.33,959.092 2391.68,1126.69 2394.03,1044.38 2396.38,981.198 2398.73,873.741 2401.08,684.553 2403.43,942.055 2405.78,1011.57 2408.13,796.339 2410.48,884.319 2412.83,1054.16 2415.18,959.076 2417.53,1000.74 2419.88,1053.52 2422.23,628.925 2424.58,797.441 2426.93,888.34 2429.28,980.151 2431.63,758.927 2433.98,718.384 2436.34,984.54 2438.69,1002.43 2441.04,894.878 2443.39,899.176 2445.74,901.086 2448.09,969.296 2450.44,817.582 2452.79,900.001 2455.14,913.951 2457.49,975.039 2459.84,783.049 2462.19,753.276 2464.54,814.319 2466.89,868.209 2469.24,845.203 2471.59,1026.62 2473.94,829.223 2476.29,822.276 2478.64,950.885 2480.99,848.073 2483.34,807.879 2485.7,930.316 2488.05,883.399 2490.4,993.632 2492.75,1026.42 2495.1,830.232 2497.45,1088.47 2499.8,904.547 2502.15,902.466 2504.5,1021.95 2506.85,915.328 2509.2,1002.89 2511.55,996.501 2513.9,725.862 2516.25,876.119 2518.6,884.869 2520.95,1098.02 2523.3,1074.45 2525.65,986.589 2528,888.837 2530.35,753.485 2532.7,1086.72 2535.06,842.512 2537.41,916.117 2539.76,965.61 2542.11,793.862 2544.46,1029.92 2546.81,972.172 2549.16,1096.71 2551.51,1068.92 2553.86,811.826 2556.21,1007.67 2558.56,1028.06 2560.91,938.075 2563.26,922.347 2565.61,991.85 2567.96,1095.26 2570.31,814.911 "></polyline>
<polyline clip-path="url(#clip942)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,727.727 224.541,334.332 226.891,311.144 229.242,471.31 231.592,296.524 233.943,208.79 236.293,344.106 238.644,464.358 240.994,487.255 243.345,463.617 245.695,491.302 248.046,195.997 250.396,302.9 252.747,279.488 255.097,375.748 257.448,513.352 259.798,318.796 262.148,466.201 264.499,400.039 266.849,393.363 269.2,585.285 271.55,475.917 273.901,290.44 276.251,484.518 278.602,223.096 280.952,376.691 283.303,352.247 285.653,485.772 288.004,259.965 290.354,327.905 292.705,499.095 295.055,447.462 297.406,505.319 299.756,239.513 302.107,453.095 304.457,373.519 306.807,473.511 309.158,631.189 311.508,341.284 313.859,544.074 316.209,454.69 318.56,225.03 320.91,466.874 323.261,260.908 325.611,433.225 327.962,640.907 330.312,436.699 332.663,444.511 335.013,286.092 337.364,401.33 339.714,476.232 342.065,305.657 344.415,395.757 346.765,327.209 349.116,464.414 351.466,474.131 353.817,247.155 356.167,501.177 358.518,320.937 360.868,387.604 363.219,517.317 365.569,407.965 367.92,492.604 370.27,400.575 372.621,401.763 374.971,303.912 377.322,472.202 379.672,506.893 382.023,297.271 384.373,353.746 386.724,501.725 389.074,337.234 391.424,578.338 393.775,607.781 396.125,141.125 398.476,260.599 400.826,327.8 403.177,279.539 405.527,498.547 407.878,478.107 410.228,531.706 412.579,401.891 414.929,260.829 417.28,382.42 419.63,430.664 421.981,393.423 424.331,375.317 426.682,364.955 429.032,472.424 431.382,438.7 433.733,483.13 436.083,356.911 438.434,336.822 440.784,478.817 443.135,511.755 445.485,378.647 447.836,352.98 450.186,462.999 452.537,492.415 454.887,419.926 457.238,272.445 459.588,384.964 461.939,353.883 464.289,293.548 466.64,342.566 468.99,327.098 471.341,559.766 473.691,468.292 476.041,354.174 478.392,343.249 480.742,489.359 483.093,432.665 485.443,298.855 487.794,503.792 490.144,416.497 492.495,430.074 494.845,389.645 497.196,513.247 499.546,527.377 501.897,396.56 504.247,468.676 506.598,458.065 508.948,366.144 511.299,180.441 513.649,363.92 515.999,416.675 518.35,305.131 520.7,257.604 523.051,247.855 525.401,406.307 527.752,359.552 530.102,415.895 532.453,457.786 534.803,347.926 537.154,543.516 539.504,583.615 541.855,159.604 544.205,491.933 546.556,455.248 548.906,364.869 551.257,382.799 553.607,300.462 555.958,362.917 558.308,401.378 560.658,299.227 563.009,511.077 565.359,348.126 567.71,385.12 570.06,392.519 572.411,610.845 574.761,159.001 577.112,571.832 579.462,507.838 581.813,451.136 584.163,371.148 586.514,399.161 588.864,260.313 591.215,456.188 593.565,433.44 595.916,561.838 598.266,278.379 600.616,371.725 602.967,261.39 605.317,584.665 607.668,361.712 610.018,478.548 612.369,505.469 614.719,368.324 617.07,495.458 619.42,554.127 621.771,404.819 624.121,674.932 626.472,552.578 628.822,539.076 631.173,443.804 633.523,556.072 635.874,438.687 638.224,360.543 640.575,490.34 642.925,348.304 645.275,416.101 647.626,587.202 649.976,476.587 652.327,442.283 654.677,422.451 657.028,266.989 659.378,360.475 661.729,211.441 664.079,467.585 666.43,575.673 668.78,422.033 671.131,284.177 673.481,355.631 675.832,316.75 678.182,412.012 680.533,562.04 682.883,344.46 685.233,543.103 687.584,385.089 689.934,265.241 692.285,555.141 694.635,418.019 696.986,430.907 699.336,394.083 701.687,487.025 704.037,354.439 706.388,188.234 708.738,411.34 711.089,396.346 713.439,304.198 715.79,469.436 718.14,495.074 720.491,422.009 722.841,240.481 725.192,210.084 727.542,470.155 729.892,430.133 732.243,215.784 734.593,311.92 736.944,475.765 739.294,351.358 741.645,400.973 743.995,292.863 746.346,290.562 748.696,519.09 751.047,417.315 753.397,401.87 755.748,399.773 758.098,392.816 760.449,559.791 762.799,371.407 765.15,427.953 767.5,389.174 769.85,312.107 772.201,489.652 774.551,435.327 776.902,538.618 779.252,355.248 781.603,346.547 783.953,476.531 786.304,403.678 788.654,474.939 791.005,286.704 793.355,412.843 795.706,548.367 798.056,366.14 800.407,269.164 802.757,168.394 805.108,279.617 807.458,403.654 809.809,418.868 812.159,387.465 814.509,474.545 816.86,557.967 819.21,363.444 821.561,499.49 823.911,295.816 826.262,489.034 828.612,272.753 830.963,488.482 833.313,214.807 835.664,480.531 838.014,295.575 840.365,377.688 842.715,500.432 845.066,334.698 847.416,447.005 849.767,447.012 852.117,334.802 854.467,549.815 856.818,196.583 859.168,528.912 861.519,343.112 863.869,415.507 866.22,431.254 868.57,380.243 870.921,637.654 873.271,461.44 875.622,338.335 877.972,143.257 880.323,474.055 882.673,473.072 885.024,423.838 887.374,409.18 889.725,381.551 892.075,362.739 894.426,347.556 896.776,379.573 899.126,405.493 901.477,238.845 903.827,401.855 906.178,391.153 908.528,529.594 910.879,287.001 913.229,575.833 915.58,403.227 917.93,365.472 920.281,622.161 922.631,181.851 924.982,474.678 927.332,424.156 929.683,342.109 932.033,378.294 934.384,299.294 936.734,345.478 939.084,288.384 941.435,451.264 943.785,384.945 946.136,521.186 948.486,490.812 950.837,156.406 953.187,439.19 955.538,407.426 957.888,189.257 960.239,565.421 962.589,225.596 964.94,282.669 967.29,447.19 969.641,421.544 971.991,246.069 974.342,490.907 976.692,476.776 979.043,493.23 981.393,393.736 983.743,489.163 986.094,379.857 988.444,326.992 990.795,524.81 993.145,365.859 995.496,249.786 997.846,467.205 1000.2,322.805 1002.55,424.19 1004.9,492.173 1007.25,357.817 1009.6,497.018 1011.95,458.161 1014.3,557.646 1016.65,509.532 1019,239.029 1021.35,236.67 1023.7,381.017 1026.05,583.944 1028.4,437.916 1030.75,446.722 1033.1,455.632 1035.45,496.5 1037.8,536.315 1040.15,611.596 1042.51,473.278 1044.86,276.106 1047.21,600.158 1049.56,346.82 1051.91,271.592 1054.26,360.249 1056.61,281.948 1058.96,331.403 1061.31,508.628 1063.66,269.031 1066.01,265.178 1068.36,388.107 1070.71,455.117 1073.06,465.186 1075.41,324.721 1077.76,360.265 1080.11,403.171 1082.46,367.096 1084.81,287.727 1087.16,459.347 1089.51,421.855 1091.87,437.867 1094.22,271.863 1096.57,440.68 1098.92,609.526 1101.27,477.937 1103.62,339.904 1105.97,451.829 1108.32,421.32 1110.67,432.204 1113.02,512.508 1115.37,400.984 1117.72,358.488 1120.07,531.69 1122.42,461.449 1124.77,494.068 1127.12,411.689 1129.47,328.379 1131.82,472.656 1134.17,465.035 1136.52,392.185 1138.87,482.263 1141.23,355.55 1143.58,349.548 1145.93,497.563 1148.28,261.331 1150.63,341.288 1152.98,450.931 1155.33,371.909 1157.68,264.116 1160.03,525.953 1162.38,255.453 1164.73,518.905 1167.08,503.685 1169.43,559.388 1171.78,351.709 1174.13,400.475 1176.48,478.341 1178.83,434.709 1181.18,382.743 1183.53,370.548 1185.88,401.02 1188.23,379.967 1190.59,403.802 1192.94,335.138 1195.29,512.937 1197.64,289.374 1199.99,572.389 1202.34,573.74 1204.69,308.525 1207.04,581.245 1209.39,395.474 1211.74,397.553 1214.09,471.322 1216.44,367.459 1218.79,336.41 1221.14,530.985 1223.49,348.51 1225.84,311.238 1228.19,458.127 1230.54,271.619 1232.89,291.115 1235.24,449.52 1237.59,568.188 1239.94,444.554 1242.3,382.177 1244.65,449.074 1247,361.495 1249.35,408.932 1251.7,355.429 1254.05,391.331 1256.4,474.654 1258.75,648.779 1261.1,560.529 1263.45,443.356 1265.8,362.813 1268.15,392.001 1270.5,404.64 1272.85,588.415 1275.2,427.009 1277.55,455.478 1279.9,562.036 1282.25,358.593 1284.6,358.615 1286.95,242.033 1289.3,254.499 1291.66,546.713 1294.01,469.888 1296.36,501.907 1298.71,153.462 1301.06,457.181 1303.41,400.227 1305.76,486.21 1308.11,356.755 1310.46,285.927 1312.81,603.214 1315.16,375.695 1317.51,328.383 1319.86,457.959 1322.21,656.178 1324.56,465.963 1326.91,503.232 1329.26,252.848 1331.61,391.501 1333.96,498.326 1336.31,607.719 1338.66,416.257 1341.02,404.574 1343.37,349.955 1345.72,413.05 1348.07,127.517 1350.42,439.746 1352.77,359.572 1355.12,451.818 1357.47,344.706 1359.82,458.749 1362.17,324.02 1364.52,394.223 1366.87,393.962 1369.22,460.886 1371.57,407.156 1373.92,544.023 1376.27,421.989 1378.62,427.84 1380.97,364.643 1383.32,489.923 1385.67,322.868 1388.02,367.114 1390.38,530.977 1392.73,446.403 1395.08,497.336 1397.43,523.346 1399.78,284.58 1402.13,538.151 1404.48,346.416 1406.83,483.847 1409.18,344.761 1411.53,383.185 1413.88,458.058 1416.23,506.888 1418.58,554.044 1420.93,367.152 1423.28,307.371 1425.63,312.427 1427.98,416.62 1430.33,349.079 1432.68,258.183 1435.03,270.569 1437.38,375.934 1439.74,463.637 1442.09,254.336 1444.44,336.951 1446.79,426.624 1449.14,502.061 1451.49,234.908 1453.84,317.411 1456.19,330.903 1458.54,293.646 1460.89,341.046 1463.24,251.362 1465.59,391.454 1467.94,434.228 1470.29,521.117 1472.64,212.394 1474.99,475.413 1477.34,457.969 1479.69,598.427 1482.04,391.25 1484.39,611.752 1486.74,501.996 1489.1,396.431 1491.45,484.85 1493.8,363.209 1496.15,381.556 1498.5,473.952 1500.85,458.192 1503.2,628.283 1505.55,407.694 1507.9,460.391 1510.25,391.442 1512.6,301.601 1514.95,480.674 1517.3,487.918 1519.65,484.662 1522,423.68 1524.35,358.362 1526.7,461.518 1529.05,312.298 1531.4,566.346 1533.75,382.147 1536.1,339.332 1538.45,451.128 1540.81,270.784 1543.16,467.663 1545.51,472.909 1547.86,418.56 1550.21,423.718 1552.56,290.802 1554.91,343.257 1557.26,440.359 1559.61,575.921 1561.96,311.437 1564.31,414.281 1566.66,560.162 1569.01,569.17 1571.36,608.277 1573.71,359.249 1576.06,486.702 1578.41,275.41 1580.76,406.408 1583.11,379.93 1585.46,549.833 1587.81,407.046 1590.17,440.107 1592.52,530.602 1594.87,428.797 1597.22,400.335 1599.57,323.931 1601.92,342.932 1604.27,472.068 1606.62,184.119 1608.97,384.436 1611.32,507.238 1613.67,342.665 1616.02,276.914 1618.37,400.981 1620.72,313.193 1623.07,395.051 1625.42,331.24 1627.77,366.136 1630.12,410.144 1632.47,552.688 1634.82,485.973 1637.17,405.787 1639.53,579.025 1641.88,326.63 1644.23,374.309 1646.58,406.135 1648.93,331.152 1651.28,423.705 1653.63,431.837 1655.98,425.029 1658.33,349.01 1660.68,317.854 1663.03,578.377 1665.38,393.981 1667.73,467.87 1670.08,580.266 1672.43,440.472 1674.78,317.212 1677.13,379.539 1679.48,423.495 1681.83,429.489 1684.18,306.341 1686.53,354.018 1688.89,413.717 1691.24,420.409 1693.59,490.04 1695.94,310.362 1698.29,544.581 1700.64,583.663 1702.99,278.768 1705.34,522.76 1707.69,290.026 1710.04,480.164 1712.39,547.731 1714.74,359.491 1717.09,365.749 1719.44,420.889 1721.79,605.126 1724.14,575.16 1726.49,471.682 1728.84,300.899 1731.19,480.958 1733.54,409.641 1735.89,479.958 1738.25,487.236 1740.6,510.504 1742.95,316.043 1745.3,374.517 1747.65,471.048 1750,418.212 1752.35,335.85 1754.7,492.824 1757.05,510.642 1759.4,327.982 1761.75,304.716 1764.1,421.808 1766.45,286.925 1768.8,403.155 1771.15,534.474 1773.5,332.878 1775.85,431.527 1778.2,288.221 1780.55,343.467 1782.9,439.902 1785.25,435.117 1787.6,329.108 1789.96,409.302 1792.31,524.861 1794.66,688.176 1797.01,515.856 1799.36,360.112 1801.71,549.17 1804.06,188.256 1806.41,396.253 1808.76,356.253 1811.11,377.248 1813.46,333.509 1815.81,405.737 1818.16,334.755 1820.51,420.037 1822.86,546.426 1825.21,364.933 1827.56,586.801 1829.91,407.995 1832.26,170.144 1834.61,432.891 1836.96,432.36 1839.32,402.447 1841.67,325.769 1844.02,234.089 1846.37,356.448 1848.72,237.112 1851.07,340.265 1853.42,611.168 1855.77,287.286 1858.12,96.8724 1860.47,272.832 1862.82,362.697 1865.17,442.054 1867.52,374.386 1869.87,520.026 1872.22,372.753 1874.57,355.775 1876.92,426.547 1879.27,273.289 1881.62,102.391 1883.97,321.066 1886.32,464.365 1888.68,279.372 1891.03,359.791 1893.38,445.066 1895.73,357.918 1898.08,520.581 1900.43,631.884 1902.78,347.287 1905.13,520.072 1907.48,457.023 1909.83,314.498 1912.18,570.603 1914.53,302.316 1916.88,356.5 1919.23,341.497 1921.58,493.215 1923.93,400.856 1926.28,452.412 1928.63,407.978 1930.98,258.232 1933.33,429.882 1935.68,334.936 1938.04,523.221 1940.39,446.064 1942.74,528.513 1945.09,498.245 1947.44,438.829 1949.79,276.128 1952.14,440.739 1954.49,416.786 1956.84,453.427 1959.19,589.202 1961.54,356.176 1963.89,437.597 1966.24,395.579 1968.59,347.933 1970.94,304.865 1973.29,372.754 1975.64,412.298 1977.99,362.632 1980.34,332.992 1982.69,503.906 1985.04,289.401 1987.4,498.453 1989.75,358.386 1992.1,428.351 1994.45,294.448 1996.8,280.372 1999.15,530.41 2001.5,199.477 2003.85,349.172 2006.2,498.955 2008.55,551.426 2010.9,463.146 2013.25,516.797 2015.6,377.529 2017.95,453.508 2020.3,438.547 2022.65,367.971 2025,318.672 2027.35,428.22 2029.7,413.824 2032.05,352.344 2034.4,414.567 2036.76,475.515 2039.11,390.233 2041.46,440.184 2043.81,445.12 2046.16,447.115 2048.51,270.398 2050.86,549.663 2053.21,421.85 2055.56,470.494 2057.91,487.702 2060.26,403.528 2062.61,638.322 2064.96,491.85 2067.31,436.834 2069.66,535.114 2072.01,441.413 2074.36,469.792 2076.71,582.415 2079.06,347.222 2081.41,252.056 2083.76,454.755 2086.11,391.849 2088.47,407.624 2090.82,324.579 2093.17,567.477 2095.52,375.193 2097.87,429.718 2100.22,649.164 2102.57,445.638 2104.92,316.346 2107.27,303.782 2109.62,335.756 2111.97,513.839 2114.32,457.075 2116.67,418.603 2119.02,372.276 2121.37,314.641 2123.72,305.999 2126.07,552.767 2128.42,344.384 2130.77,237.651 2133.12,512.156 2135.47,606.847 2137.83,600.311 2140.18,269.454 2142.53,362.155 2144.88,437.172 2147.23,201.26 2149.58,426.762 2151.93,543.186 2154.28,387.992 2156.63,522.256 2158.98,322.09 2161.33,365.02 2163.68,438.196 2166.03,583.23 2168.38,581.896 2170.73,455.268 2173.08,444.668 2175.43,420.861 2177.78,373.213 2180.13,503.158 2182.48,362.223 2184.83,493.104 2187.19,491.127 2189.54,471.637 2191.89,227.242 2194.24,424.072 2196.59,464.85 2198.94,379.817 2201.29,291.351 2203.64,321.463 2205.99,368.547 2208.34,498.889 2210.69,377.474 2213.04,483.341 2215.39,493.606 2217.74,483.213 2220.09,374.472 2222.44,466.961 2224.79,390.534 2227.14,445.577 2229.49,315.84 2231.84,311.805 2234.19,482.487 2236.55,270.563 2238.9,471.494 2241.25,462.673 2243.6,443.645 2245.95,522.067 2248.3,498.353 2250.65,364.897 2253,520.936 2255.35,375.014 2257.7,454.534 2260.05,434.887 2262.4,370.875 2264.75,442.872 2267.1,390.812 2269.45,494.811 2271.8,427.209 2274.15,348.281 2276.5,434.609 2278.85,355.247 2281.2,573.793 2283.55,460.098 2285.91,252.245 2288.26,492.523 2290.61,437.844 2292.96,358.064 2295.31,534.172 2297.66,562.365 2300.01,484.056 2302.36,241.263 2304.71,280.25 2307.06,489.88 2309.41,549.875 2311.76,270.66 2314.11,385.151 2316.46,422.84 2318.81,577.524 2321.16,233.462 2323.51,465.411 2325.86,436.349 2328.21,318.494 2330.56,419.247 2332.91,432.9 2335.27,464.618 2337.62,480.813 2339.97,303.098 2342.32,429.516 2344.67,325.642 2347.02,438.607 2349.37,384.109 2351.72,566.261 2354.07,430.721 2356.42,525.391 2358.77,470.579 2361.12,280.671 2363.47,421.606 2365.82,588.926 2368.17,522.129 2370.52,607.771 2372.87,328.538 2375.22,357.57 2377.57,330.854 2379.92,497.25 2382.27,452.749 2384.62,392.299 2386.98,353.041 2389.33,508.348 2391.68,527.515 2394.03,509.421 2396.38,306.331 2398.73,434.944 2401.08,240.957 2403.43,447.388 2405.78,582.808 2408.13,578.002 2410.48,314.897 2412.83,444.155 2415.18,448.415 2417.53,469.365 2419.88,353.141 2422.23,342.21 2424.58,615.111 2426.93,332.126 2429.28,394.416 2431.63,475.4 2433.98,558.145 2436.34,545.582 2438.69,558.915 2441.04,413.156 2443.39,186.412 2445.74,513.135 2448.09,518.352 2450.44,621.893 2452.79,151.017 2455.14,440.612 2457.49,425.773 2459.84,544.155 2462.19,545.836 2464.54,439.69 2466.89,478.691 2469.24,493.789 2471.59,458.51 2473.94,234.977 2476.29,316.097 2478.64,486.513 2480.99,532.924 2483.34,414.457 2485.7,490.785 2488.05,425.476 2490.4,414.953 2492.75,330.78 2495.1,445.711 2497.45,605.505 2499.8,531.023 2502.15,183.757 2504.5,465.098 2506.85,427.365 2509.2,368.35 2511.55,478.128 2513.9,400.809 2516.25,545.06 2518.6,615.989 2520.95,224.035 2523.3,421.493 2525.65,420.595 2528,240.353 2530.35,104.995 2532.7,571.298 2535.06,651.601 2537.41,276.791 2539.76,421.343 2542.11,214.027 2544.46,257.932 2546.81,412.118 2549.16,411.36 2551.51,294.4 2553.86,559.146 2556.21,359.854 2558.56,367.269 2560.91,406.727 2563.26,561.261 2565.61,282.215 2567.96,368.305 2570.31,483.815 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -3.69864  -4.24589  -4.93543  -6.05204   …  -6.29952    -5.7227   -3.99762
 -2.64054  -1.70919  -1.06476  -0.960801      0.0035786  -1.19319   1.34112
  3.81206   4.25527   3.80529   4.78104       4.87201     4.53897   4.00853

[:, :, 2] =
 -3.92806    -5.83731   -4.44289  -5.52433  …  -5.96261  -5.11074  -5.24131
  0.0463608  -0.137004   1.33925   0.75451     -1.13381   1.25058   0.310782
  0.204032    0.500692   2.2404    4.27731      4.11238   3.92281   4.05918

[:, :, 3] =
 -2.88433   -4.18011   -5.51791   …  -6.19207   -5.37575   -4.72132
  0.151339   0.799901   0.839771     -0.983193  -0.120805   0.261621
  2.3136     3.46982    3.62902       4.4149     2.91272    4.15004

[:, :, 4] =
 -1.48013  -3.36716  -3.53572   -4.91933   …  -6.2412    -5.80994  -5.80994
  1.45612   1.017    -0.573597  -0.104953      0.285327   1.18064   1.18064
  1.61527   1.7909    3.62437    4.76175       6.50854    5.9211    5.9211</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.99306    1.00066
  0.0168677  0.990891
  5.01495    0.998023</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.53 seconds
Compute duration  = 2.53 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -5.0230    0.9945    0.0177   3156.0850   4856.5493    1.0003   ⋯
        x[2]    0.0016    0.9876    0.0173   3276.4578   5266.3204    1.0000   ⋯
        x[3]    4.9978    0.9948    0.0166   3573.8033   5258.5626    0.9999   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -6.9557   -5.6905   -5.0164   -4.3608   -3.0515
        x[2]   -1.9453   -0.6649   -0.0077    0.6775    1.8987
        x[3]    3.0419    4.3190    5.0172    5.6730    6.9288</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.68 seconds
Compute duration  = 1.68 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.5006    0.1894    0.0029   4321.1772   6311.0440    0.9999   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1469    0.3584    0.5008    0.6433    0.8517</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.25 seconds
Compute duration  = 0.25 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

           x    0.4904    0.1548    0.0115   143.7753    60.4692    1.0002     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.2337    0.3599    0.4972    0.6175    0.7539</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(-0.2850222205457919, "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with -0.2850222205457919:
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/ji8PW/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/E4kDs/src/compiler.jl:579 [inlined]
  [7] demo(__model__::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, __varinfo__::DynamicPPL.ThreadSafeVarInfo{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, Vector{Base.RefValue{Float64}}}, __context__::DynamicPPL.ValuesAsInModelContext{OrderedDict{Any, Any}, DynamicPPL.DefaultContext})
    @ Main.Notebook ~/work/turing-docs/turing-docs/tutorials/docs-17-implementing-samplers/index.qmd:592
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/E4kDs/src/model.jl:963 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, context::DynamicPPL.ValuesAsInModelContext{OrderedDict{Any, Any}, DynamicPPL.DefaultContext})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/E4kDs/src/model.jl:952
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/E4kDs/src/model.jl:887 [inlined]
 [11] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/E4kDs/src/values_as_in_model.jl:196 [inlined]
 [12] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/E4kDs/src/values_as_in_model.jl:195 [inlined]
 [13] getparams(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64})
    @ Turing.Inference ~/.julia/packages/Turing/aAIq7/src/mcmc/Inference.jl:328
 [14] Turing.Inference.Transition(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, t::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/aAIq7/src/mcmc/Inference.jl:224
 [15] transition_to_turing
    @ ~/.julia/packages/Turing/aAIq7/src/mcmc/abstractmcmc.jl:12 [inlined]
 [16] transition_to_turing(f::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, transition::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/aAIq7/src/mcmc/abstractmcmc.jl:17
 [17] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}; initial_state::Nothing, initial_params::Nothing, kwargs::@Kwargs{})
    @ Turing.Inference ~/.julia/packages/Turing/aAIq7/src/mcmc/abstractmcmc.jl:76
 [18] step
    @ ~/.julia/packages/Turing/aAIq7/src/mcmc/abstractmcmc.jl:36 [inlined]
 [19] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:130 [inlined]
 [20] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/logging.jl:16 [inlined]
 [21] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:120
 [22] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/E4kDs/src/sampler.jl:93
 [23] sample
    @ ~/.julia/packages/DynamicPPL/E4kDs/src/sampler.jl:83 [inlined]
 [24] #sample#4
    @ ~/.julia/packages/Turing/aAIq7/src/mcmc/Inference.jl:263 [inlined]
 [25] sample
    @ ~/.julia/packages/Turing/aAIq7/src/mcmc/Inference.jl:256 [inlined]
 [26] #sample#3
    @ ~/.julia/packages/Turing/aAIq7/src/mcmc/Inference.jl:253 [inlined]
 [27] top-level scope
    @ ~/work/turing-docs/turing-docs/tutorials/docs-17-implementing-samplers/index.qmd:594</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.64 seconds
Compute duration  = 1.64 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8884    0.5514    0.0208   558.3909   296.1778    1.0069     ⋯
           x   -0.0622    1.0099    0.0439   713.0408   461.9022    1.0021     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1362    0.4401    0.7900    1.2352    2.2513
           x   -2.3602   -0.4797   -0.0169    0.4504    1.9120</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.04 seconds
Compute duration  = 3.04 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8500    0.5763    0.0305   183.9125    50.6048    1.0042     ⋯
           x    0.0028    0.9683    0.0455   543.4705   448.4159    1.0090     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.0929    0.3897    0.7242    1.1875    2.2322
           x   -2.3152   -0.4028    0.0414    0.4155    2.1395</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>
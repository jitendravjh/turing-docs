<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.45">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../versions.html" rel="next">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Library API</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">For Developers (Inference)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Documentation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Modelling Syntax and Interface</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-14-using-turing-quick-start/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quick Start</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-09-using-turing-advanced/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Usage</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Turing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">For Developers (PPL)</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">For Developers (Inference)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../versions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Versions</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/TuringTutorials/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/TuringTutorials/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">For Developers (Inference)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-29.134510775726056</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-29.134510775726056</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -1.9578   -2.27393   -4.11397  -4.21468   …  -5.07635   -4.45323  -6.14254
 -1.61043   0.152543   1.10927  -0.695932      0.510518   1.08247   2.42176
  2.28141   4.93735    3.63762   3.64536       6.19805    5.40677   7.79237</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.99671  0.995058
 -0.04584  1.00791
  4.99926  0.997375</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip060">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip060)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip061">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip060)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip062">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip062)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip062)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip062)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip062)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip062)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip060)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip060)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip060)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip060)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip060)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip060)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip060)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip062)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1530.37 2640.76,1530.37 "></polyline>
<polyline clip-path="url(#clip062)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1232.72 2640.76,1232.72 "></polyline>
<polyline clip-path="url(#clip062)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,935.068 2640.76,935.068 "></polyline>
<polyline clip-path="url(#clip062)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,637.418 2640.76,637.418 "></polyline>
<polyline clip-path="url(#clip062)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,339.768 2640.76,339.768 "></polyline>
<polyline clip-path="url(#clip060)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip060)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1530.37 170.644,1530.37 "></polyline>
<polyline clip-path="url(#clip060)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1232.72 170.644,1232.72 "></polyline>
<polyline clip-path="url(#clip060)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,935.068 170.644,935.068 "></polyline>
<polyline clip-path="url(#clip060)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,637.418 170.644,637.418 "></polyline>
<polyline clip-path="url(#clip060)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,339.768 170.644,339.768 "></polyline>
<path clip-path="url(#clip060)" d="M49.5521 1530.82 L79.2279 1530.82 L79.2279 1534.75 L49.5521 1534.75 L49.5521 1530.82 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M99.8991 1528.5 Q96.7509 1528.5 94.8991 1530.66 Q93.0704 1532.81 93.0704 1536.56 Q93.0704 1540.29 94.8991 1542.46 Q96.7509 1544.62 99.8991 1544.62 Q103.047 1544.62 104.876 1542.46 Q106.728 1540.29 106.728 1536.56 Q106.728 1532.81 104.876 1530.66 Q103.047 1528.5 99.8991 1528.5 M109.181 1513.85 L109.181 1518.11 Q107.422 1517.28 105.617 1516.84 Q103.834 1516.4 102.075 1516.4 Q97.4454 1516.4 94.9917 1519.52 Q92.5612 1522.65 92.2139 1528.97 Q93.5797 1526.95 95.6398 1525.89 Q97.7 1524.8 100.177 1524.8 Q105.385 1524.8 108.394 1527.97 Q111.427 1531.12 111.427 1536.56 Q111.427 1541.88 108.279 1545.1 Q105.131 1548.32 99.8991 1548.32 Q93.9037 1548.32 90.7325 1543.74 Q87.5612 1539.13 87.5612 1530.4 Q87.5612 1522.21 91.45 1517.35 Q95.3389 1512.46 101.89 1512.46 Q103.649 1512.46 105.431 1512.81 Q107.237 1513.16 109.181 1513.85 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M50.3623 1233.17 L80.0381 1233.17 L80.0381 1237.1 L50.3623 1237.1 L50.3623 1233.17 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M104.297 1231.36 Q107.654 1232.08 109.529 1234.35 Q111.427 1236.62 111.427 1239.95 Q111.427 1245.07 107.908 1247.87 Q104.39 1250.67 97.9083 1250.67 Q95.7324 1250.67 93.4176 1250.23 Q91.126 1249.81 88.6723 1248.96 L88.6723 1244.44 Q90.6167 1245.58 92.9315 1246.16 Q95.2463 1246.73 97.7695 1246.73 Q102.168 1246.73 104.459 1245 Q106.774 1243.26 106.774 1239.95 Q106.774 1236.9 104.621 1235.18 Q102.492 1233.45 98.6722 1233.45 L94.6445 1233.45 L94.6445 1229.6 L98.8574 1229.6 Q102.306 1229.6 104.135 1228.24 Q105.964 1226.85 105.964 1224.26 Q105.964 1221.6 104.066 1220.18 Q102.191 1218.75 98.6722 1218.75 Q96.7509 1218.75 94.5519 1219.16 Q92.3528 1219.58 89.7139 1220.46 L89.7139 1216.29 Q92.376 1215.55 94.6908 1215.18 Q97.0287 1214.81 99.0889 1214.81 Q104.413 1214.81 107.515 1217.24 Q110.617 1219.65 110.617 1223.77 Q110.617 1226.64 108.973 1228.63 Q107.33 1230.6 104.297 1231.36 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M99.4824 920.867 Q95.8713 920.867 94.0426 924.431 Q92.2371 927.973 92.2371 935.103 Q92.2371 942.209 94.0426 945.774 Q95.8713 949.315 99.4824 949.315 Q103.117 949.315 104.922 945.774 Q106.751 942.209 106.751 935.103 Q106.751 927.973 104.922 924.431 Q103.117 920.867 99.4824 920.867 M99.4824 917.163 Q105.293 917.163 108.348 921.769 Q111.427 926.353 111.427 935.103 Q111.427 943.829 108.348 948.436 Q105.293 953.019 99.4824 953.019 Q93.6723 953.019 90.5936 948.436 Q87.538 943.829 87.538 935.103 Q87.538 926.353 90.5936 921.769 Q93.6723 917.163 99.4824 917.163 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M104.297 636.064 Q107.654 636.782 109.529 639.05 Q111.427 641.319 111.427 644.652 Q111.427 649.768 107.908 652.568 Q104.39 655.369 97.9083 655.369 Q95.7324 655.369 93.4176 654.93 Q91.126 654.513 88.6723 653.656 L88.6723 649.143 Q90.6167 650.277 92.9315 650.856 Q95.2463 651.434 97.7695 651.434 Q102.168 651.434 104.459 649.698 Q106.774 647.962 106.774 644.652 Q106.774 641.596 104.621 639.883 Q102.492 638.147 98.6722 638.147 L94.6445 638.147 L94.6445 634.305 L98.8574 634.305 Q102.306 634.305 104.135 632.939 Q105.964 631.55 105.964 628.957 Q105.964 626.295 104.066 624.883 Q102.191 623.448 98.6722 623.448 Q96.7509 623.448 94.5519 623.865 Q92.3528 624.282 89.7139 625.161 L89.7139 620.995 Q92.376 620.254 94.6908 619.883 Q97.0287 619.513 99.0889 619.513 Q104.413 619.513 107.515 621.944 Q110.617 624.351 110.617 628.471 Q110.617 631.342 108.973 633.332 Q107.33 635.3 104.297 636.064 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M99.8991 337.905 Q96.7509 337.905 94.8991 340.058 Q93.0704 342.21 93.0704 345.96 Q93.0704 349.687 94.8991 351.863 Q96.7509 354.016 99.8991 354.016 Q103.047 354.016 104.876 351.863 Q106.728 349.687 106.728 345.96 Q106.728 342.21 104.876 340.058 Q103.047 337.905 99.8991 337.905 M109.181 323.252 L109.181 327.511 Q107.422 326.678 105.617 326.238 Q103.834 325.798 102.075 325.798 Q97.4454 325.798 94.9917 328.923 Q92.5612 332.048 92.2139 338.368 Q93.5797 336.354 95.6398 335.289 Q97.7 334.201 100.177 334.201 Q105.385 334.201 108.394 337.372 Q111.427 340.521 111.427 345.96 Q111.427 351.284 108.279 354.502 Q105.131 357.72 99.8991 357.72 Q93.9037 357.72 90.7325 353.136 Q87.5612 348.53 87.5612 339.803 Q87.5612 331.609 91.45 326.748 Q95.3389 321.863 101.89 321.863 Q103.649 321.863 105.431 322.211 Q107.237 322.558 109.181 323.252 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip062)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1129.31 224.541,1203.32 226.891,1339.92 229.242,1521.65 231.592,1392.54 233.943,1607.79 236.293,1493 238.644,1485.27 240.994,1327.25 243.345,1470.12 245.695,1472.59 248.046,1398.25 250.396,1453.7 252.747,1324.38 255.097,1495.08 257.448,1355.5 259.798,1326.64 262.148,1275.34 264.499,1582.92 266.849,1505.97 269.2,1503.37 271.55,1477.77 273.901,1576.53 276.251,1417.52 278.602,1572.67 280.952,1573.79 283.303,1468.83 285.653,1340.69 288.004,1411.71 290.354,1453.23 292.705,1609.99 295.055,1487.22 297.406,1183.12 299.756,1331.32 302.107,1458.85 304.457,1436.03 306.807,1313.27 309.158,1480.92 311.508,1548.81 313.859,1406.88 316.209,1483.8 318.56,1509.79 320.91,1414.24 323.261,1400.09 325.611,1376.82 327.962,1510.59 330.312,1394.89 332.663,1446.41 335.013,1426.17 337.364,1453.01 339.714,1466.67 342.065,1399.79 344.415,1429.69 346.765,1307.35 349.116,1229.95 351.466,1386.26 353.817,1593.47 356.167,1489.11 358.518,1211.82 360.868,1511.34 363.219,1272.06 365.569,1427.34 367.92,1551.65 370.27,1437.53 372.621,1339.79 374.971,1593.64 377.322,1375.2 379.672,1512.32 382.023,1392.69 384.373,1255.16 386.724,1297.99 389.074,1511.32 391.424,1442.99 393.775,1442.92 396.125,1295.83 398.476,1602.07 400.826,1223.88 403.177,1482.11 405.527,1440.83 407.878,1464.15 410.228,1512.34 412.579,1465.64 414.929,1506.31 417.28,1317.98 419.63,1482.18 421.981,1324.14 424.331,1557.33 426.682,1380.03 429.032,1318.93 431.382,1201.31 433.733,1531.63 436.083,1567.9 438.434,1513.21 440.784,1658.02 443.135,1354.94 445.485,1343.42 447.836,1431.8 450.186,1370.53 452.537,1464.73 454.887,1492.73 457.238,1511.32 459.588,1521.53 461.939,1388.34 464.289,1568.44 466.64,1435.82 468.99,1383.96 471.341,1415.28 473.691,1426.27 476.041,1547.41 478.392,1509.95 480.742,1339.81 483.093,1354.44 485.443,1390.66 487.794,1404.64 490.144,1452.22 492.495,1474.91 494.845,1085.35 497.196,1315.63 499.546,1449.37 501.897,1495.17 504.247,1348.29 506.598,1360.43 508.948,1392.58 511.299,1436.11 513.649,1408.37 515.999,1535.34 518.35,1463.58 520.7,1520.98 523.051,1479.55 525.401,1526.79 527.752,1561.56 530.102,1366.88 532.453,1449.55 534.803,1144.28 537.154,1383.54 539.504,1433.15 541.855,1526.24 544.205,1396.02 546.556,1470.1 548.906,1379.4 551.257,1495.8 553.607,1527.31 555.958,1408.49 558.308,1353.72 560.658,1345.13 563.009,1432.55 565.359,1436.66 567.71,1412.75 570.06,1571.91 572.411,1751.15 574.761,1397.05 577.112,1478.19 579.462,1363.4 581.813,1242.22 584.163,1340.48 586.514,1372.62 588.864,1538.66 591.215,1549.45 593.565,1437.72 595.916,1415.21 598.266,1293.01 600.616,1606.07 602.967,1343.37 605.317,1551.95 607.668,1334.48 610.018,1376.17 612.369,1292.34 614.719,1132.12 617.07,1362.62 619.42,1414.09 621.771,1345.89 624.121,1375.75 626.472,1423.31 628.822,1395.59 631.173,1403.23 633.523,1252.81 635.874,1537.11 638.224,1410.29 640.575,1395.65 642.925,1410.36 645.275,1521.22 647.626,1545.54 649.976,1459.67 652.327,1413.21 654.677,1321.35 657.028,1350.95 659.378,1406.22 661.729,1512.46 664.079,1372.89 666.43,1373.92 668.78,1451.38 671.131,1420.1 673.481,1382.91 675.832,1316.85 678.182,1495.7 680.533,1440.77 682.883,1429.05 685.233,1539.63 687.584,1425.5 689.934,1304.19 692.285,1234.72 694.635,1467.68 696.986,1669.04 699.336,1484.73 701.687,1441.64 704.037,1335.57 706.388,1315.55 708.738,1464.03 711.089,1370.1 713.439,1364.22 715.79,1483.24 718.14,1580.54 720.491,1492.49 722.841,1499.82 725.192,1273.46 727.542,1512.32 729.892,1407.93 732.243,1363.57 734.593,1542.84 736.944,1471.65 739.294,1556.4 741.645,1352.62 743.995,1433.77 746.346,1376.57 748.696,1148.28 751.047,1330.72 753.397,1456.96 755.748,1479.34 758.098,1455.76 760.449,1586.46 762.799,1274.74 765.15,1379 767.5,1410.92 769.85,1476.11 772.201,1273.06 774.551,1464.67 776.902,1373.78 779.252,1561.34 781.603,1690.12 783.953,1631.94 786.304,1554.22 788.654,1408.34 791.005,1296.53 793.355,1380.27 795.706,1588.28 798.056,1493.39 800.407,1466.64 802.757,1423.19 805.108,1405.41 807.458,1457.29 809.809,1435.79 812.159,1378.11 814.509,1484.04 816.86,1287.6 819.21,1425.47 821.561,1471.89 823.911,1442.43 826.262,1320.6 828.612,1498.74 830.963,1493.17 833.313,1387.34 835.664,1604.52 838.014,1335.17 840.365,1484.2 842.715,1446.19 845.066,1447.2 847.416,1355.21 849.767,1310.14 852.117,1472.19 854.467,1243.43 856.818,1453.83 859.168,1536.9 861.519,1432.61 863.869,1300.41 866.22,1334.51 868.57,1359.25 870.921,1655.36 873.271,1392.34 875.622,1386.53 877.972,1603.7 880.323,1531.49 882.673,1437.29 885.024,1468.17 887.374,1462.65 889.725,1283.47 892.075,1482.82 894.426,1502.99 896.776,1418.21 899.126,1326.42 901.477,1385.36 903.827,1490.83 906.178,1570.3 908.528,1500.78 910.879,1536.21 913.229,1277.86 915.58,1555.76 917.93,1550.95 920.281,1356.99 922.631,1484.13 924.982,1501.27 927.332,1438.57 929.683,1243.49 932.033,1354.23 934.384,1274.73 936.734,1264.36 939.084,1383.87 941.435,1481.53 943.785,1385.17 946.136,1500.19 948.486,1487.93 950.837,1447.59 953.187,1534.49 955.538,1321.62 957.888,1500.84 960.239,1374.02 962.589,1483.75 964.94,1681.3 967.29,1462.6 969.641,1457.3 971.991,1236.21 974.342,1335 976.692,1413.22 979.043,1333.92 981.393,1447.38 983.743,1273.71 986.094,1512.2 988.444,1527.68 990.795,1458.48 993.145,1507.31 995.496,1451.95 997.846,1509.8 1000.2,1422.27 1002.55,1543.54 1004.9,1438.59 1007.25,1330.74 1009.6,1605.68 1011.95,1381.93 1014.3,1404.21 1016.65,1408.25 1019,1362.9 1021.35,1400.86 1023.7,1400.96 1026.05,1469.77 1028.4,1410.78 1030.75,1490.14 1033.1,1522.69 1035.45,1598.05 1037.8,1414 1040.15,1502.98 1042.51,1453.8 1044.86,1661.71 1047.21,1308.47 1049.56,1500.65 1051.91,1618.46 1054.26,1449.56 1056.61,1330.3 1058.96,1181.49 1061.31,1405.33 1063.66,1492.71 1066.01,1316.14 1068.36,1394.24 1070.71,1398.45 1073.06,1481.65 1075.41,1524.7 1077.76,1584.17 1080.11,1428.78 1082.46,1532.25 1084.81,1393.56 1087.16,1429.69 1089.51,1412.03 1091.87,1303.48 1094.22,1577.59 1096.57,1519.2 1098.92,1504.13 1101.27,1383.88 1103.62,1557.45 1105.97,1518.14 1108.32,1386.71 1110.67,1422.14 1113.02,1387.46 1115.37,1380.28 1117.72,1524.62 1120.07,1655.2 1122.42,1360.3 1124.77,1444.59 1127.12,1400.2 1129.47,1383.22 1131.82,1545.44 1134.17,1364.57 1136.52,1436.97 1138.87,1349.52 1141.23,1437.09 1143.58,1379.18 1145.93,1454.64 1148.28,1351.09 1150.63,1591.92 1152.98,1183.96 1155.33,1491.68 1157.68,1525.98 1160.03,1526.26 1162.38,1205.14 1164.73,1638.58 1167.08,1367.27 1169.43,1534.77 1171.78,1402.17 1174.13,1416.89 1176.48,1504.15 1178.83,1432.18 1181.18,1313.51 1183.53,1450.86 1185.88,1461.89 1188.23,1282.07 1190.59,1612.35 1192.94,1525.88 1195.29,1294.55 1197.64,1385.83 1199.99,1645.71 1202.34,1355.13 1204.69,1409.37 1207.04,1325.87 1209.39,1505.23 1211.74,1506.03 1214.09,1524.86 1216.44,1345.78 1218.79,1454.78 1221.14,1265.42 1223.49,1387 1225.84,1458.28 1228.19,1519.21 1230.54,1565.23 1232.89,1441.16 1235.24,1304.87 1237.59,1352.04 1239.94,1300.32 1242.3,1471.76 1244.65,1443.08 1247,1457.75 1249.35,1463.71 1251.7,1542.85 1254.05,1374.37 1256.4,1224.49 1258.75,1448.42 1261.1,1335.2 1263.45,1400.02 1265.8,1369.36 1268.15,1299.59 1270.5,1326.95 1272.85,1564.09 1275.2,1509.14 1277.55,1492.34 1279.9,1536.08 1282.25,1431.96 1284.6,1465.6 1286.95,1562.75 1289.3,1514.33 1291.66,1538.49 1294.01,1382.15 1296.36,1409.42 1298.71,1401.52 1301.06,1562.29 1303.41,1506.25 1305.76,1539.71 1308.11,1530.62 1310.46,1420.48 1312.81,1453.85 1315.16,1516.01 1317.51,1288.41 1319.86,1523.87 1322.21,1373.03 1324.56,1327.24 1326.91,1416.82 1329.26,1424.44 1331.61,1521.5 1333.96,1362.62 1336.31,1471.3 1338.66,1495.42 1341.02,1646.91 1343.37,1533.56 1345.72,1411.5 1348.07,1436.1 1350.42,1503.01 1352.77,1297.93 1355.12,1537.26 1357.47,1426.62 1359.82,1373.73 1362.17,1164.39 1364.52,1470.61 1366.87,1435.51 1369.22,1468.09 1371.57,1447.06 1373.92,1359.74 1376.27,1346.08 1378.62,1421.68 1380.97,1399.11 1383.32,1467.12 1385.67,1565.76 1388.02,1515.42 1390.38,1375 1392.73,1291.27 1395.08,1622.53 1397.43,1476.83 1399.78,1416.2 1402.13,1460.33 1404.48,1345.87 1406.83,1374.88 1409.18,1521.96 1411.53,1314.36 1413.88,1457.36 1416.23,1629.9 1418.58,1483.08 1420.93,1512.59 1423.28,1352.59 1425.63,1515.76 1427.98,1268.2 1430.33,1438.89 1432.68,1392.49 1435.03,1517.92 1437.38,1387.13 1439.74,1562.44 1442.09,1384.28 1444.44,1450.91 1446.79,1474.24 1449.14,1307.78 1451.49,1261.13 1453.84,1454.23 1456.19,1479.7 1458.54,1428.47 1460.89,1513.3 1463.24,1360.62 1465.59,1391.97 1467.94,1334.13 1470.29,1204.64 1472.64,1275.9 1474.99,1483.68 1477.34,1387.72 1479.69,1496.84 1482.04,1286.38 1484.39,1156.38 1486.74,1531.59 1489.1,1368.19 1491.45,1388.05 1493.8,1544.83 1496.15,1464.08 1498.5,1475.57 1500.85,1544.08 1503.2,1430.65 1505.55,1398.43 1507.9,1430.31 1510.25,1495.25 1512.6,1447.36 1514.95,1415.09 1517.3,1525.66 1519.65,1410.58 1522,1271.69 1524.35,1541.22 1526.7,1282.57 1529.05,1586.05 1531.4,1522.78 1533.75,1460.36 1536.1,1380.84 1538.45,1592.93 1540.81,1427.97 1543.16,1292.43 1545.51,1516.16 1547.86,1560 1550.21,1323.68 1552.56,1429.42 1554.91,1443.47 1557.26,1454.42 1559.61,1488.97 1561.96,1349.35 1564.31,1335.86 1566.66,1325.53 1569.01,1420.52 1571.36,1585.26 1573.71,1594.1 1576.06,1400.96 1578.41,1406.79 1580.76,1309.63 1583.11,1415.65 1585.46,1413.58 1587.81,1369.81 1590.17,1372.64 1592.52,1427.36 1594.87,1451.08 1597.22,1597.34 1599.57,1474.26 1601.92,1479.24 1604.27,1439.97 1606.62,1396.31 1608.97,1583.74 1611.32,1531.3 1613.67,1638.61 1616.02,1490.1 1618.37,1532.92 1620.72,1293.75 1623.07,1391.41 1625.42,1310.64 1627.77,1474.85 1630.12,1441.85 1632.47,1353.15 1634.82,1318.02 1637.17,1574.3 1639.53,1400.14 1641.88,1445.67 1644.23,1508.17 1646.58,1524.96 1648.93,1231.71 1651.28,1454.39 1653.63,1388.75 1655.98,1472.33 1658.33,1446.9 1660.68,1436.52 1663.03,1465.35 1665.38,1635.49 1667.73,1225.93 1670.08,1341.84 1672.43,1341.53 1674.78,1295.34 1677.13,1395.77 1679.48,1284.49 1681.83,1577.79 1684.18,1482.31 1686.53,1488.16 1688.89,1472.09 1691.24,1265.18 1693.59,1426.91 1695.94,1386.42 1698.29,1480.02 1700.64,1637.94 1702.99,1358.11 1705.34,1376.44 1707.69,1528.36 1710.04,1438.67 1712.39,1468.17 1714.74,1281.43 1717.09,1679.23 1719.44,1486.45 1721.79,1369.64 1724.14,1512.46 1726.49,1389.36 1728.84,1475.9 1731.19,1262.64 1733.54,1433.25 1735.89,1476.48 1738.25,1379.82 1740.6,1607.71 1742.95,1433.91 1745.3,1384.21 1747.65,1387.71 1750,1339.99 1752.35,1417.33 1754.7,1226.96 1757.05,1729.02 1759.4,1351.3 1761.75,1384.6 1764.1,1312.72 1766.45,1382.96 1768.8,1453.2 1771.15,1361.67 1773.5,1410.67 1775.85,1586.79 1778.2,1299.81 1780.55,1502.34 1782.9,1504.37 1785.25,1400.26 1787.6,1158.84 1789.96,1469.07 1792.31,1300.77 1794.66,1378.19 1797.01,1403.3 1799.36,1580.94 1801.71,1386.41 1804.06,1502.62 1806.41,1533.31 1808.76,1474.96 1811.11,1463.23 1813.46,1366.5 1815.81,1278.52 1818.16,1420.44 1820.51,1614.26 1822.86,1419.19 1825.21,1447.77 1827.56,1390.47 1829.91,1592.34 1832.26,1212.1 1834.61,1455.62 1836.96,1371.1 1839.32,1493.92 1841.67,1338.85 1844.02,1467.02 1846.37,1521.51 1848.72,1448.78 1851.07,1444.88 1853.42,1426.88 1855.77,1294.78 1858.12,1360.86 1860.47,1395.94 1862.82,1479.12 1865.17,1466.22 1867.52,1465.52 1869.87,1355.96 1872.22,1556.47 1874.57,1361.53 1876.92,1395.1 1879.27,1513.13 1881.62,1401.2 1883.97,1411.73 1886.32,1463.6 1888.68,1470.99 1891.03,1429.37 1893.38,1289.36 1895.73,1483.04 1898.08,1456.67 1900.43,1423.03 1902.78,1466.88 1905.13,1443.86 1907.48,1496.55 1909.83,1480.68 1912.18,1307.37 1914.53,1514.33 1916.88,1375.24 1919.23,1354.29 1921.58,1321.09 1923.93,1440.48 1926.28,1402.44 1928.63,1327.09 1930.98,1359.03 1933.33,1471.98 1935.68,1395.15 1938.04,1371.66 1940.39,1399.28 1942.74,1584.71 1945.09,1580.57 1947.44,1455.19 1949.79,1318.61 1952.14,1498.48 1954.49,1466.59 1956.84,1206.38 1959.19,1364.39 1961.54,1364.39 1963.89,1503.33 1966.24,1315.82 1968.59,1278.46 1970.94,1207.94 1973.29,1497.09 1975.64,1442.79 1977.99,1519.87 1980.34,1533.71 1982.69,1350.74 1985.04,1373.96 1987.4,1418.47 1989.75,1460.16 1992.1,1454.77 1994.45,1299.82 1996.8,1309.13 1999.15,1226.56 2001.5,1478.24 2003.85,1276.76 2006.2,1455.01 2008.55,1599.3 2010.9,1404.2 2013.25,1530.39 2015.6,1470.64 2017.95,1444.09 2020.3,1430.34 2022.65,1525.99 2025,1368.03 2027.35,1472.56 2029.7,1347.07 2032.05,1433.93 2034.4,1496.38 2036.76,1430.08 2039.11,1331.61 2041.46,1393.1 2043.81,1292.34 2046.16,1384.9 2048.51,1445.9 2050.86,1449.93 2053.21,1580.37 2055.56,1565.78 2057.91,1498.34 2060.26,1483.49 2062.61,1446.9 2064.96,1257.85 2067.31,1588.12 2069.66,1359.94 2072.01,1553.18 2074.36,1396.25 2076.71,1334.58 2079.06,1426.64 2081.41,1545.22 2083.76,1341.96 2086.11,1608.92 2088.47,1265.66 2090.82,1273.88 2093.17,1274.2 2095.52,1308.06 2097.87,1523.8 2100.22,1388.64 2102.57,1274.94 2104.92,1433.05 2107.27,1169.49 2109.62,1589.46 2111.97,1550.6 2114.32,1517.46 2116.67,1250.6 2119.02,1349.1 2121.37,1576.13 2123.72,1204.33 2126.07,1397.78 2128.42,1417.67 2130.77,1438.64 2133.12,1557.32 2135.47,1637.32 2137.83,1544.59 2140.18,1575.09 2142.53,1615.28 2144.88,1463.23 2147.23,1357.09 2149.58,1389.47 2151.93,1506.26 2154.28,1563.38 2156.63,1617.99 2158.98,1440.75 2161.33,1472.02 2163.68,1307.14 2166.03,1406.67 2168.38,1508.51 2170.73,1287.68 2173.08,1390.68 2175.43,1395.3 2177.78,1484.97 2180.13,1386.37 2182.48,1367.8 2184.83,1530.81 2187.19,1380.66 2189.54,1492.05 2191.89,1255.59 2194.24,1571.27 2196.59,1607.5 2198.94,1573.14 2201.29,1384.87 2203.64,1598.13 2205.99,1520.47 2208.34,1592.43 2210.69,1573.84 2213.04,1415.39 2215.39,1524.47 2217.74,1477.26 2220.09,1431.02 2222.44,1402.44 2224.79,1460.91 2227.14,1361.77 2229.49,1488.89 2231.84,1355.28 2234.19,1382.57 2236.55,1402.78 2238.9,1448.94 2241.25,1335.04 2243.6,1484.22 2245.95,1337.94 2248.3,1388.23 2250.65,1457.1 2253,1246.65 2255.35,1437.65 2257.7,1498.94 2260.05,1481.45 2262.4,1373.58 2264.75,1495.5 2267.1,1508.5 2269.45,1315.04 2271.8,1419.51 2274.15,1585.28 2276.5,1481.01 2278.85,1421.07 2281.2,1410.74 2283.55,1475.59 2285.91,1492.03 2288.26,1374.61 2290.61,1462.31 2292.96,1404.49 2295.31,1340.14 2297.66,1335.46 2300.01,1426.99 2302.36,1472.94 2304.71,1417.67 2307.06,1478.14 2309.41,1528.81 2311.76,1291.46 2314.11,1383.2 2316.46,1497.43 2318.81,1286.99 2321.16,1422.54 2323.51,1340.03 2325.86,1417.81 2328.21,1323.12 2330.56,1541.3 2332.91,1428.81 2335.27,1339.5 2337.62,1371.46 2339.97,1355.84 2342.32,1485.8 2344.67,1512.78 2347.02,1415.34 2349.37,1448.39 2351.72,1549.59 2354.07,1523.55 2356.42,1487.7 2358.77,1569.37 2361.12,1709.17 2363.47,1476.27 2365.82,1541.44 2368.17,1537.52 2370.52,1482.48 2372.87,1496.93 2375.22,1424.43 2377.57,1653.01 2379.92,1308.89 2382.27,1167.24 2384.62,1411.43 2386.98,1567.81 2389.33,1521.11 2391.68,1595.89 2394.03,1440.42 2396.38,1427.06 2398.73,1400.88 2401.08,1456.27 2403.43,1421.74 2405.78,1589.33 2408.13,1430.64 2410.48,1208.99 2412.83,1489.85 2415.18,1395.63 2417.53,1400.24 2419.88,1409.44 2422.23,1335.17 2424.58,1348.56 2426.93,1351.16 2429.28,1316.09 2431.63,1498.25 2433.98,1334.2 2436.34,1490.2 2438.69,1503.57 2441.04,1360.47 2443.39,1393.88 2445.74,1447.57 2448.09,1545.84 2450.44,1499.42 2452.79,1290.82 2455.14,1549.04 2457.49,1336.02 2459.84,1456.92 2462.19,1496.53 2464.54,1443.9 2466.89,1520.05 2469.24,1289.16 2471.59,1322.74 2473.94,1609.79 2476.29,1544.26 2478.64,1408.51 2480.99,1460 2483.34,1360.4 2485.7,1406.96 2488.05,1557.24 2490.4,1382.92 2492.75,1355.22 2495.1,1348.15 2497.45,1267.11 2499.8,1412.88 2502.15,1346.85 2504.5,1669.91 2506.85,1402.52 2509.2,1393.66 2511.55,1348.12 2513.9,1567.73 2516.25,1465.38 2518.6,1615.01 2520.95,1388.93 2523.3,1382.05 2525.65,1559.96 2528,1473.58 2530.35,1379.55 2532.7,1326.67 2535.06,1428.65 2537.41,1683.39 2539.76,1436.27 2542.11,1439.87 2544.46,1423.03 2546.81,1559.23 2549.16,1499.91 2551.51,1251.59 2553.86,1217.31 2556.21,1534.72 2558.56,1548.21 2560.91,1462.53 2563.26,1325.03 2565.61,1474.99 2567.96,1479.49 2570.31,1476.14 "></polyline>
<polyline clip-path="url(#clip062)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1094.85 224.541,921.004 226.891,1074.4 229.242,1093.38 231.592,921.53 233.943,932.399 236.293,950.9 238.644,1021.35 240.994,873.467 243.345,944.262 245.695,930.613 248.046,834.736 250.396,1117.42 252.747,648.681 255.097,884.302 257.448,948.806 259.798,892.454 262.148,812.457 264.499,794.899 266.849,844.687 269.2,1049.66 271.55,831.984 273.901,1004.1 276.251,1079.67 278.602,1114.94 280.952,941.763 283.303,817.322 285.653,838.453 288.004,937.924 290.354,1093 292.705,960.63 295.055,907.876 297.406,875.948 299.756,1015.06 302.107,856.027 304.457,904.914 306.807,953.002 309.158,984.436 311.508,790.279 313.859,839.647 316.209,807.589 318.56,970.592 320.91,915.943 323.261,1035.46 325.611,1035.11 327.962,1019.57 330.312,1009.58 332.663,861.716 335.013,878.736 337.364,915.319 339.714,1041.97 342.065,1033.43 344.415,1111.61 346.765,1015.01 349.116,912.6 351.466,828.663 353.817,849.737 356.167,747.899 358.518,852.067 360.868,756.503 363.219,1058.84 365.569,922.86 367.92,895.933 370.27,850.199 372.621,989.893 374.971,995.262 377.322,953.324 379.672,1053.82 382.023,982.301 384.373,1057.4 386.724,928.568 389.074,1014.71 391.424,795.49 393.775,988.698 396.125,868.427 398.476,933.292 400.826,858.68 403.177,962.013 405.527,854.952 407.878,941.151 410.228,994.816 412.579,957.853 414.929,864.677 417.28,1042.66 419.63,915.92 421.981,978.713 424.331,904.715 426.682,862.101 429.032,897.027 431.382,1094 433.733,793.896 436.083,948.788 438.434,855.628 440.784,962.496 443.135,1061.73 445.485,731.307 447.836,980.597 450.186,866.513 452.537,934.785 454.887,895.453 457.238,1084.23 459.588,882.82 461.939,743.989 464.289,841.028 466.64,924.433 468.99,887.482 471.341,979.233 473.691,933.702 476.041,909.51 478.392,1103.81 480.742,983.729 483.093,1103.12 485.443,810.09 487.794,867.531 490.144,926.91 492.495,991.177 494.845,832.071 497.196,1010.94 499.546,891.321 501.897,863.462 504.247,915.1 506.598,892.684 508.948,791.512 511.299,894.24 513.649,991.916 515.999,961.254 518.35,930.878 520.7,922.088 523.051,796.376 525.401,962.152 527.752,965.464 530.102,906.037 532.453,991.921 534.803,992.016 537.154,907.389 539.504,1065.17 541.855,975.788 544.205,927.489 546.556,907.878 548.906,1047.78 551.257,867.987 553.607,832.357 555.958,789.922 558.308,854.338 560.658,872.935 563.009,783.709 565.359,1006.55 567.71,1003.98 570.06,970.691 572.411,863.932 574.761,955.4 577.112,995.511 579.462,911.716 581.813,902.04 584.163,813.577 586.514,1009.87 588.864,898.463 591.215,945.517 593.565,925.867 595.916,906.962 598.266,850.661 600.616,808.247 602.967,1097.51 605.317,915.59 607.668,904.521 610.018,1010.75 612.369,1092.54 614.719,1033.33 617.07,669.094 619.42,974.2 621.771,874.253 624.121,983.774 626.472,1001.62 628.822,988.001 631.173,886.856 633.523,1016.43 635.874,948.153 638.224,962.043 640.575,1116.35 642.925,1165.41 645.275,1064.68 647.626,972.071 649.976,1047.94 652.327,989.809 654.677,877.217 657.028,1018.64 659.378,931.644 661.729,1034.23 664.079,860.671 666.43,980.723 668.78,954.575 671.131,943.209 673.481,946.592 675.832,874.321 678.182,1027.52 680.533,804.947 682.883,800.364 685.233,887.62 687.584,930.057 689.934,995.44 692.285,976.767 694.635,971.224 696.986,958.768 699.336,898.277 701.687,779.784 704.037,1032.11 706.388,1157.46 708.738,978.339 711.089,749.383 713.439,940.335 715.79,930.608 718.14,938.049 720.491,1019.36 722.841,1054.98 725.192,1100.95 727.542,950.268 729.892,796.407 732.243,980.956 734.593,794.404 736.944,851.769 739.294,860.082 741.645,823.172 743.995,853.877 746.346,900.483 748.696,960.995 751.047,948.874 753.397,1056.09 755.748,1082.1 758.098,945.413 760.449,940.665 762.799,975.336 765.15,664.518 767.5,982.867 769.85,898.58 772.201,1046.24 774.551,883.086 776.902,973.452 779.252,919.242 781.603,898.371 783.953,852.865 786.304,907.973 788.654,992.467 791.005,930.618 793.355,805.676 795.706,1030.03 798.056,859.815 800.407,932.813 802.757,846.177 805.108,1057.4 807.458,854.806 809.809,976.405 812.159,1019.62 814.509,864.53 816.86,901.52 819.21,1024.88 821.561,959.995 823.911,977.518 826.262,982.757 828.612,885.206 830.963,970.971 833.313,1013.5 835.664,1049.95 838.014,915.455 840.365,980.954 842.715,850.342 845.066,1004.99 847.416,1117.3 849.767,969.941 852.117,847.665 854.467,892.29 856.818,1054.75 859.168,1125.55 861.519,1049.68 863.869,879.474 866.22,992.768 868.57,903.014 870.921,1103.67 873.271,832.061 875.622,834.086 877.972,992.775 880.323,895.862 882.673,738.669 885.024,903.74 887.374,1034.93 889.725,1078.22 892.075,705.17 894.426,1008.56 896.776,911.092 899.126,879.136 901.477,983.319 903.827,854.908 906.178,989.759 908.528,971.26 910.879,850.614 913.229,909.464 915.58,785.592 917.93,837.461 920.281,900.278 922.631,893.713 924.982,797.527 927.332,837.647 929.683,818.358 932.033,846.484 934.384,908.956 936.734,969.112 939.084,1119.73 941.435,897.416 943.785,884.294 946.136,778.949 948.486,758.671 950.837,965.075 953.187,1023.02 955.538,1006.18 957.888,916.967 960.239,989.697 962.589,801.181 964.94,1149.4 967.29,976.44 969.641,884.352 971.991,935.252 974.342,871.726 976.692,1083.08 979.043,852.821 981.393,1163.08 983.743,807.883 986.094,890.499 988.444,895.031 990.795,935.343 993.145,827.568 995.496,912.306 997.846,767.037 1000.2,933.682 1002.55,987.663 1004.9,1074.67 1007.25,956.692 1009.6,998.537 1011.95,999.368 1014.3,1108.4 1016.65,815.554 1019,941.745 1021.35,1121.5 1023.7,918.883 1026.05,840.791 1028.4,801.061 1030.75,1031.34 1033.1,950.902 1035.45,1007.64 1037.8,849.58 1040.15,971.281 1042.51,703.809 1044.86,1009.5 1047.21,838.946 1049.56,939.443 1051.91,1077.37 1054.26,1102.33 1056.61,837.883 1058.96,995.356 1061.31,883.558 1063.66,959.671 1066.01,965.684 1068.36,969.248 1070.71,961.743 1073.06,902.949 1075.41,1080.24 1077.76,882.77 1080.11,1120.05 1082.46,1019.16 1084.81,933.977 1087.16,811.172 1089.51,799.612 1091.87,888.172 1094.22,894.742 1096.57,926.813 1098.92,735.892 1101.27,956.047 1103.62,1004.54 1105.97,879.093 1108.32,877.758 1110.67,1024.12 1113.02,897.957 1115.37,1023.15 1117.72,884.161 1120.07,946.265 1122.42,783.25 1124.77,1101.85 1127.12,883.265 1129.47,980.499 1131.82,977.932 1134.17,910.258 1136.52,963.831 1138.87,900.531 1141.23,1001.98 1143.58,950.603 1145.93,891.677 1148.28,859.258 1150.63,854.371 1152.98,863.621 1155.33,922.702 1157.68,1042.07 1160.03,1048.92 1162.38,1003.46 1164.73,858.559 1167.08,944.657 1169.43,836.931 1171.78,977.18 1174.13,846.251 1176.48,878.319 1178.83,749.591 1181.18,889.445 1183.53,1076.55 1185.88,892.127 1188.23,1085.65 1190.59,1088.02 1192.94,970.913 1195.29,814.075 1197.64,716.495 1199.99,933.23 1202.34,809.418 1204.69,811.835 1207.04,814.766 1209.39,1092.6 1211.74,1173.51 1214.09,986.09 1216.44,904.86 1218.79,791.603 1221.14,1005.41 1223.49,993.792 1225.84,1004.52 1228.19,960.135 1230.54,893.505 1232.89,912.091 1235.24,757.34 1237.59,981.784 1239.94,860.533 1242.3,832.334 1244.65,922.836 1247,982.934 1249.35,1099.49 1251.7,854.369 1254.05,911.232 1256.4,755.579 1258.75,931.066 1261.1,942.875 1263.45,983.327 1265.8,931.628 1268.15,970.697 1270.5,889.992 1272.85,978.967 1275.2,995.435 1277.55,993.757 1279.9,960.158 1282.25,971.914 1284.6,908.748 1286.95,930.247 1289.3,1054.25 1291.66,892.702 1294.01,924.109 1296.36,988.531 1298.71,994.949 1301.06,964.658 1303.41,957.587 1305.76,1060.09 1308.11,1119.12 1310.46,829.234 1312.81,930.038 1315.16,887.602 1317.51,934.056 1319.86,1081.1 1322.21,900.522 1324.56,737.883 1326.91,964.527 1329.26,837.186 1331.61,996.119 1333.96,875.855 1336.31,1098.69 1338.66,775.732 1341.02,1065.41 1343.37,957.487 1345.72,770.006 1348.07,863.331 1350.42,1018.67 1352.77,932.804 1355.12,825.552 1357.47,853.167 1359.82,1132.18 1362.17,968.508 1364.52,878.169 1366.87,933.527 1369.22,862.946 1371.57,1032.19 1373.92,972.251 1376.27,966.199 1378.62,1061.93 1380.97,979.849 1383.32,856.65 1385.67,756.149 1388.02,1060.51 1390.38,891.457 1392.73,914.865 1395.08,1063.84 1397.43,985.574 1399.78,873.317 1402.13,924.902 1404.48,940.18 1406.83,978.981 1409.18,921.684 1411.53,836.924 1413.88,979.609 1416.23,820.34 1418.58,879.248 1420.93,954.732 1423.28,1016.19 1425.63,724.527 1427.98,924.427 1430.33,1009.54 1432.68,974.643 1435.03,786.999 1437.38,779.908 1439.74,945.916 1442.09,834.854 1444.44,821.649 1446.79,1012.6 1449.14,1042 1451.49,876.91 1453.84,955.179 1456.19,1017.49 1458.54,925.862 1460.89,749.25 1463.24,931.688 1465.59,1008.78 1467.94,955.516 1470.29,882.267 1472.64,876.835 1474.99,970.59 1477.34,1058.37 1479.69,677.401 1482.04,911.185 1484.39,791.06 1486.74,1060.95 1489.1,924.398 1491.45,988.626 1493.8,1044.8 1496.15,836.919 1498.5,900.379 1500.85,977.072 1503.2,915.504 1505.55,872.251 1507.9,853.444 1510.25,1196.19 1512.6,869.729 1514.95,795.982 1517.3,815.549 1519.65,911.436 1522,1077.92 1524.35,833.967 1526.7,971.383 1529.05,749.252 1531.4,710.948 1533.75,943.243 1536.1,951.274 1538.45,942.035 1540.81,1073.12 1543.16,881.591 1545.51,882.089 1547.86,885.054 1550.21,960.794 1552.56,917.735 1554.91,783.358 1557.26,1131.05 1559.61,1029.05 1561.96,935.799 1564.31,840.849 1566.66,962.667 1569.01,867.461 1571.36,911.362 1573.71,916.737 1576.06,934.649 1578.41,883.302 1580.76,952.981 1583.11,940.003 1585.46,950.679 1587.81,1027.11 1590.17,848.045 1592.52,866.619 1594.87,858.51 1597.22,903.961 1599.57,905.433 1601.92,827.888 1604.27,867.661 1606.62,862.358 1608.97,982.26 1611.32,914.125 1613.67,998.055 1616.02,915.239 1618.37,1056.56 1620.72,881.546 1623.07,920.267 1625.42,796.167 1627.77,931.369 1630.12,922.945 1632.47,1096.88 1634.82,1044.04 1637.17,860.986 1639.53,1098.2 1641.88,927.669 1644.23,938.351 1646.58,895.882 1648.93,937.52 1651.28,1096.43 1653.63,844.828 1655.98,996.058 1658.33,783.439 1660.68,811.32 1663.03,733.484 1665.38,920.344 1667.73,966.405 1670.08,925.799 1672.43,911.656 1674.78,1047.94 1677.13,986.597 1679.48,963.157 1681.83,930.894 1684.18,929.06 1686.53,958.752 1688.89,994.981 1691.24,896.951 1693.59,875.028 1695.94,940.236 1698.29,874.656 1700.64,911.04 1702.99,956.8 1705.34,869.008 1707.69,1002.67 1710.04,794.304 1712.39,887.951 1714.74,969.093 1717.09,1115.55 1719.44,931.376 1721.79,972.835 1724.14,885.692 1726.49,820.707 1728.84,1160.14 1731.19,1003.83 1733.54,1099.02 1735.89,923.192 1738.25,814.168 1740.6,869.519 1742.95,768.052 1745.3,1141.42 1747.65,991.833 1750,848.019 1752.35,983.214 1754.7,1010.57 1757.05,936.644 1759.4,1109.15 1761.75,912.233 1764.1,827.628 1766.45,878.321 1768.8,1020.17 1771.15,790.706 1773.5,817.238 1775.85,994.898 1778.2,943.911 1780.55,921.026 1782.9,990.181 1785.25,999.274 1787.6,886.601 1789.96,904.452 1792.31,956.408 1794.66,737.905 1797.01,1017.72 1799.36,795.135 1801.71,994.616 1804.06,1106.94 1806.41,800.983 1808.76,936.752 1811.11,793.745 1813.46,942.721 1815.81,782.823 1818.16,739.199 1820.51,727.165 1822.86,921.737 1825.21,909.626 1827.56,856.724 1829.91,982.06 1832.26,1021.12 1834.61,1050.54 1836.96,945.871 1839.32,997.146 1841.67,837.715 1844.02,895.564 1846.37,697.148 1848.72,906.805 1851.07,998.866 1853.42,1057.37 1855.77,918.372 1858.12,855.662 1860.47,835.475 1862.82,875.717 1865.17,1042.38 1867.52,1052.41 1869.87,977.202 1872.22,1054.45 1874.57,886.649 1876.92,1014.97 1879.27,903.893 1881.62,1082.03 1883.97,933.123 1886.32,1184.56 1888.68,880.218 1891.03,799.828 1893.38,987.743 1895.73,953.642 1898.08,1047.09 1900.43,842.93 1902.78,698.518 1905.13,966.867 1907.48,896.937 1909.83,1123.34 1912.18,1026.34 1914.53,1092.56 1916.88,1058.8 1919.23,981.301 1921.58,932.214 1923.93,767.612 1926.28,898.842 1928.63,881.248 1930.98,838.94 1933.33,918.218 1935.68,1104.73 1938.04,1095.26 1940.39,777.41 1942.74,1030.09 1945.09,943.008 1947.44,883.079 1949.79,926.102 1952.14,969.52 1954.49,1039.46 1956.84,872.812 1959.19,1025.65 1961.54,918.393 1963.89,1124.37 1966.24,1195.99 1968.59,1164.53 1970.94,714.573 1973.29,1029.74 1975.64,830.402 1977.99,913.059 1980.34,1024.37 1982.69,881.71 1985.04,1089.36 1987.4,884.532 1989.75,1012.06 1992.1,884.184 1994.45,909.36 1996.8,901.755 1999.15,964.874 2001.5,991.47 2003.85,954.004 2006.2,889.622 2008.55,1011.28 2010.9,853.539 2013.25,1029.38 2015.6,943.148 2017.95,775.03 2020.3,923.488 2022.65,863.377 2025,903.167 2027.35,1025.44 2029.7,1136.8 2032.05,914.528 2034.4,917.125 2036.76,967.101 2039.11,1090.79 2041.46,938.469 2043.81,950.858 2046.16,946.115 2048.51,904.093 2050.86,915.047 2053.21,894.785 2055.56,954.862 2057.91,1043.03 2060.26,987.425 2062.61,1010.8 2064.96,888.981 2067.31,760.882 2069.66,827.993 2072.01,993.728 2074.36,990.46 2076.71,1047.57 2079.06,1019.76 2081.41,991.279 2083.76,879.454 2086.11,682.97 2088.47,1033.37 2090.82,919.774 2093.17,879.157 2095.52,887.368 2097.87,947.394 2100.22,933.753 2102.57,942.653 2104.92,1053.47 2107.27,921.212 2109.62,984.726 2111.97,900.909 2114.32,942.092 2116.67,835.562 2119.02,985.583 2121.37,1008.9 2123.72,959.744 2126.07,962.901 2128.42,919.543 2130.77,875.449 2133.12,1073.9 2135.47,994.171 2137.83,928.027 2140.18,1035.55 2142.53,976.673 2144.88,1130.5 2147.23,905.973 2149.58,981.229 2151.93,949.127 2154.28,1038.1 2156.63,934.892 2158.98,988.349 2161.33,944.278 2163.68,926.809 2166.03,919.221 2168.38,775.348 2170.73,982.264 2173.08,1116.65 2175.43,1108.36 2177.78,990.518 2180.13,1098.51 2182.48,876.498 2184.83,867.496 2187.19,1069.58 2189.54,940.185 2191.89,766.357 2194.24,791.293 2196.59,976.657 2198.94,717.888 2201.29,909.117 2203.64,1023.24 2205.99,989.541 2208.34,900.87 2210.69,978.551 2213.04,992.917 2215.39,854.966 2217.74,837.924 2220.09,1082.54 2222.44,1055.92 2224.79,857.369 2227.14,1241.61 2229.49,810.145 2231.84,1062.52 2234.19,971.882 2236.55,768.917 2238.9,962.724 2241.25,1002.02 2243.6,504.924 2245.95,954.961 2248.3,834.934 2250.65,952.893 2253,747.149 2255.35,855.306 2257.7,883.931 2260.05,814.978 2262.4,957.632 2264.75,825.268 2267.1,954.061 2269.45,686.28 2271.8,1104.29 2274.15,1066.85 2276.5,994.739 2278.85,1023.87 2281.2,948.178 2283.55,968.197 2285.91,925.138 2288.26,912.713 2290.61,786.713 2292.96,865.003 2295.31,991.297 2297.66,808.478 2300.01,720.537 2302.36,1213.23 2304.71,738.147 2307.06,894.087 2309.41,1015.64 2311.76,1005.71 2314.11,1056 2316.46,870.576 2318.81,736.898 2321.16,994.055 2323.51,1031.29 2325.86,1004.37 2328.21,1034.48 2330.56,907.441 2332.91,1009.42 2335.27,1104.9 2337.62,850.645 2339.97,880.842 2342.32,899.909 2344.67,786.608 2347.02,907.065 2349.37,831.961 2351.72,907.247 2354.07,830.669 2356.42,844.199 2358.77,774.867 2361.12,1017.12 2363.47,952.732 2365.82,909.208 2368.17,929.858 2370.52,1036.56 2372.87,938.856 2375.22,872.465 2377.57,1168.67 2379.92,1025.52 2382.27,1014.41 2384.62,1079.75 2386.98,965.568 2389.33,989.046 2391.68,930.451 2394.03,1033.38 2396.38,893.597 2398.73,1010.14 2401.08,980.82 2403.43,791.651 2405.78,848.03 2408.13,894.967 2410.48,1092.13 2412.83,1238.43 2415.18,1045.54 2417.53,998.584 2419.88,894.675 2422.23,823.36 2424.58,1055.49 2426.93,1028.07 2429.28,1057.1 2431.63,904.779 2433.98,1069.76 2436.34,826.873 2438.69,1062.36 2441.04,948.253 2443.39,632.506 2445.74,851.649 2448.09,837.981 2450.44,962.986 2452.79,1021.22 2455.14,804.947 2457.49,860.124 2459.84,815.579 2462.19,858.983 2464.54,759.616 2466.89,887.357 2469.24,930.142 2471.59,821.067 2473.94,857.235 2476.29,1068.29 2478.64,1027.22 2480.99,892.203 2483.34,880.048 2485.7,902.41 2488.05,1011.62 2490.4,1159.9 2492.75,857.97 2495.1,1071.09 2497.45,1077.29 2499.8,846.141 2502.15,984.213 2504.5,897.464 2506.85,831.727 2509.2,859.204 2511.55,1083.19 2513.9,874.71 2516.25,1003.29 2518.6,1073.62 2520.95,893.694 2523.3,911.427 2525.65,865.043 2528,815.969 2530.35,927.939 2532.7,1069.86 2535.06,1026.59 2537.41,1004.17 2539.76,1069.56 2542.11,857.038 2544.46,1136.87 2546.81,858.73 2549.16,951.113 2551.51,944.814 2553.86,951.027 2556.21,958.65 2558.56,890.889 2560.91,999.122 2563.26,935.344 2565.61,955.023 2567.96,787.404 2570.31,919.561 "></polyline>
<polyline clip-path="url(#clip062)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,708.715 224.541,504.607 226.891,355.361 229.242,430.772 231.592,596.922 233.943,381.235 236.293,561.947 238.644,378.743 240.994,371.449 243.345,301.597 245.695,384.067 248.046,389.486 250.396,471.038 252.747,520.503 255.097,522.688 257.448,333.992 259.798,394.815 262.148,448.756 264.499,491.116 266.849,368.338 269.2,593.7 271.55,399.651 273.901,362.372 276.251,491.971 278.602,441.085 280.952,534.788 283.303,444.6 285.653,350.876 288.004,548.212 290.354,352.628 292.705,361.513 295.055,427.506 297.406,554.667 299.756,513.62 302.107,442.678 304.457,369.164 306.807,491.781 309.158,395.712 311.508,601.795 313.859,404.221 316.209,300.753 318.56,582.306 320.91,408.758 323.261,466.611 325.611,319.591 327.962,513.79 330.312,647.682 332.663,320.8 335.013,360.602 337.364,481.055 339.714,531.641 342.065,457.37 344.415,569.319 346.765,407.518 349.116,366.349 351.466,387.636 353.817,500.177 356.167,363.025 358.518,566.338 360.868,400.108 363.219,573.75 365.569,565.272 367.92,518.124 370.27,491.547 372.621,330.539 374.971,469.321 377.322,530.169 379.672,368.953 382.023,340.657 384.373,498.82 386.724,505.852 389.074,492.756 391.424,373.231 393.775,569.457 396.125,417.73 398.476,535.349 400.826,275.828 403.177,348.392 405.527,616.532 407.878,392.628 410.228,367.21 412.579,472.263 414.929,495.188 417.28,527.401 419.63,462.941 421.981,419.5 424.331,573.272 426.682,429.58 429.032,342.404 431.382,226.673 433.733,383.19 436.083,579.844 438.434,388.624 440.784,514.405 443.135,608.756 445.485,407.574 447.836,424.249 450.186,421.727 452.537,441.045 454.887,500.771 457.238,325.147 459.588,469.671 461.939,265.536 464.289,439.789 466.64,390.103 468.99,438.69 471.341,587.201 473.691,454.941 476.041,445.205 478.392,484.425 480.742,345.985 483.093,443.33 485.443,406.701 487.794,407.222 490.144,271.349 492.495,392.229 494.845,413.969 497.196,163.757 499.546,401.666 501.897,664.467 504.247,362.729 506.598,452.145 508.948,214.414 511.299,281.493 513.649,623.05 515.999,472.461 518.35,390.368 520.7,577.32 523.051,459.781 525.401,359.737 527.752,468.832 530.102,354.489 532.453,526.115 534.803,322.709 537.154,443.301 539.504,384.306 541.855,441.496 544.205,412.18 546.556,303.483 548.906,474.013 551.257,505.115 553.607,444.695 555.958,481.069 558.308,597.668 560.658,433.277 563.009,545.114 565.359,383.15 567.71,462.202 570.06,486.242 572.411,450.221 574.761,493.11 577.112,339.894 579.462,499.673 581.813,562.4 584.163,351.601 586.514,305.385 588.864,391.509 591.215,412.589 593.565,469.666 595.916,383.566 598.266,373.753 600.616,436.097 602.967,516.385 605.317,496.032 607.668,502.62 610.018,432.18 612.369,440.659 614.719,419.185 617.07,345.457 619.42,421.006 621.771,444.122 624.121,397.041 626.472,513.676 628.822,454.522 631.173,536.784 633.523,336.5 635.874,428.385 638.224,481.48 640.575,530.389 642.925,245.341 645.275,496.496 647.626,478.978 649.976,503.026 652.327,506.19 654.677,350.037 657.028,422.211 659.378,548.344 661.729,361.014 664.079,442.312 666.43,490.586 668.78,293.495 671.131,471.572 673.481,389.697 675.832,503.876 678.182,478.71 680.533,568.334 682.883,513.108 685.233,396.742 687.584,517.133 689.934,96.8724 692.285,441.628 694.635,381.979 696.986,365.253 699.336,401.595 701.687,544.834 704.037,314.015 706.388,299.465 708.738,311.647 711.089,409.573 713.439,536.255 715.79,432.733 718.14,519.846 720.491,543.285 722.841,458.311 725.192,410.895 727.542,445.396 729.892,406.75 732.243,403.317 734.593,318.727 736.944,361.184 739.294,573.143 741.645,369.732 743.995,316.08 746.346,453.769 748.696,528.698 751.047,339.695 753.397,341.965 755.748,570.877 758.098,347.725 760.449,415.866 762.799,546.216 765.15,349.241 767.5,452.08 769.85,364.858 772.201,532.943 774.551,474.457 776.902,404.853 779.252,380.869 781.603,473.247 783.953,533.406 786.304,477.312 788.654,374.973 791.005,408.62 793.355,665.477 795.706,345.674 798.056,422.086 800.407,356.611 802.757,555.824 805.108,446.938 807.458,489.331 809.809,321.589 812.159,470.177 814.509,295.799 816.86,423.186 819.21,438.921 821.561,441.741 823.911,346.775 826.262,331.47 828.612,372.792 830.963,566.023 833.313,603.514 835.664,416.883 838.014,514.307 840.365,246.53 842.715,435.92 845.066,411.954 847.416,476.95 849.767,387.031 852.117,495.662 854.467,372.899 856.818,407.043 859.168,438.106 861.519,365.145 863.869,618.884 866.22,386.327 868.57,281.032 870.921,490.366 873.271,314.551 875.622,395.599 877.972,552.545 880.323,394.531 882.673,560.276 885.024,456.198 887.374,371.253 889.725,563.853 892.075,508.709 894.426,427.502 896.776,569.595 899.126,268.922 901.477,479.913 903.827,400.994 906.178,210.497 908.528,316.896 910.879,444.496 913.229,557.02 915.58,225.985 917.93,518.234 920.281,526.921 922.631,614.768 924.982,403.149 927.332,382.753 929.683,452.613 932.033,442.721 934.384,550.455 936.734,416 939.084,427.656 941.435,652.084 943.785,602.954 946.136,390.067 948.486,431.67 950.837,437.038 953.187,393.135 955.538,516.16 957.888,456.023 960.239,401.638 962.589,298.088 964.94,392.064 967.29,484.957 969.641,441.4 971.991,408.783 974.342,396.412 976.692,569.673 979.043,427.65 981.393,298.087 983.743,355.254 986.094,562.808 988.444,441.974 990.795,423.608 993.145,202.793 995.496,390.975 997.846,360.678 1000.2,470.083 1002.55,392.38 1004.9,350.468 1007.25,467.724 1009.6,433.513 1011.95,583.283 1014.3,447.319 1016.65,392.233 1019,426.076 1021.35,441.417 1023.7,351.203 1026.05,220.997 1028.4,413.706 1030.75,478.041 1033.1,471.056 1035.45,451.92 1037.8,389.117 1040.15,443.554 1042.51,548.494 1044.86,489.839 1047.21,428.933 1049.56,422.257 1051.91,454.911 1054.26,440.6 1056.61,557.475 1058.96,451.348 1061.31,387.183 1063.66,335.951 1066.01,283.487 1068.36,375.625 1070.71,467.798 1073.06,424.14 1075.41,430.262 1077.76,579.592 1080.11,446.758 1082.46,293.706 1084.81,434.492 1087.16,408.882 1089.51,258.595 1091.87,400.567 1094.22,336.873 1096.57,362.835 1098.92,299.03 1101.27,358.95 1103.62,405.06 1105.97,418.485 1108.32,345.104 1110.67,411.71 1113.02,505.599 1115.37,638.237 1117.72,449.061 1120.07,378.759 1122.42,388.66 1124.77,307.702 1127.12,372.185 1129.47,369.506 1131.82,477.227 1134.17,483.715 1136.52,280.562 1138.87,414.39 1141.23,505.643 1143.58,376.712 1145.93,472.199 1148.28,503.681 1150.63,457.595 1152.98,438.046 1155.33,308.132 1157.68,432.942 1160.03,422.922 1162.38,412.857 1164.73,484.049 1167.08,733.996 1169.43,406.876 1171.78,458.9 1174.13,403.852 1176.48,590.673 1178.83,361.584 1181.18,446.095 1183.53,424.468 1185.88,304.965 1188.23,254.705 1190.59,533.644 1192.94,469.559 1195.29,492.232 1197.64,521.678 1199.99,526.994 1202.34,434.733 1204.69,370.471 1207.04,499.194 1209.39,196.541 1211.74,697.884 1214.09,400.593 1216.44,337.647 1218.79,455.178 1221.14,401.823 1223.49,429.235 1225.84,549.923 1228.19,633.911 1230.54,295.735 1232.89,390.071 1235.24,579.773 1237.59,534.387 1239.94,552.396 1242.3,413.524 1244.65,361.11 1247,316.009 1249.35,542.003 1251.7,619.494 1254.05,435.872 1256.4,505.856 1258.75,460.423 1261.1,568.149 1263.45,321.326 1265.8,499.457 1268.15,287.07 1270.5,547.423 1272.85,411.447 1275.2,412.955 1277.55,531.252 1279.9,540.974 1282.25,379.649 1284.6,463.601 1286.95,322.965 1289.3,421.604 1291.66,519.945 1294.01,389.935 1296.36,464.88 1298.71,547.535 1301.06,416.813 1303.41,456.229 1305.76,496.53 1308.11,292.209 1310.46,305.07 1312.81,513.264 1315.16,392.016 1317.51,585.81 1319.86,625.48 1322.21,398.457 1324.56,525.754 1326.91,538.533 1329.26,410.03 1331.61,419.626 1333.96,429.107 1336.31,421.462 1338.66,451.455 1341.02,331.872 1343.37,405.597 1345.72,414.045 1348.07,341.1 1350.42,446.712 1352.77,516.381 1355.12,493.476 1357.47,355.64 1359.82,287.078 1362.17,470.831 1364.52,335.925 1366.87,453.226 1369.22,502.222 1371.57,444.017 1373.92,435.59 1376.27,304.896 1378.62,344.818 1380.97,486.92 1383.32,373.386 1385.67,425.842 1388.02,603.334 1390.38,480.901 1392.73,440.969 1395.08,656.648 1397.43,478.594 1399.78,342.891 1402.13,434.936 1404.48,560.638 1406.83,399.704 1409.18,403.67 1411.53,532.052 1413.88,473.87 1416.23,525.671 1418.58,470.597 1420.93,381.519 1423.28,603.126 1425.63,497.605 1427.98,206.956 1430.33,190.065 1432.68,472.128 1435.03,300.843 1437.38,573.134 1439.74,560.098 1442.09,461.179 1444.44,745.385 1446.79,535.235 1449.14,378.852 1451.49,404.735 1453.84,274.208 1456.19,358.908 1458.54,344.172 1460.89,620.2 1463.24,492.114 1465.59,455.849 1467.94,546.566 1470.29,548.126 1472.64,413.337 1474.99,419.386 1477.34,569.981 1479.69,384.36 1482.04,579.464 1484.39,563.633 1486.74,556.689 1489.1,524.243 1491.45,545.97 1493.8,523.551 1496.15,529.81 1498.5,485.174 1500.85,343.426 1503.2,330.697 1505.55,243.133 1507.9,422.158 1510.25,459.087 1512.6,533.385 1514.95,372.867 1517.3,451.573 1519.65,389.457 1522,502.562 1524.35,425.928 1526.7,332.015 1529.05,592.056 1531.4,406.079 1533.75,361.875 1536.1,471.128 1538.45,517.428 1540.81,357.593 1543.16,458.273 1545.51,614.236 1547.86,590.234 1550.21,357.054 1552.56,434.49 1554.91,587.997 1557.26,338.83 1559.61,490.726 1561.96,659.16 1564.31,524.619 1566.66,371.776 1569.01,472.664 1571.36,448.577 1573.71,408.184 1576.06,242.529 1578.41,405.31 1580.76,282.652 1583.11,413.954 1585.46,417.483 1587.81,496.569 1590.17,471.658 1592.52,357.501 1594.87,601.916 1597.22,363.925 1599.57,469.043 1601.92,241.37 1604.27,540.247 1606.62,508.028 1608.97,442.844 1611.32,534.216 1613.67,488.636 1616.02,549.154 1618.37,380.429 1620.72,367.471 1623.07,427.575 1625.42,437.585 1627.77,252.289 1630.12,420.477 1632.47,422.797 1634.82,362.899 1637.17,355.936 1639.53,497.235 1641.88,517.692 1644.23,483.743 1646.58,425.774 1648.93,541.913 1651.28,462.003 1653.63,441.902 1655.98,440.115 1658.33,504.083 1660.68,597.082 1663.03,558.877 1665.38,433.874 1667.73,422.336 1670.08,444.947 1672.43,524.662 1674.78,639.978 1677.13,473.479 1679.48,346.731 1681.83,390.827 1684.18,480.379 1686.53,537.447 1688.89,307.56 1691.24,467.468 1693.59,459.286 1695.94,343.668 1698.29,465.026 1700.64,510.003 1702.99,538.118 1705.34,525.439 1707.69,423.846 1710.04,350.611 1712.39,407.668 1714.74,336.272 1717.09,372.938 1719.44,373.186 1721.79,321.668 1724.14,367.722 1726.49,346.394 1728.84,443.481 1731.19,472.422 1733.54,405.648 1735.89,530.528 1738.25,248.763 1740.6,329.251 1742.95,558.039 1745.3,510.813 1747.65,372.529 1750,401.516 1752.35,468.099 1754.7,489.726 1757.05,423.662 1759.4,394.482 1761.75,530.904 1764.1,499.3 1766.45,419.938 1768.8,447.322 1771.15,455.48 1773.5,530.035 1775.85,358.619 1778.2,492.339 1780.55,456.506 1782.9,309.623 1785.25,600.603 1787.6,333.697 1789.96,358.126 1792.31,465.33 1794.66,432.41 1797.01,525.175 1799.36,463.78 1801.71,256.601 1804.06,430.574 1806.41,367.68 1808.76,392.253 1811.11,386.966 1813.46,451.206 1815.81,373.554 1818.16,494.058 1820.51,599.728 1822.86,351.642 1825.21,446.346 1827.56,422.562 1829.91,503.662 1832.26,462.345 1834.61,510.004 1836.96,330.889 1839.32,431.616 1841.67,394.631 1844.02,515.558 1846.37,425.642 1848.72,454.924 1851.07,340.544 1853.42,426.249 1855.77,384.762 1858.12,481.62 1860.47,425.685 1862.82,360.387 1865.17,582.044 1867.52,371.217 1869.87,791.171 1872.22,467.057 1874.57,489.276 1876.92,329.688 1879.27,284.098 1881.62,460.26 1883.97,562.099 1886.32,396.481 1888.68,395.39 1891.03,407.405 1893.38,424.642 1895.73,341.413 1898.08,475.089 1900.43,375.214 1902.78,297.649 1905.13,385.493 1907.48,543.151 1909.83,489.79 1912.18,547.151 1914.53,450.874 1916.88,580.558 1919.23,478.914 1921.58,481.015 1923.93,561.899 1926.28,420.179 1928.63,458.608 1930.98,461.879 1933.33,605.908 1935.68,637.977 1938.04,441.696 1940.39,407.029 1942.74,278.171 1945.09,399.285 1947.44,539.71 1949.79,395.238 1952.14,405.751 1954.49,449.467 1956.84,641.247 1959.19,416.919 1961.54,548.489 1963.89,594.225 1966.24,386.526 1968.59,301.831 1970.94,376.219 1973.29,597.5 1975.64,478.431 1977.99,387.411 1980.34,299.484 1982.69,485.277 1985.04,495.106 1987.4,352.845 1989.75,382.747 1992.1,477.828 1994.45,499.97 1996.8,388.384 1999.15,416.057 2001.5,545.798 2003.85,399.978 2006.2,350.526 2008.55,496.206 2010.9,383.015 2013.25,415.886 2015.6,311.174 2017.95,650.083 2020.3,607.615 2022.65,330.89 2025,455.827 2027.35,287.301 2029.7,544.074 2032.05,439.331 2034.4,193.967 2036.76,371.7 2039.11,369.182 2041.46,333.369 2043.81,492.386 2046.16,548.461 2048.51,609.328 2050.86,497.067 2053.21,456.121 2055.56,352.917 2057.91,431.146 2060.26,560.241 2062.61,380.745 2064.96,468.731 2067.31,443.661 2069.66,511.35 2072.01,445.38 2074.36,503.22 2076.71,451.804 2079.06,281.03 2081.41,462.433 2083.76,326.617 2086.11,465.215 2088.47,378.517 2090.82,199.086 2093.17,453.687 2095.52,125.623 2097.87,397.757 2100.22,354.031 2102.57,531.445 2104.92,408.957 2107.27,360.01 2109.62,492.408 2111.97,557.615 2114.32,411.505 2116.67,275.436 2119.02,517.991 2121.37,376.625 2123.72,476.133 2126.07,562.37 2128.42,389.877 2130.77,457.161 2133.12,383.413 2135.47,421.467 2137.83,405.358 2140.18,440.449 2142.53,323.945 2144.88,491.471 2147.23,630.342 2149.58,276.054 2151.93,639.924 2154.28,390.718 2156.63,610.138 2158.98,398.734 2161.33,384.331 2163.68,283.142 2166.03,433.458 2168.38,489.439 2170.73,353.669 2173.08,522.562 2175.43,404.054 2177.78,473.034 2180.13,577.193 2182.48,442.703 2184.83,267.322 2187.19,509.017 2189.54,515.296 2191.89,475.508 2194.24,515.018 2196.59,402.714 2198.94,505.805 2201.29,538.983 2203.64,507.74 2205.99,521.209 2208.34,345.425 2210.69,305.91 2213.04,176.833 2215.39,316.947 2217.74,465.198 2220.09,521.501 2222.44,326.648 2224.79,416.692 2227.14,404.218 2229.49,445.417 2231.84,520.775 2234.19,554.348 2236.55,512.634 2238.9,413.298 2241.25,422.444 2243.6,388.408 2245.95,439.651 2248.3,399.955 2250.65,237.153 2253,315.674 2255.35,481.567 2257.7,410.076 2260.05,270.029 2262.4,433.152 2264.75,403.824 2267.1,484.925 2269.45,382.386 2271.8,179.544 2274.15,443.136 2276.5,448.742 2278.85,431.692 2281.2,351.286 2283.55,379.414 2285.91,417.71 2288.26,563.635 2290.61,339.025 2292.96,456.308 2295.31,421.302 2297.66,496.762 2300.01,457.99 2302.36,429.34 2304.71,422.156 2307.06,390.605 2309.41,567.289 2311.76,665.706 2314.11,377.245 2316.46,435.509 2318.81,605.852 2321.16,365.726 2323.51,529.26 2325.86,573.741 2328.21,419.773 2330.56,461.068 2332.91,399.55 2335.27,449.022 2337.62,526.46 2339.97,191.486 2342.32,704.946 2344.67,567.776 2347.02,327.223 2349.37,301.767 2351.72,496.809 2354.07,490.671 2356.42,447.326 2358.77,336.75 2361.12,353.861 2363.47,532.212 2365.82,420.351 2368.17,396.536 2370.52,360.439 2372.87,391.048 2375.22,257.444 2377.57,514.933 2379.92,378.58 2382.27,428.35 2384.62,454.652 2386.98,560.987 2389.33,536.125 2391.68,473.449 2394.03,359.723 2396.38,332.855 2398.73,649.582 2401.08,483.762 2403.43,307.162 2405.78,565.849 2408.13,376.517 2410.48,634.612 2412.83,525.699 2415.18,477.516 2417.53,543.248 2419.88,336.368 2422.23,333.768 2424.58,404.291 2426.93,508.747 2429.28,440.099 2431.63,485.278 2433.98,546.988 2436.34,503.696 2438.69,373.203 2441.04,346.411 2443.39,525.331 2445.74,536.961 2448.09,464.789 2450.44,569.163 2452.79,457.338 2455.14,555.405 2457.49,366.246 2459.84,553.788 2462.19,439.859 2464.54,439.767 2466.89,533.739 2469.24,465.795 2471.59,481.03 2473.94,430.271 2476.29,387.91 2478.64,506.143 2480.99,479.987 2483.34,307.234 2485.7,427.253 2488.05,533.684 2490.4,361.527 2492.75,592.921 2495.1,382.945 2497.45,384.019 2499.8,507.484 2502.15,323.673 2504.5,417.405 2506.85,645.475 2509.2,497.458 2511.55,507.411 2513.9,420.969 2516.25,264.378 2518.6,576.323 2520.95,349.869 2523.3,474.217 2525.65,542.385 2528,516.986 2530.35,509.861 2532.7,472.219 2535.06,439.112 2537.41,390.271 2539.76,632.304 2542.11,590.751 2544.46,389.693 2546.81,438.251 2549.16,447.645 2551.51,567.271 2553.86,654.379 2556.21,658.99 2558.56,589.78 2560.91,393.453 2563.26,439.585 2565.61,404.334 2567.96,468.252 2570.31,543.159 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -1.04194   -2.07356   -3.30249   …  -4.77579   -4.77579   -4.77579
 -0.520883   0.212578   0.364646     -0.644442  -0.644442  -0.644442
  3.99188    5.10792    5.29511       3.3651     3.3651     3.3651

[:, :, 2] =
 -2.79384    -3.7405   -4.40367   -6.10756   …  -5.98911  -6.6224   -6.6224
  0.0415003  -1.67026   0.736122   0.344621      1.41475   1.75554   1.75554
  2.46988     3.2014    5.28166    6.1514        4.16594   4.42855   4.42855

[:, :, 3] =
 -2.65111  -4.87626   -5.1713    -5.1713    …  -4.48941   -4.7824   -5.15086
 -1.26665   0.309623  -0.968981  -0.968981      0.516476   2.03897   0.612584
  1.98498   3.57483    4.2156     4.2156        2.95108    4.22749   5.32276

[:, :, 4] =
 -1.6648   -2.74069   -4.03497  -4.0806   …  -6.04736   -6.50272   -6.87657
  1.13255  -0.352725  -1.24863   1.31561      0.463395  -0.661351  -0.851197
  3.41319   4.79609    6.1518    6.95952      4.88699    5.67605    2.92001</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.98807     0.997817
  0.00221948  1.00563
  5.00613     1.00607</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.8 seconds
Compute duration  = 2.8 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold">  ess_bulk </span> <span class="ansi-bold">  ess_tail </span> <span class="ansi-bold">    rhat </span>  ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>  ⋯

        x[1]   -4.9964    0.9949    0.0170   3430.4949   4937.5873    1.0004   ⋯
        x[2]   -0.0020    1.0115    0.0177   3259.4402   5277.4223    1.0001   ⋯
        x[3]    5.0056    0.9881    0.0180   3013.0025   4983.7922    1.0003   ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

        x[1]   -6.9738   -5.6741   -4.9947   -4.3142   -3.0434
        x[2]   -1.9898   -0.6789   -0.0009    0.6736    1.9621
        x[3]    3.0519    4.3416    4.9990    5.6688    6.9712
</pre>
</div>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.73 seconds
Compute duration  = 1.73 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold">  ess_bulk </span> <span class="ansi-bold">  ess_tail </span> <span class="ansi-bold">    rhat </span>  ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>  ⋯

           x    0.4990    0.1877    0.0029   4177.9372   5753.6078    1.0000   ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

           x    0.1497    0.3599    0.4991    0.6382    0.8484
</pre>
</div>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.25 seconds
Compute duration  = 0.25 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold"> ess_bulk </span> <span class="ansi-bold"> ess_tail </span> <span class="ansi-bold">    rhat </span> <span class="ansi-bold"> e</span> ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  </span> ⋯

           x    0.4714    0.1547    0.0187    62.6339    24.3562    1.0492     ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

           x    0.1996    0.3533    0.4680    0.5871    0.7398
</pre>
</div>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre>DomainError with -1.0836243381834925:
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] <span class="ansi-bold">#371</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [2] <span class="ansi-bold">check_args</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">utils.jl:89</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [3] <span class="ansi-bold">#Normal#370</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [4] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:36</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [5] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:42</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [6] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">compiler.jl:579</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [7] <span class="ansi-bold">demo</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">__model__</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">__varinfo__</span>::DynamicPPL.ThreadSafeVarInfo<span class="ansi-bright-black-fg">{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, Vector{Base.RefValue{Float64}}}</span>, <span class="ansi-bright-black-fg">__context__</span>::DynamicPPL.ValuesAsInModelContext<span class="ansi-bright-black-fg">{OrderedDict{Any, Any}, DynamicPPL.DefaultContext}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/turing-docs/turing-docs/tutorials/docs-17-implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:454</span>
  [8] <span class="ansi-bold">_evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:963</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [9] <span class="ansi-bold">evaluate_threadsafe!!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">varinfo</span>::DynamicPPL.TypedVarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}</span>, <span class="ansi-bright-black-fg">context</span>::DynamicPPL.ValuesAsInModelContext<span class="ansi-bright-black-fg">{OrderedDict{Any, Any}, DynamicPPL.DefaultContext}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:952</span>
 [10] <span class="ansi-bold">evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:887</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [11] <span class="ansi-bold">values_as_in_model</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">values_as_in_model.jl:196</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [12] <span class="ansi-bold">values_as_in_model</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">values_as_in_model.jl:195</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [13] <span class="ansi-bold">getparams</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">vi</span>::DynamicPPL.TypedVarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:328</span>
 [14] <span class="ansi-bold">Turing.Inference.Transition</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">vi</span>::DynamicPPL.TypedVarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}</span>, <span class="ansi-bright-black-fg">t</span>::MALASample<span class="ansi-bright-black-fg">{Vector{Float64}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:224</span>
 [15] <span class="ansi-bold">transition_to_turing</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:12</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [16] <span class="ansi-bold">transition_to_turing</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity<span class="ansi-bright-black-fg">{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}</span>, <span class="ansi-bright-black-fg">transition</span>::MALASample<span class="ansi-bright-black-fg">{Vector{Float64}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:17</span>
 [17] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler_wrapper</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>; <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">initial_params</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:76</span>
 [18] <span class="ansi-bold">step</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:36</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [19] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/YrmkI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:130</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [20] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/YrmkI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:16</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [21] <span class="ansi-bold">mcmcsample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">progress</span>::Bool, <span class="ansi-bright-black-fg">progressname</span>::String, <span class="ansi-bright-black-fg">callback</span>::Nothing, <span class="ansi-bright-black-fg">discard_initial</span>::Int64, <span class="ansi-bright-black-fg">thinning</span>::Int64, <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-yellow-fg">AbstractMCMC</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/YrmkI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:120</span>
 [22] <span class="ansi-bold">sample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">resume_from</span>::Nothing, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{progress::Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:93</span>
 [23] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/E4kDs/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:83</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [24] <span class="ansi-bold">#sample#4</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:263</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [25] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:256</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [26] <span class="ansi-bold">#sample#3</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/aAIq7/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:253</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [27] top-level scope
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/work/turing-docs/turing-docs/tutorials/docs-17-implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:456</span></pre>
</div>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.7 seconds
Compute duration  = 1.7 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold"> ess_bulk </span> <span class="ansi-bold"> ess_tail </span> <span class="ansi-bold">    rhat </span> <span class="ansi-bold"> e</span> ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  </span> ⋯

          σ²    0.1884    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x   -1.0133    0.0000    0.0000        NaN        NaN       NaN     ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

          σ²    0.1884    0.1884    0.1884    0.1884    0.1884
           x   -1.0133   -1.0133   -1.0133   -1.0133   -1.0133
</pre>
</div>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.24 seconds
Compute duration  = 3.24 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold"> ess_bulk </span> <span class="ansi-bold"> ess_tail </span> <span class="ansi-bold">    rhat </span> <span class="ansi-bold"> e</span> ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg">  Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">  </span> ⋯

          σ²    8.5465    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x   -0.7306    0.0000    0.0000        NaN        NaN       NaN     ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>

Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>

          σ²    8.5465    8.5465    8.5465    8.5465    8.5465
           x   -0.7306   -0.7306   -0.7306   -0.7306   -0.7306
</pre>
</div>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../versions.html" class="pagination-link" aria-label="Versions">
        <span class="nav-page-text">Versions</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/TuringTutorials/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/TuringTutorials/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>
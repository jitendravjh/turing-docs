<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.52">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../versions.html" rel="next">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Library API</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">For Developers (Inference)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Documentation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Modelling Syntax and Interface</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-14-using-turing-quick-start/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quick Start</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-09-using-turing-advanced/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Usage</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Turing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">For Developers (PPL)</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">For Developers (Inference)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../versions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Versions</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../changelog.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Changelog</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/TuringTutorials/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/TuringTutorials/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">For Developers (Inference)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-22.608096251461152</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-22.608096251461152</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -2.13363   -5.97462   -5.01286   -4.95153    …  -5.68724  -6.47955  -4.81109
  0.550223   0.253187  -0.144048  -0.0930919      1.6698    1.01807   1.46083
  2.54141    3.00508    4.15723    3.62427        4.17623   4.64387   5.59379</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.02123    1.00418
 -0.0312761  0.997275
  5.01957    0.99331</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip390">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip390)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip391">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip390)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip392">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip392)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip392)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip392)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip392)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip392)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip390)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip390)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip390)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip390)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip390)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip390)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip390)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip390)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip390)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip390)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip390)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip390)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip390)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip390)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip390)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip390)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip390)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip390)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip390)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip390)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip392)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1536.28 2640.76,1536.28 "></polyline>
<polyline clip-path="url(#clip392)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1237.08 2640.76,1237.08 "></polyline>
<polyline clip-path="url(#clip392)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,937.886 2640.76,937.886 "></polyline>
<polyline clip-path="url(#clip392)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,638.691 2640.76,638.691 "></polyline>
<polyline clip-path="url(#clip392)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,339.496 2640.76,339.496 "></polyline>
<polyline clip-path="url(#clip390)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip390)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1536.28 170.644,1536.28 "></polyline>
<polyline clip-path="url(#clip390)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1237.08 170.644,1237.08 "></polyline>
<polyline clip-path="url(#clip390)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,937.886 170.644,937.886 "></polyline>
<polyline clip-path="url(#clip390)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,638.691 170.644,638.691 "></polyline>
<polyline clip-path="url(#clip390)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,339.496 170.644,339.496 "></polyline>
<path clip-path="url(#clip390)" d="M49.5521 1536.73 L79.2279 1536.73 L79.2279 1540.66 L49.5521 1540.66 L49.5521 1536.73 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip390)" d="M99.8991 1534.41 Q96.7509 1534.41 94.8991 1536.57 Q93.0704 1538.72 93.0704 1542.47 Q93.0704 1546.2 94.8991 1548.37 Q96.7509 1550.52 99.8991 1550.52 Q103.047 1550.52 104.876 1548.37 Q106.728 1546.2 106.728 1542.47 Q106.728 1538.72 104.876 1536.57 Q103.047 1534.41 99.8991 1534.41 M109.181 1519.76 L109.181 1524.02 Q107.422 1523.19 105.617 1522.75 Q103.834 1522.31 102.075 1522.31 Q97.4454 1522.31 94.9917 1525.43 Q92.5612 1528.56 92.2139 1534.88 Q93.5797 1532.86 95.6398 1531.8 Q97.7 1530.71 100.177 1530.71 Q105.385 1530.71 108.394 1533.88 Q111.427 1537.03 111.427 1542.47 Q111.427 1547.79 108.279 1551.01 Q105.131 1554.23 99.8991 1554.23 Q93.9037 1554.23 90.7325 1549.64 Q87.5612 1545.04 87.5612 1536.31 Q87.5612 1528.12 91.45 1523.26 Q95.3389 1518.37 101.89 1518.37 Q103.649 1518.37 105.431 1518.72 Q107.237 1519.07 109.181 1519.76 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip390)" d="M50.3623 1237.53 L80.0381 1237.53 L80.0381 1241.47 L50.3623 1241.47 L50.3623 1237.53 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip390)" d="M104.297 1235.73 Q107.654 1236.44 109.529 1238.71 Q111.427 1240.98 111.427 1244.32 Q111.427 1249.43 107.908 1252.23 Q104.39 1255.03 97.9083 1255.03 Q95.7324 1255.03 93.4176 1254.59 Q91.126 1254.18 88.6723 1253.32 L88.6723 1248.81 Q90.6167 1249.94 92.9315 1250.52 Q95.2463 1251.1 97.7695 1251.1 Q102.168 1251.1 104.459 1249.36 Q106.774 1247.63 106.774 1244.32 Q106.774 1241.26 104.621 1239.55 Q102.492 1237.81 98.6722 1237.81 L94.6445 1237.81 L94.6445 1233.97 L98.8574 1233.97 Q102.306 1233.97 104.135 1232.6 Q105.964 1231.21 105.964 1228.62 Q105.964 1225.96 104.066 1224.55 Q102.191 1223.11 98.6722 1223.11 Q96.7509 1223.11 94.5519 1223.53 Q92.3528 1223.94 89.7139 1224.82 L89.7139 1220.66 Q92.376 1219.92 94.6908 1219.55 Q97.0287 1219.18 99.0889 1219.18 Q104.413 1219.18 107.515 1221.61 Q110.617 1224.01 110.617 1228.13 Q110.617 1231 108.973 1233 Q107.33 1234.96 104.297 1235.73 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip390)" d="M99.4824 923.685 Q95.8713 923.685 94.0426 927.25 Q92.2371 930.792 92.2371 937.921 Q92.2371 945.028 94.0426 948.592 Q95.8713 952.134 99.4824 952.134 Q103.117 952.134 104.922 948.592 Q106.751 945.028 106.751 937.921 Q106.751 930.792 104.922 927.25 Q103.117 923.685 99.4824 923.685 M99.4824 919.981 Q105.293 919.981 108.348 924.588 Q111.427 929.171 111.427 937.921 Q111.427 946.648 108.348 951.254 Q105.293 955.838 99.4824 955.838 Q93.6723 955.838 90.5936 951.254 Q87.538 946.648 87.538 937.921 Q87.538 929.171 90.5936 924.588 Q93.6723 919.981 99.4824 919.981 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip390)" d="M104.297 637.337 Q107.654 638.055 109.529 640.323 Q111.427 642.592 111.427 645.925 Q111.427 651.041 107.908 653.842 Q104.39 656.643 97.9083 656.643 Q95.7324 656.643 93.4176 656.203 Q91.126 655.786 88.6723 654.93 L88.6723 650.416 Q90.6167 651.55 92.9315 652.129 Q95.2463 652.708 97.7695 652.708 Q102.168 652.708 104.459 650.971 Q106.774 649.235 106.774 645.925 Q106.774 642.87 104.621 641.157 Q102.492 639.421 98.6722 639.421 L94.6445 639.421 L94.6445 635.578 L98.8574 635.578 Q102.306 635.578 104.135 634.212 Q105.964 632.823 105.964 630.231 Q105.964 627.569 104.066 626.157 Q102.191 624.722 98.6722 624.722 Q96.7509 624.722 94.5519 625.138 Q92.3528 625.555 89.7139 626.435 L89.7139 622.268 Q92.376 621.527 94.6908 621.157 Q97.0287 620.786 99.0889 620.786 Q104.413 620.786 107.515 623.217 Q110.617 625.624 110.617 629.745 Q110.617 632.615 108.973 634.606 Q107.33 636.573 104.297 637.337 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip390)" d="M99.8991 337.633 Q96.7509 337.633 94.8991 339.786 Q93.0704 341.939 93.0704 345.689 Q93.0704 349.415 94.8991 351.591 Q96.7509 353.744 99.8991 353.744 Q103.047 353.744 104.876 351.591 Q106.728 349.415 106.728 345.689 Q106.728 341.939 104.876 339.786 Q103.047 337.633 99.8991 337.633 M109.181 322.98 L109.181 327.24 Q107.422 326.406 105.617 325.966 Q103.834 325.527 102.075 325.527 Q97.4454 325.527 94.9917 328.652 Q92.5612 331.777 92.2139 338.096 Q93.5797 336.082 95.6398 335.017 Q97.7 333.929 100.177 333.929 Q105.385 333.929 108.394 337.101 Q111.427 340.249 111.427 345.689 Q111.427 351.013 108.279 354.23 Q105.131 357.448 99.8991 357.448 Q93.9037 357.448 90.7325 352.864 Q87.5612 348.258 87.5612 339.531 Q87.5612 331.337 91.45 326.476 Q95.3389 321.591 101.89 321.591 Q103.649 321.591 105.431 321.939 Q107.237 322.286 109.181 322.98 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip392)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1150.68 224.541,1364.02 226.891,1343.47 229.242,1528.83 231.592,1390.32 233.943,1528.72 236.293,1439.59 238.644,1270.36 240.994,1414.8 243.345,1410.18 245.695,1551.42 248.046,1215.8 250.396,1540.86 252.747,1384.27 255.097,1186.04 257.448,1478.63 259.798,1364.12 262.148,1378.4 264.499,1518.43 266.849,1580.72 269.2,1330.55 271.55,1402.83 273.901,1520.73 276.251,1446.69 278.602,1194.15 280.952,1375.21 283.303,1463.89 285.653,1490.99 288.004,1460.91 290.354,1394.58 292.705,1536.9 295.055,1432.3 297.406,1420.72 299.756,1463.26 302.107,1463.68 304.457,1312.18 306.807,1373.88 309.158,1558.24 311.508,1441.17 313.859,1292.06 316.209,1406.83 318.56,1456.45 320.91,1515.23 323.261,1580.42 325.611,1601.88 327.962,1426.47 330.312,1329.85 332.663,1529.68 335.013,1429.3 337.364,1401.71 339.714,1332.56 342.065,1509.86 344.415,1481.35 346.765,1496.25 349.116,1546.11 351.466,1256.78 353.817,1401.85 356.167,1367.66 358.518,1264.34 360.868,1363.71 363.219,1490.44 365.569,1446.94 367.92,1343.92 370.27,1411.66 372.621,1458.24 374.971,1427.78 377.322,1575.21 379.672,1523.99 382.023,1365.8 384.373,1401.27 386.724,1493.16 389.074,1529.33 391.424,1510.05 393.775,1601.57 396.125,1527.37 398.476,1394.72 400.826,1570.01 403.177,1338.72 405.527,1563.92 407.878,1488.91 410.228,1482.82 412.579,1242.54 414.929,1200.5 417.28,1461.9 419.63,1598.69 421.981,1376.42 424.331,1438.39 426.682,1407.63 429.032,1453.18 431.382,1403.23 433.733,1437.39 436.083,1332.57 438.434,1557.65 440.784,1286.42 443.135,1496.39 445.485,1443.67 447.836,1399.23 450.186,1450.95 452.537,1282.22 454.887,1442.5 457.238,1465.88 459.588,1310.94 461.939,1573.74 464.289,1373.7 466.64,1510.49 468.99,1461.77 471.341,1501.41 473.691,1400.03 476.041,1287.34 478.392,1394.3 480.742,1532.22 483.093,1318.64 485.443,1463.52 487.794,1482.69 490.144,1375 492.495,1277.2 494.845,1335.04 497.196,1435.97 499.546,1475.73 501.897,1270.15 504.247,1576.11 506.598,1449.87 508.948,1738.33 511.299,1507.89 513.649,1523.23 515.999,1316.24 518.35,1394.44 520.7,1537.18 523.051,1232.83 525.401,1512.18 527.752,1558.65 530.102,1452.05 532.453,1498.9 534.803,1589.72 537.154,1584.31 539.504,1467.03 541.855,1542.06 544.205,1378.46 546.556,1489.76 548.906,1523.26 551.257,1389.73 553.607,1633.1 555.958,1485.23 558.308,1640.66 560.658,1448.79 563.009,1479.56 565.359,1345.99 567.71,1564.49 570.06,1370.3 572.411,1241.39 574.761,1558.01 577.112,1344.97 579.462,1266.98 581.813,1538.89 584.163,1413.25 586.514,1301.29 588.864,1493.52 591.215,1460.38 593.565,1356.21 595.916,1417.6 598.266,1653.62 600.616,1467.28 602.967,1622.38 605.317,1643.27 607.668,1492 610.018,1389.6 612.369,1576.7 614.719,1546.54 617.07,1273.1 619.42,1605.81 621.771,1342.67 624.121,1549 626.472,1489.67 628.822,1303.48 631.173,1219.11 633.523,1611.62 635.874,1411.73 638.224,1424.47 640.575,1428.71 642.925,1402.76 645.275,1477.8 647.626,1322.38 649.976,1474.51 652.327,1546.38 654.677,1410.03 657.028,1500.05 659.378,1371.83 661.729,1564.53 664.079,1417.42 666.43,1505.47 668.78,1354.68 671.131,1631.77 673.481,1421.17 675.832,1340.86 678.182,1523.43 680.533,1509.42 682.883,1430.73 685.233,1302.51 687.584,1271.41 689.934,1358.47 692.285,1362.47 694.635,1450.41 696.986,1513.96 699.336,1455.91 701.687,1625.79 704.037,1444.12 706.388,1411.43 708.738,1353.83 711.089,1412.66 713.439,1535.19 715.79,1525.27 718.14,1427.24 720.491,1288.9 722.841,1547.17 725.192,1408.34 727.542,1558.12 729.892,1559.52 732.243,1469.97 734.593,1317.03 736.944,1332.2 739.294,1419.26 741.645,1474.62 743.995,1294.7 746.346,1263.16 748.696,1447.62 751.047,1239.45 753.397,1477.54 755.748,1578.17 758.098,1534.99 760.449,1403.69 762.799,1244.82 765.15,1604.42 767.5,1484.8 769.85,1416.19 772.201,1518.59 774.551,1493.22 776.902,1503.6 779.252,1533.65 781.603,1350.39 783.953,1562.44 786.304,1451.95 788.654,1437.1 791.005,1327.68 793.355,1486.41 795.706,1395.18 798.056,1466.22 800.407,1444.46 802.757,1481.75 805.108,1409.43 807.458,1552.39 809.809,1461.91 812.159,1400.13 814.509,1368.9 816.86,1311.99 819.21,1402.63 821.561,1518.19 823.911,1442.65 826.262,1344.83 828.612,1449.07 830.963,1392.72 833.313,1347.72 835.664,1379.78 838.014,1343.21 840.365,1427.17 842.715,1579.48 845.066,1259.66 847.416,1291.78 849.767,1339.22 852.117,1490.46 854.467,1428.34 856.818,1429.4 859.168,1386.03 861.519,1481.5 863.869,1511.62 866.22,1561.55 868.57,1404.58 870.921,1437.62 873.271,1422.22 875.622,1501.32 877.972,1415.63 880.323,1423.76 882.673,1333.14 885.024,1335.15 887.374,1469.29 889.725,1303.8 892.075,1449.27 894.426,1545.06 896.776,1489.29 899.126,1463.16 901.477,1492.19 903.827,1364.02 906.178,1582.17 908.528,1190.91 910.879,1225.88 913.229,1553.74 915.58,1145.97 917.93,1447.14 920.281,1518.15 922.631,1557.8 924.982,1446.11 927.332,1500.34 929.683,1548.87 932.033,1442.39 934.384,1411.01 936.734,1335.6 939.084,1381.85 941.435,1384.01 943.785,1407.04 946.136,1432.25 948.486,1574.83 950.837,1533.53 953.187,1468.64 955.538,1466.26 957.888,1367.53 960.239,1425.09 962.589,1527.06 964.94,1540.46 967.29,1422.75 969.641,1522.65 971.991,1505.98 974.342,1473.68 976.692,1507.73 979.043,1571.16 981.393,1322.68 983.743,1594.17 986.094,1555.82 988.444,1371.1 990.795,1627.67 993.145,1470.16 995.496,1473.89 997.846,1365.82 1000.2,1438.79 1002.55,1579.6 1004.9,1481.11 1007.25,1580.86 1009.6,1543.28 1011.95,1391.09 1014.3,1516.54 1016.65,1370.48 1019,1602.72 1021.35,1525.7 1023.7,1495.81 1026.05,1264.56 1028.4,1384.62 1030.75,1452.06 1033.1,1503.66 1035.45,1512.5 1037.8,1409.84 1040.15,1420.9 1042.51,1332.09 1044.86,1343.41 1047.21,1186.08 1049.56,1458.49 1051.91,1540.31 1054.26,1508.61 1056.61,1568.69 1058.96,1272.49 1061.31,1268.59 1063.66,1446.45 1066.01,1280.26 1068.36,1394.77 1070.71,1415.86 1073.06,1406.77 1075.41,1548.51 1077.76,1351.25 1080.11,1336.33 1082.46,1477.13 1084.81,1402.33 1087.16,1470.67 1089.51,1533.99 1091.87,1538.52 1094.22,1389.33 1096.57,1439.39 1098.92,1431.95 1101.27,1491.83 1103.62,1436.78 1105.97,1423.91 1108.32,1346.65 1110.67,1507.16 1113.02,1505.85 1115.37,1422.48 1117.72,1346.09 1120.07,1511.21 1122.42,1455.73 1124.77,1499.16 1127.12,1483.24 1129.47,1313.45 1131.82,1587.44 1134.17,1408.54 1136.52,1378.21 1138.87,1427.05 1141.23,1532.63 1143.58,1250.81 1145.93,1366.05 1148.28,1170.64 1150.63,1490.94 1152.98,1451.4 1155.33,1306.59 1157.68,1387.95 1160.03,1529.72 1162.38,1358.85 1164.73,1340.85 1167.08,1184.66 1169.43,1224.71 1171.78,1420.47 1174.13,1256.82 1176.48,1401.85 1178.83,1300.64 1181.18,1597.39 1183.53,1319.55 1185.88,1513.6 1188.23,1444.64 1190.59,1448.14 1192.94,1504.92 1195.29,1359.86 1197.64,1346.84 1199.99,1549.1 1202.34,1547.91 1204.69,1524.51 1207.04,1569.92 1209.39,1519.56 1211.74,1579.2 1214.09,1298.86 1216.44,1614.21 1218.79,1406.58 1221.14,1376.17 1223.49,1321.43 1225.84,1439.07 1228.19,1543.15 1230.54,1324.96 1232.89,1378.7 1235.24,1420.51 1237.59,1449.45 1239.94,1459.18 1242.3,1345.77 1244.65,1379.42 1247,1495.21 1249.35,1501.02 1251.7,1415.47 1254.05,1417.3 1256.4,1398.99 1258.75,1359.96 1261.1,1415.64 1263.45,1511.49 1265.8,1418.32 1268.15,1419.55 1270.5,1554.76 1272.85,1492.24 1275.2,1404.16 1277.55,1320.51 1279.9,1507.46 1282.25,1606.61 1284.6,1389.32 1286.95,1344.46 1289.3,1496.08 1291.66,1506.97 1294.01,1537.61 1296.36,1375.65 1298.71,1482.76 1301.06,1382.99 1303.41,1367.19 1305.76,1459.89 1308.11,1379.66 1310.46,1438.03 1312.81,1515.81 1315.16,1489.86 1317.51,1478.76 1319.86,1418.86 1322.21,1377.03 1324.56,1465.57 1326.91,1417.79 1329.26,1445.98 1331.61,1504.17 1333.96,1598.43 1336.31,1546.18 1338.66,1349.89 1341.02,1346.66 1343.37,1604.71 1345.72,1444.08 1348.07,1685.6 1350.42,1597.97 1352.77,1291.42 1355.12,1331.24 1357.47,1483.39 1359.82,1437.64 1362.17,1364.76 1364.52,1543.63 1366.87,1482.1 1369.22,1478.28 1371.57,1460.06 1373.92,1445.73 1376.27,1553.84 1378.62,1367.08 1380.97,1479.48 1383.32,1451.17 1385.67,1452.21 1388.02,1445.8 1390.38,1494.76 1392.73,1748.27 1395.08,1245.12 1397.43,1383.32 1399.78,1237.14 1402.13,1342.79 1404.48,1264.8 1406.83,1436.62 1409.18,1250.09 1411.53,1461.37 1413.88,1408.7 1416.23,1380.32 1418.58,1497.54 1420.93,1594.75 1423.28,1457.02 1425.63,1307.92 1427.98,1415.51 1430.33,1228.03 1432.68,1634.61 1435.03,1351.2 1437.38,1250.37 1439.74,1282.74 1442.09,1182.82 1444.44,1517.75 1446.79,1567.89 1449.14,1471.17 1451.49,1340.85 1453.84,1481.39 1456.19,1343.42 1458.54,1416.08 1460.89,1321.79 1463.24,1459.04 1465.59,1651.75 1467.94,1549.3 1470.29,1402.85 1472.64,1378.89 1474.99,1569.41 1477.34,1403.66 1479.69,1488.62 1482.04,1379.78 1484.39,1523.62 1486.74,1470.27 1489.1,1545.26 1491.45,1255.02 1493.8,1514.08 1496.15,1438.95 1498.5,1423.62 1500.85,1315.24 1503.2,1394.81 1505.55,1429.86 1507.9,1517.93 1510.25,1420.2 1512.6,1427.71 1514.95,1320.42 1517.3,1303.1 1519.65,1581.47 1522,1402.92 1524.35,1538.31 1526.7,1391.16 1529.05,1695.96 1531.4,1362.66 1533.75,1431.85 1536.1,1504.75 1538.45,1369.27 1540.81,1534.91 1543.16,1361.54 1545.51,1376.82 1547.86,1635.54 1550.21,1515.75 1552.56,1522.49 1554.91,1555.9 1557.26,1427.81 1559.61,1342.08 1561.96,1354.91 1564.31,1570.03 1566.66,1404.27 1569.01,1553.4 1571.36,1561.7 1573.71,1517.85 1576.06,1567.04 1578.41,1565.55 1580.76,1488.43 1583.11,1532.19 1585.46,1379.3 1587.81,1463.12 1590.17,1377.37 1592.52,1365.27 1594.87,1232.96 1597.22,1408.32 1599.57,1402.87 1601.92,1382.37 1604.27,1564.08 1606.62,1698.43 1608.97,1440.2 1611.32,1700.64 1613.67,1373.2 1616.02,1564.34 1618.37,1593.41 1620.72,1358.31 1623.07,1590.37 1625.42,1422.47 1627.77,1582.43 1630.12,1352.36 1632.47,1476.85 1634.82,1459.09 1637.17,1324.13 1639.53,1327.19 1641.88,1321.77 1644.23,1351.87 1646.58,1484.66 1648.93,1351.97 1651.28,1621.74 1653.63,1496 1655.98,1466.53 1658.33,1193.49 1660.68,1354.48 1663.03,1438.15 1665.38,1303.88 1667.73,1406.44 1670.08,1463.38 1672.43,1261.61 1674.78,1286.25 1677.13,1578.5 1679.48,1424.61 1681.83,1279.92 1684.18,1622.68 1686.53,1518.11 1688.89,1517.22 1691.24,1220.55 1693.59,1555.24 1695.94,1377.74 1698.29,1263.25 1700.64,1417.4 1702.99,1444.44 1705.34,1653.19 1707.69,1614.9 1710.04,1435.13 1712.39,1505.07 1714.74,1419.92 1717.09,1443.24 1719.44,1450.9 1721.79,1247.62 1724.14,1460.41 1726.49,1408.01 1728.84,1670.66 1731.19,1256.5 1733.54,1438.47 1735.89,1263.8 1738.25,1209.49 1740.6,1365.25 1742.95,1431.67 1745.3,1326.19 1747.65,1516.92 1750,1429.97 1752.35,1467.35 1754.7,1448.16 1757.05,1455.59 1759.4,1438.18 1761.75,1494.95 1764.1,1315.45 1766.45,1548.69 1768.8,1481.35 1771.15,1392.21 1773.5,1318.29 1775.85,1585.04 1778.2,1594.27 1780.55,1479.96 1782.9,1420.17 1785.25,1327.89 1787.6,1361.38 1789.96,1345.08 1792.31,1457.78 1794.66,1478.47 1797.01,1204.77 1799.36,1300.09 1801.71,1586.46 1804.06,1548.86 1806.41,1546.54 1808.76,1314.03 1811.11,1385.84 1813.46,1513.35 1815.81,1421.38 1818.16,1367.65 1820.51,1451.52 1822.86,1470.16 1825.21,1414.53 1827.56,1273.02 1829.91,1496.23 1832.26,1320.84 1834.61,1532.01 1836.96,1461.57 1839.32,1572.53 1841.67,1291.11 1844.02,1560.2 1846.37,1365.59 1848.72,1454.49 1851.07,1365.91 1853.42,1420.91 1855.77,1345.74 1858.12,1322.9 1860.47,1373.31 1862.82,1521.08 1865.17,1463.52 1867.52,1465.24 1869.87,1323.26 1872.22,1417.96 1874.57,1392.34 1876.92,1417.3 1879.27,1376.8 1881.62,1341.67 1883.97,1485.35 1886.32,1489.4 1888.68,1552.93 1891.03,1400.45 1893.38,1472.85 1895.73,1510.65 1898.08,1541.61 1900.43,1364.96 1902.78,1363.53 1905.13,1644.98 1907.48,1451.5 1909.83,1427.51 1912.18,1598.15 1914.53,1561.37 1916.88,1439.72 1919.23,1406.9 1921.58,1504.49 1923.93,1533.89 1926.28,1466.73 1928.63,1456.43 1930.98,1576.49 1933.33,1346.4 1935.68,1415.1 1938.04,1465.57 1940.39,1590 1942.74,1581.54 1945.09,1343.18 1947.44,1513.95 1949.79,1633.62 1952.14,1546.48 1954.49,1351.93 1956.84,1527.75 1959.19,1269.22 1961.54,1267.48 1963.89,1416.68 1966.24,1532.63 1968.59,1466.18 1970.94,1469 1973.29,1380.56 1975.64,1301.96 1977.99,1392.2 1980.34,1351.28 1982.69,1352.08 1985.04,1422.73 1987.4,1437.28 1989.75,1268.14 1992.1,1465.74 1994.45,1435.72 1996.8,1341.95 1999.15,1421.18 2001.5,1588.34 2003.85,1407.07 2006.2,1624.05 2008.55,1277.11 2010.9,1431.74 2013.25,1291.19 2015.6,1500.23 2017.95,1419.6 2020.3,1365.59 2022.65,1480.42 2025,1577.65 2027.35,1417.85 2029.7,1392.04 2032.05,1457.15 2034.4,1288.9 2036.76,1596.26 2039.11,1488.86 2041.46,1325.36 2043.81,1431.47 2046.16,1261.72 2048.51,1447.66 2050.86,1502.31 2053.21,1481.35 2055.56,1493.31 2057.91,1498.07 2060.26,1438.68 2062.61,1523.26 2064.96,1417.03 2067.31,1573.2 2069.66,1565.13 2072.01,1351.14 2074.36,1382.09 2076.71,1634.3 2079.06,1534.03 2081.41,1366.41 2083.76,1421.57 2086.11,1548.6 2088.47,1582.09 2090.82,1453.78 2093.17,1366.23 2095.52,1382.94 2097.87,1433.95 2100.22,1465.13 2102.57,1387.82 2104.92,1487.41 2107.27,1294.58 2109.62,1634.25 2111.97,1353.88 2114.32,1329.74 2116.67,1458.7 2119.02,1497.36 2121.37,1481.88 2123.72,1565.64 2126.07,1411.7 2128.42,1422.82 2130.77,1378.49 2133.12,1539.83 2135.47,1365.44 2137.83,1302.68 2140.18,1381.17 2142.53,1605.48 2144.88,1135.78 2147.23,1496.88 2149.58,1518.22 2151.93,1307.44 2154.28,1544.36 2156.63,1405.38 2158.98,1523.7 2161.33,1433.31 2163.68,1458.42 2166.03,1211.51 2168.38,1437.25 2170.73,1519.34 2173.08,1475.38 2175.43,1356.75 2177.78,1381.27 2180.13,1467.95 2182.48,1591.98 2184.83,1560.29 2187.19,1319.02 2189.54,1479.39 2191.89,1465.12 2194.24,1541.56 2196.59,1418.4 2198.94,1336.32 2201.29,1400.08 2203.64,1530.58 2205.99,1505.05 2208.34,1519.64 2210.69,1410.79 2213.04,1477.03 2215.39,1467.22 2217.74,1471.07 2220.09,1380.26 2222.44,1632.52 2224.79,1500.42 2227.14,1455.84 2229.49,1430.24 2231.84,1532.7 2234.19,1448.34 2236.55,1447.66 2238.9,1473.01 2241.25,1375.43 2243.6,1659.13 2245.95,1418.15 2248.3,1323.96 2250.65,1456.09 2253,1542.23 2255.35,1463.95 2257.7,1441.84 2260.05,1375.68 2262.4,1430.44 2264.75,1411.54 2267.1,1361.96 2269.45,1338.18 2271.8,1090.5 2274.15,1453.13 2276.5,1363.48 2278.85,1432.36 2281.2,1466.9 2283.55,1517.12 2285.91,1368.92 2288.26,1454.94 2290.61,1603.47 2292.96,1353.7 2295.31,1408.46 2297.66,1509.47 2300.01,1364.6 2302.36,1367.82 2304.71,1751.15 2307.06,1479.35 2309.41,1589.72 2311.76,1382.93 2314.11,1325.81 2316.46,1288.57 2318.81,1612.33 2321.16,1461.83 2323.51,1477.01 2325.86,1508.97 2328.21,1438.06 2330.56,1490.27 2332.91,1274.05 2335.27,1355.6 2337.62,1462.04 2339.97,1346.69 2342.32,1561.78 2344.67,1234.3 2347.02,1502.63 2349.37,1502.58 2351.72,1394.61 2354.07,1537.74 2356.42,1495.38 2358.77,1264.36 2361.12,1455.02 2363.47,1479.34 2365.82,1402.3 2368.17,1468.68 2370.52,1481.89 2372.87,1412.14 2375.22,1439.2 2377.57,1315.55 2379.92,1507.93 2382.27,1551.27 2384.62,1388.15 2386.98,1451.45 2389.33,1569.83 2391.68,1299.73 2394.03,1650.54 2396.38,1452.31 2398.73,1356.65 2401.08,1480.93 2403.43,1533.23 2405.78,1570.06 2408.13,1438.93 2410.48,1495.13 2412.83,1508.87 2415.18,1568.9 2417.53,1221.88 2419.88,1603.09 2422.23,1483.58 2424.58,1477.34 2426.93,1469.32 2429.28,1427.63 2431.63,1095.47 2433.98,1310.54 2436.34,1559.02 2438.69,1447.81 2441.04,1369.18 2443.39,1394.51 2445.74,1303.55 2448.09,1353.25 2450.44,1179.91 2452.79,1339.32 2455.14,1448.25 2457.49,1448.73 2459.84,1498.54 2462.19,1506.39 2464.54,1420.3 2466.89,1513.62 2469.24,1473.44 2471.59,1517.5 2473.94,1351.21 2476.29,1536.02 2478.64,1458.39 2480.99,1489.38 2483.34,1317.55 2485.7,1568.74 2488.05,1549.57 2490.4,1516.56 2492.75,1535.94 2495.1,1212.29 2497.45,1510.99 2499.8,1475.02 2502.15,1372.69 2504.5,1438.72 2506.85,1548.25 2509.2,1371.34 2511.55,1454.68 2513.9,1321.93 2516.25,1471.13 2518.6,1559.75 2520.95,1455.8 2523.3,1364.43 2525.65,1356.75 2528,1503.17 2530.35,1429.19 2532.7,1328.06 2535.06,1535.24 2537.41,1506.76 2539.76,1666.19 2542.11,1247 2544.46,1393.91 2546.81,1366.8 2549.16,1429.51 2551.51,1270.36 2553.86,1406.42 2556.21,1316.72 2558.56,1460.19 2560.91,1522.92 2563.26,1380.77 2565.61,1577.07 2567.96,1503.95 2570.31,1368.66 "></polyline>
<polyline clip-path="url(#clip392)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,883.012 224.541,926.985 226.891,927.736 229.242,893.2 231.592,1062.36 233.943,1091 236.293,1041.67 238.644,1016.76 240.994,1031.23 243.345,960.029 245.695,1091.78 248.046,1064.37 250.396,781.529 252.747,906.205 255.097,833.703 257.448,901.698 259.798,1160.75 262.148,898.29 264.499,872.054 266.849,892.126 269.2,1050.62 271.55,916.585 273.901,1119.76 276.251,788.723 278.602,812.333 280.952,1102.74 283.303,937.537 285.653,972.471 288.004,902.659 290.354,873.992 292.705,904.553 295.055,797.321 297.406,1066.99 299.756,916.719 302.107,1014.64 304.457,719.108 306.807,945.321 309.158,927.485 311.508,888.025 313.859,841.534 316.209,930.434 318.56,822.449 320.91,892.737 323.261,993.215 325.611,929.732 327.962,1110.84 330.312,958.558 332.663,882.238 335.013,900.122 337.364,1001.33 339.714,1022.69 342.065,1127.78 344.415,1284.44 346.765,838.784 349.116,1026.88 351.466,1072.94 353.817,936.415 356.167,1114.48 358.518,1042.53 360.868,975.85 363.219,985.336 365.569,890.629 367.92,963.675 370.27,970.333 372.621,731.026 374.971,728.952 377.322,835.981 379.672,988.054 382.023,1062.99 384.373,876.949 386.724,1028.9 389.074,942.309 391.424,967.714 393.775,993.263 396.125,953.066 398.476,805.036 400.826,832.7 403.177,797.841 405.527,942.008 407.878,967.613 410.228,1001.44 412.579,812.897 414.929,958.859 417.28,862.941 419.63,772.997 421.981,865.369 424.331,982.753 426.682,975.749 429.032,936.938 431.382,962.131 433.733,1005.98 436.083,744.065 438.434,909.198 440.784,809.559 443.135,989.581 445.485,1020.74 447.836,981.576 450.186,883.986 452.537,864.919 454.887,1104.9 457.238,770.715 459.588,870.694 461.939,918.755 464.289,897.739 466.64,958.616 468.99,861.412 471.341,953.362 473.691,1002.95 476.041,1061.12 478.392,1159.97 480.742,951.784 483.093,983.754 485.443,855.442 487.794,898.68 490.144,977.565 492.495,945.348 494.845,1073.4 497.196,974.58 499.546,957.106 501.897,777.024 504.247,1117.23 506.598,1079.12 508.948,934.148 511.299,967.732 513.649,820.949 515.999,975.995 518.35,1027.32 520.7,939.139 523.051,817.484 525.401,822.756 527.752,977.783 530.102,1032.85 532.453,938.53 534.803,966.468 537.154,942.016 539.504,940.101 541.855,1030.71 544.205,910.08 546.556,909.35 548.906,994.299 551.257,814.97 553.607,827.243 555.958,910.219 558.308,873.974 560.658,827.866 563.009,866.72 565.359,833.742 567.71,958.618 570.06,1032.97 572.411,967.707 574.761,1024.79 577.112,884.539 579.462,863.752 581.813,1147.05 584.163,906.729 586.514,988.56 588.864,864.007 591.215,912.544 593.565,827.615 595.916,890.588 598.266,859.15 600.616,861.164 602.967,1092.92 605.317,755.136 607.668,1016.41 610.018,906.6 612.369,908.036 614.719,826.23 617.07,904.543 619.42,1084.13 621.771,975.729 624.121,907.904 626.472,1045.25 628.822,1007.16 631.173,921.967 633.523,1028.97 635.874,864.818 638.224,890.087 640.575,886.554 642.925,954.855 645.275,963.368 647.626,860.64 649.976,962.056 652.327,986.962 654.677,973.484 657.028,936.481 659.378,912.671 661.729,989.078 664.079,802.383 666.43,977.984 668.78,818.643 671.131,1040.87 673.481,1000.15 675.832,935.52 678.182,864.334 680.533,1007.78 682.883,825.252 685.233,1047.69 687.584,901.675 689.934,1129.4 692.285,845.139 694.635,863.346 696.986,939.652 699.336,840.85 701.687,792.459 704.037,1025.4 706.388,979.19 708.738,953.454 711.089,934.059 713.439,997.841 715.79,946.331 718.14,836.21 720.491,861.616 722.841,902.429 725.192,974.145 727.542,825.248 729.892,902.477 732.243,858.646 734.593,965.346 736.944,650.867 739.294,1056.74 741.645,728.161 743.995,847.991 746.346,920.819 748.696,772.504 751.047,1001.38 753.397,844.787 755.748,870.592 758.098,980.965 760.449,1004.61 762.799,798.996 765.15,804.82 767.5,979.89 769.85,1108.13 772.201,984.047 774.551,1014.74 776.902,952.44 779.252,1016.3 781.603,884.186 783.953,942.248 786.304,899.688 788.654,877.017 791.005,936.006 793.355,958.199 795.706,1087.94 798.056,874.672 800.407,829.254 802.757,1020.09 805.108,834.785 807.458,911.486 809.809,1007.96 812.159,916.535 814.509,886.638 816.86,863.794 819.21,1008.52 821.561,891.383 823.911,1128.35 826.262,945.289 828.612,800.061 830.963,915.407 833.313,1047.87 835.664,952.329 838.014,933.454 840.365,923.036 842.715,1003.62 845.066,813.346 847.416,902.389 849.767,1019.24 852.117,1147.2 854.467,1007.09 856.818,928.198 859.168,696.643 861.519,1088.67 863.869,965.593 866.22,848.189 868.57,922.568 870.921,940.243 873.271,861.861 875.622,912.598 877.972,783.123 880.323,1070.64 882.673,945.675 885.024,1080.72 887.374,987.392 889.725,933.485 892.075,1050.46 894.426,1099.05 896.776,928.916 899.126,900.519 901.477,895.52 903.827,831.826 906.178,920.315 908.528,760.754 910.879,919.348 913.229,1083.02 915.58,959.72 917.93,993.924 920.281,947.259 922.631,919.08 924.982,851.817 927.332,945.186 929.683,930.193 932.033,904.779 934.384,860.164 936.734,1017.4 939.084,854.435 941.435,1068.98 943.785,958.847 946.136,920.941 948.486,933.896 950.837,913.727 953.187,767.232 955.538,777.614 957.888,914.094 960.239,916.892 962.589,908.751 964.94,947.701 967.29,948.404 969.641,1011.33 971.991,823.58 974.342,954.013 976.692,1103.52 979.043,954.465 981.393,994.309 983.743,1031.63 986.094,1017.95 988.444,941.202 990.795,912.719 993.145,976.483 995.496,1135.02 997.846,927.553 1000.2,829.303 1002.55,932.968 1004.9,907.898 1007.25,935.762 1009.6,935.975 1011.95,982.067 1014.3,915.624 1016.65,922.819 1019,918.594 1021.35,853.106 1023.7,943.888 1026.05,874.815 1028.4,857.063 1030.75,936.105 1033.1,1089.35 1035.45,917.096 1037.8,864.5 1040.15,1064.69 1042.51,1011.37 1044.86,1052.58 1047.21,1011.19 1049.56,860.519 1051.91,951.666 1054.26,1001.9 1056.61,937.752 1058.96,841.428 1061.31,848.458 1063.66,1016.07 1066.01,965.537 1068.36,697.906 1070.71,895.632 1073.06,866.076 1075.41,954.734 1077.76,1106 1080.11,900.459 1082.46,840.79 1084.81,847.648 1087.16,1034.53 1089.51,969.298 1091.87,946.949 1094.22,904.406 1096.57,864.521 1098.92,1074.41 1101.27,787.819 1103.62,829.472 1105.97,887.925 1108.32,976.514 1110.67,795.703 1113.02,793.653 1115.37,881.806 1117.72,940.312 1120.07,972.241 1122.42,759.198 1124.77,994.164 1127.12,1141.27 1129.47,1063.84 1131.82,810.704 1134.17,1057.29 1136.52,878.416 1138.87,967.082 1141.23,986.127 1143.58,857.126 1145.93,807.107 1148.28,1088.71 1150.63,821.736 1152.98,908.142 1155.33,1028.06 1157.68,1011.29 1160.03,857.438 1162.38,879.253 1164.73,708.287 1167.08,1096.52 1169.43,1040.38 1171.78,900.06 1174.13,912.721 1176.48,1005.68 1178.83,1040.98 1181.18,850.388 1183.53,987.524 1185.88,941.28 1188.23,985.362 1190.59,880.669 1192.94,797.373 1195.29,1066.2 1197.64,928.816 1199.99,973.069 1202.34,847.455 1204.69,1040.4 1207.04,827.528 1209.39,1057.7 1211.74,870.278 1214.09,930.806 1216.44,864.393 1218.79,1042.57 1221.14,999.295 1223.49,922.862 1225.84,944.407 1228.19,895 1230.54,758.959 1232.89,894.317 1235.24,895.673 1237.59,995.452 1239.94,1098.31 1242.3,1016.89 1244.65,947.688 1247,797.788 1249.35,910.032 1251.7,848.351 1254.05,997.736 1256.4,1015.02 1258.75,843.227 1261.1,1040.82 1263.45,882.453 1265.8,1050.25 1268.15,876.491 1270.5,1132.35 1272.85,956.17 1275.2,1001.21 1277.55,943.381 1279.9,844.269 1282.25,907.584 1284.6,751.378 1286.95,1149.82 1289.3,865.262 1291.66,801.826 1294.01,842.008 1296.36,908.604 1298.71,815.848 1301.06,1063.24 1303.41,888.837 1305.76,942.879 1308.11,898.327 1310.46,782.591 1312.81,877.499 1315.16,1114.45 1317.51,873.627 1319.86,1089.4 1322.21,848.426 1324.56,1051.58 1326.91,905.384 1329.26,916.202 1331.61,803.803 1333.96,948.051 1336.31,867.979 1338.66,884.283 1341.02,854.46 1343.37,1047.33 1345.72,894.09 1348.07,893.649 1350.42,851.751 1352.77,1010.76 1355.12,882.034 1357.47,1059.42 1359.82,1042.18 1362.17,852.918 1364.52,944.698 1366.87,986.543 1369.22,845.328 1371.57,927.76 1373.92,957.243 1376.27,861.154 1378.62,1049.8 1380.97,1026.91 1383.32,906.561 1385.67,934.774 1388.02,1106.76 1390.38,873.399 1392.73,757.159 1395.08,982.269 1397.43,763.744 1399.78,1157.97 1402.13,822.481 1404.48,898.737 1406.83,1024.06 1409.18,1167.49 1411.53,845.291 1413.88,878.936 1416.23,1073.79 1418.58,873.834 1420.93,1063.21 1423.28,943.863 1425.63,876.315 1427.98,815.445 1430.33,853.598 1432.68,770.057 1435.03,947.606 1437.38,946.142 1439.74,1094.69 1442.09,911.083 1444.44,1046.48 1446.79,1064.27 1449.14,1025.08 1451.49,895.157 1453.84,914.678 1456.19,1118.55 1458.54,1138.99 1460.89,1197.33 1463.24,1061.05 1465.59,872.398 1467.94,899.998 1470.29,743.286 1472.64,921.434 1474.99,1001.13 1477.34,836.53 1479.69,891.077 1482.04,940.588 1484.39,864.831 1486.74,875.19 1489.1,873.713 1491.45,783.571 1493.8,1143.73 1496.15,949.818 1498.5,771.737 1500.85,1013.56 1503.2,867.012 1505.55,932.241 1507.9,983.094 1510.25,993.435 1512.6,857.076 1514.95,836.669 1517.3,1098.74 1519.65,904.434 1522,831.64 1524.35,964.276 1526.7,869.111 1529.05,920.782 1531.4,858.01 1533.75,972.211 1536.1,879.016 1538.45,1019.69 1540.81,926.161 1543.16,976.081 1545.51,794.971 1547.86,1131.4 1550.21,797.747 1552.56,964.855 1554.91,863.854 1557.26,807.957 1559.61,1006.62 1561.96,951.779 1564.31,976.337 1566.66,1082.01 1569.01,1057.45 1571.36,908.489 1573.71,942.987 1576.06,972.362 1578.41,1027.31 1580.76,1117.7 1583.11,918.483 1585.46,1107.25 1587.81,816.602 1590.17,867.877 1592.52,855.841 1594.87,940.149 1597.22,896.442 1599.57,832.345 1601.92,889.386 1604.27,1172.14 1606.62,1078.77 1608.97,742.821 1611.32,1149.87 1613.67,995.421 1616.02,899.373 1618.37,1013.17 1620.72,937.561 1623.07,1008.99 1625.42,1121.73 1627.77,963.235 1630.12,891.486 1632.47,930.402 1634.82,985.805 1637.17,1071.08 1639.53,777.159 1641.88,847.411 1644.23,940.503 1646.58,1018.48 1648.93,1013.12 1651.28,944.182 1653.63,893.658 1655.98,792.127 1658.33,846.545 1660.68,946.424 1663.03,936.012 1665.38,930.417 1667.73,990.996 1670.08,809.282 1672.43,778.808 1674.78,878.466 1677.13,912.696 1679.48,886.168 1681.83,870.91 1684.18,816.521 1686.53,957.979 1688.89,936.649 1691.24,807.1 1693.59,809.865 1695.94,811.411 1698.29,926.232 1700.64,857.803 1702.99,1039.79 1705.34,1149.82 1707.69,1102.42 1710.04,960.035 1712.39,973.33 1714.74,952.044 1717.09,978.216 1719.44,1122.45 1721.79,920.933 1724.14,936.215 1726.49,790.852 1728.84,883.825 1731.19,834.751 1733.54,981.046 1735.89,901.452 1738.25,806.848 1740.6,815.312 1742.95,580.324 1745.3,862.852 1747.65,1176.34 1750,882.131 1752.35,694.49 1754.7,629.911 1757.05,993.975 1759.4,851.886 1761.75,921.463 1764.1,920.081 1766.45,932.587 1768.8,840.286 1771.15,909.281 1773.5,988.826 1775.85,943.452 1778.2,969.262 1780.55,824.178 1782.9,986.001 1785.25,902.293 1787.6,997.645 1789.96,1088.81 1792.31,917.19 1794.66,1046.32 1797.01,988.718 1799.36,1078.91 1801.71,985.688 1804.06,954.032 1806.41,891.988 1808.76,896.729 1811.11,1069.32 1813.46,872.025 1815.81,890.359 1818.16,862.609 1820.51,867.509 1822.86,1124.66 1825.21,990.93 1827.56,768.465 1829.91,831.774 1832.26,1086.06 1834.61,793.61 1836.96,849.474 1839.32,1040.79 1841.67,908.705 1844.02,961.061 1846.37,997.257 1848.72,998.19 1851.07,995.998 1853.42,910.099 1855.77,951.425 1858.12,1106.66 1860.47,897.224 1862.82,1103.08 1865.17,983.4 1867.52,871.439 1869.87,1103.5 1872.22,961.318 1874.57,926.374 1876.92,871.233 1879.27,927.155 1881.62,870.654 1883.97,938.633 1886.32,1073.75 1888.68,907.065 1891.03,915.967 1893.38,934.494 1895.73,1180.78 1898.08,936.486 1900.43,963.812 1902.78,920.15 1905.13,918.408 1907.48,1037.83 1909.83,1006.61 1912.18,938.401 1914.53,897.964 1916.88,876.929 1919.23,995.516 1921.58,998.392 1923.93,780.413 1926.28,853.744 1928.63,982.299 1930.98,1026.57 1933.33,884.885 1935.68,908.241 1938.04,1102.24 1940.39,829.568 1942.74,945.759 1945.09,1099 1947.44,965.534 1949.79,831.69 1952.14,955.231 1954.49,1053.17 1956.84,1091.69 1959.19,1120.23 1961.54,946.678 1963.89,890.185 1966.24,938.882 1968.59,944.967 1970.94,699.346 1973.29,999.364 1975.64,928.391 1977.99,1011.57 1980.34,1048.6 1982.69,887.446 1985.04,1092.89 1987.4,1043.86 1989.75,851.873 1992.1,934.863 1994.45,966.99 1996.8,931.247 1999.15,1053.66 2001.5,1027.85 2003.85,965.792 2006.2,802.227 2008.55,832.674 2010.9,948.69 2013.25,911.296 2015.6,891.544 2017.95,953.628 2020.3,809.479 2022.65,840.429 2025,857.243 2027.35,777.954 2029.7,839.794 2032.05,863.279 2034.4,881.867 2036.76,853.01 2039.11,870.42 2041.46,1086.09 2043.81,936.895 2046.16,1030.73 2048.51,978.889 2050.86,741.566 2053.21,756.421 2055.56,856.164 2057.91,1036.85 2060.26,1073.16 2062.61,893.238 2064.96,806.502 2067.31,980.609 2069.66,924.339 2072.01,755.695 2074.36,1021.87 2076.71,805.806 2079.06,1020.52 2081.41,1090.35 2083.76,991.994 2086.11,928.358 2088.47,955.394 2090.82,964.653 2093.17,1229.43 2095.52,969.892 2097.87,786.615 2100.22,987.764 2102.57,965.171 2104.92,804.761 2107.27,914.619 2109.62,899.023 2111.97,843.584 2114.32,964.696 2116.67,1025.75 2119.02,873.876 2121.37,863.686 2123.72,879.424 2126.07,856.338 2128.42,1012.44 2130.77,1053.43 2133.12,1103 2135.47,848.885 2137.83,1061.08 2140.18,873.655 2142.53,904.247 2144.88,971.812 2147.23,1005.1 2149.58,1096.49 2151.93,944.58 2154.28,786.334 2156.63,906.393 2158.98,794.029 2161.33,976.395 2163.68,1001.57 2166.03,863.464 2168.38,944.524 2170.73,823.698 2173.08,819.938 2175.43,858.044 2177.78,1014.84 2180.13,956.079 2182.48,1058.46 2184.83,806.535 2187.19,1048.93 2189.54,970.53 2191.89,1020.69 2194.24,917.587 2196.59,930.615 2198.94,776.17 2201.29,865.77 2203.64,1099.92 2205.99,1036.39 2208.34,953.954 2210.69,890.528 2213.04,938.009 2215.39,973.572 2217.74,954.154 2220.09,1036.96 2222.44,841.42 2224.79,896.742 2227.14,779.353 2229.49,860.665 2231.84,829.695 2234.19,855.976 2236.55,998.041 2238.9,842.467 2241.25,939.011 2243.6,974.446 2245.95,1013.96 2248.3,936.555 2250.65,727.429 2253,885.277 2255.35,935.142 2257.7,1031.75 2260.05,1016.3 2262.4,1033.4 2264.75,849.128 2267.1,1023.31 2269.45,1030.69 2271.8,1012.03 2274.15,891.983 2276.5,850.548 2278.85,1046.46 2281.2,1022.83 2283.55,817.929 2285.91,875.031 2288.26,1080.35 2290.61,794.67 2292.96,1153.88 2295.31,987.058 2297.66,912.136 2300.01,1091.32 2302.36,1014.25 2304.71,898.802 2307.06,947.816 2309.41,872.717 2311.76,1043.75 2314.11,908.466 2316.46,995.512 2318.81,1172.35 2321.16,959.416 2323.51,1038.75 2325.86,933.039 2328.21,889.634 2330.56,958.456 2332.91,847.207 2335.27,945.625 2337.62,876.528 2339.97,838.821 2342.32,953.656 2344.67,1012.97 2347.02,840.724 2349.37,963.555 2351.72,820.705 2354.07,1042.9 2356.42,926.73 2358.77,881.14 2361.12,1035.4 2363.47,1003.56 2365.82,1028.54 2368.17,1004.89 2370.52,834.037 2372.87,894.85 2375.22,922.336 2377.57,902.042 2379.92,784.847 2382.27,918.574 2384.62,991.226 2386.98,1097.14 2389.33,745.813 2391.68,902.674 2394.03,935.539 2396.38,1004.03 2398.73,929.931 2401.08,909.391 2403.43,885.892 2405.78,897.7 2408.13,824.304 2410.48,885.579 2412.83,1012.05 2415.18,1171.24 2417.53,1124.21 2419.88,1063.45 2422.23,886.2 2424.58,902.758 2426.93,1027.84 2429.28,887.156 2431.63,1039.39 2433.98,916.779 2436.34,960.224 2438.69,1006.55 2441.04,853.476 2443.39,1176.96 2445.74,894.987 2448.09,912.612 2450.44,909.347 2452.79,969.555 2455.14,935.833 2457.49,889.982 2459.84,1243.22 2462.19,974.001 2464.54,1118.98 2466.89,1026.13 2469.24,929.855 2471.59,964.247 2473.94,928.095 2476.29,878.465 2478.64,1010.26 2480.99,1037.14 2483.34,1058.51 2485.7,979.046 2488.05,1145.9 2490.4,1079.05 2492.75,972.591 2495.1,755.03 2497.45,1051.09 2499.8,1001.8 2502.15,965.098 2504.5,720.447 2506.85,1059.89 2509.2,1142.6 2511.55,977.564 2513.9,1058.87 2516.25,773.445 2518.6,877.281 2520.95,1022.1 2523.3,734.595 2525.65,936.677 2528,1050.23 2530.35,937.035 2532.7,865.144 2535.06,880.668 2537.41,978.294 2539.76,947.363 2542.11,903.457 2544.46,999.431 2546.81,944.36 2549.16,730.732 2551.51,909.332 2553.86,1041.3 2556.21,1008.4 2558.56,1190.4 2560.91,984.622 2563.26,929.658 2565.61,768.883 2567.96,909.242 2570.31,950.934 "></polyline>
<polyline clip-path="url(#clip392)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,684.428 224.541,461.405 226.891,418.607 229.242,493.509 231.592,349.659 233.943,430.219 236.293,510.819 238.644,457.674 240.994,449.493 243.345,411.647 245.695,547.995 248.046,386.958 250.396,365.112 252.747,522.062 255.097,542.645 257.448,293.718 259.798,451.735 262.148,426.122 264.499,591.57 266.849,599.116 269.2,454.217 271.55,437.598 273.901,539.271 276.251,580.822 278.602,480.794 280.952,308.496 283.303,377.105 285.653,530.333 288.004,402.249 290.354,506.025 292.705,422.305 295.055,309.842 297.406,338.263 299.756,341.666 302.107,343.686 304.457,448.289 306.807,668.597 309.158,515.67 311.508,537.86 313.859,442.3 316.209,248.209 318.56,461.431 320.91,463.431 323.261,590.978 325.611,542.606 327.962,564.234 330.312,527.657 332.663,422.529 335.013,315.955 337.364,588.749 339.714,381.209 342.065,384.73 344.415,471.443 346.765,305.436 349.116,339.662 351.466,365.139 353.817,556.269 356.167,425.949 358.518,345.039 360.868,359.565 363.219,276.407 365.569,370.366 367.92,451.582 370.27,460.837 372.621,418.66 374.971,443.11 377.322,484.869 379.672,395.673 382.023,464.552 384.373,484.949 386.724,347.865 389.074,633.857 391.424,502.458 393.775,321.761 396.125,466.755 398.476,135.834 400.826,392.269 403.177,362.113 405.527,528.272 407.878,366.89 410.228,395.188 412.579,388.301 414.929,532.926 417.28,355.135 419.63,516.901 421.981,537.433 424.331,496.006 426.682,414.118 429.032,446.952 431.382,488.595 433.733,374.884 436.083,388.732 438.434,379.063 440.784,422.153 443.135,633.972 445.485,327.969 447.836,611.094 450.186,277.972 452.537,532.114 454.887,497.293 457.238,366.605 459.588,622.835 461.939,558.404 464.289,406.844 466.64,275.249 468.99,453.246 471.341,451.287 473.691,352.105 476.041,516.095 478.392,571.41 480.742,548.873 483.093,599.438 485.443,333.39 487.794,478.972 490.144,403.331 492.495,405.393 494.845,473.651 497.196,502.826 499.546,406.348 501.897,424.238 504.247,451.827 506.598,421.405 508.948,507.831 511.299,532.313 513.649,477.497 515.999,609.897 518.35,380.78 520.7,340.159 523.051,467.876 525.401,569.275 527.752,356.586 530.102,374.692 532.453,515.973 534.803,351.123 537.154,307.827 539.504,591.642 541.855,394.911 544.205,257.378 546.556,466.211 548.906,317.531 551.257,321.233 553.607,252.103 555.958,248.433 558.308,466.654 560.658,421.334 563.009,366.251 565.359,351.714 567.71,506.758 570.06,407.573 572.411,493.2 574.761,470.729 577.112,305.746 579.462,497.869 581.813,525.635 584.163,380.827 586.514,344.012 588.864,469.392 591.215,587.772 593.565,365.214 595.916,337.265 598.266,547.822 600.616,438.758 602.967,360.154 605.317,475.991 607.668,290.454 610.018,507.379 612.369,303.701 614.719,431.886 617.07,585.174 619.42,478.392 621.771,490.885 624.121,475.787 626.472,341.278 628.822,400.706 631.173,556.364 633.523,457.927 635.874,481.305 638.224,306.914 640.575,269.645 642.925,253.904 645.275,396.638 647.626,404.081 649.976,331.479 652.327,544.429 654.677,268.026 657.028,429.947 659.378,403.067 661.729,503.93 664.079,451.199 666.43,553.011 668.78,482.91 671.131,391.344 673.481,313.906 675.832,408.078 678.182,483.45 680.533,399.857 682.883,496.247 685.233,558.794 687.584,329.071 689.934,522.822 692.285,412.056 694.635,466.311 696.986,409.455 699.336,597.564 701.687,302.905 704.037,573.299 706.388,293.262 708.738,381.411 711.089,445.466 713.439,531.906 715.79,544.907 718.14,415.062 720.491,486.809 722.841,482.853 725.192,144.857 727.542,464.505 729.892,475.482 732.243,431.911 734.593,289.66 736.944,301.288 739.294,427.432 741.645,422.718 743.995,410.589 746.346,657.843 748.696,482.358 751.047,262.301 753.397,292.085 755.748,732.835 758.098,543.683 760.449,482.24 762.799,503.593 765.15,358.276 767.5,332.157 769.85,609.599 772.201,488.746 774.551,578.711 776.902,490.815 779.252,362.668 781.603,374.824 783.953,431.327 786.304,279.369 788.654,504.16 791.005,487.304 793.355,454.728 795.706,339.036 798.056,542.202 800.407,502.678 802.757,394.607 805.108,439.609 807.458,515.719 809.809,427.714 812.159,450.5 814.509,403.058 816.86,328.876 819.21,565.939 821.561,357.234 823.911,499.986 826.262,417.433 828.612,386.563 830.963,371.713 833.313,422.347 835.664,458.675 838.014,393.872 840.365,347.006 842.715,456.844 845.066,394.41 847.416,398.394 849.767,303.194 852.117,383.155 854.467,265.762 856.818,608.255 859.168,281.01 861.519,370.079 863.869,558.173 866.22,447.677 868.57,574.018 870.921,427.205 873.271,549.178 875.622,314.914 877.972,653.024 880.323,227.728 882.673,625.135 885.024,426.704 887.374,557.613 889.725,570.576 892.075,387.906 894.426,373.87 896.776,438.762 899.126,461.948 901.477,433.517 903.827,614.199 906.178,311.451 908.528,549.761 910.879,464.988 913.229,345.521 915.58,491.407 917.93,659.923 920.281,379.553 922.631,378.603 924.982,448.912 927.332,457.855 929.683,490.911 932.033,474.005 934.384,374.71 936.734,599.391 939.084,407.495 941.435,420.823 943.785,561.935 946.136,637.833 948.486,511.416 950.837,637.706 953.187,503.281 955.538,260.113 957.888,442.424 960.239,367.696 962.589,432.013 964.94,394.836 967.29,211.831 969.641,442.149 971.991,335.804 974.342,393.497 976.692,541.078 979.043,645.492 981.393,463.012 983.743,499.861 986.094,342.572 988.444,415.781 990.795,324.341 993.145,585.658 995.496,590.188 997.846,432.078 1000.2,484.565 1002.55,498.337 1004.9,298.928 1007.25,561.21 1009.6,509.891 1011.95,434.579 1014.3,502.865 1016.65,213.501 1019,457.571 1021.35,430.385 1023.7,350.375 1026.05,582.461 1028.4,517.637 1030.75,418.486 1033.1,516.156 1035.45,581.353 1037.8,407.753 1040.15,379.394 1042.51,432.75 1044.86,505.634 1047.21,424.171 1049.56,328.314 1051.91,476.671 1054.26,419.432 1056.61,278.023 1058.96,380.729 1061.31,533.648 1063.66,459.27 1066.01,435.834 1068.36,320.215 1070.71,399.464 1073.06,439.053 1075.41,654.356 1077.76,455.444 1080.11,485.38 1082.46,328.988 1084.81,501.993 1087.16,481.587 1089.51,728.363 1091.87,409.895 1094.22,513.583 1096.57,284.408 1098.92,293.884 1101.27,528.233 1103.62,507.667 1105.97,319.572 1108.32,542.261 1110.67,366.82 1113.02,376.001 1115.37,157.638 1117.72,433.427 1120.07,428.674 1122.42,567.191 1124.77,427.019 1127.12,378.133 1129.47,361.796 1131.82,496.19 1134.17,429.262 1136.52,619.189 1138.87,161.164 1141.23,251.709 1143.58,437.366 1145.93,529.167 1148.28,453.382 1150.63,441.524 1152.98,366.857 1155.33,307.053 1157.68,383.539 1160.03,495.144 1162.38,453.352 1164.73,377.175 1167.08,580.052 1169.43,451.25 1171.78,410.317 1174.13,444.795 1176.48,401.277 1178.83,432.736 1181.18,728.315 1183.53,391.317 1185.88,404.2 1188.23,309.707 1190.59,598.668 1192.94,426.395 1195.29,439.438 1197.64,565.257 1199.99,626.172 1202.34,408.903 1204.69,356.405 1207.04,491.45 1209.39,519.311 1211.74,456.498 1214.09,462.512 1216.44,326.57 1218.79,326.92 1221.14,425.354 1223.49,390.322 1225.84,440.447 1228.19,477.32 1230.54,517.126 1232.89,382.899 1235.24,460.203 1237.59,483.355 1239.94,497.943 1242.3,410.021 1244.65,339.021 1247,398.645 1249.35,381.317 1251.7,312.344 1254.05,321.411 1256.4,582.196 1258.75,681.961 1261.1,472.84 1263.45,322.733 1265.8,276.904 1268.15,457.188 1270.5,335.913 1272.85,421.616 1275.2,334.988 1277.55,414.605 1279.9,313.675 1282.25,455.141 1284.6,551.862 1286.95,206.116 1289.3,405.236 1291.66,329.858 1294.01,365.549 1296.36,159.192 1298.71,458.19 1301.06,384.552 1303.41,344.971 1305.76,495.748 1308.11,373.653 1310.46,443.443 1312.81,256.573 1315.16,534.413 1317.51,496.262 1319.86,482.99 1322.21,349.014 1324.56,429.956 1326.91,409.006 1329.26,416.407 1331.61,620.809 1333.96,315.522 1336.31,397.07 1338.66,298.252 1341.02,374.714 1343.37,500.002 1345.72,385.93 1348.07,312.411 1350.42,609.565 1352.77,401.728 1355.12,382.69 1357.47,507.151 1359.82,536.044 1362.17,404.847 1364.52,383.526 1366.87,352.131 1369.22,317.784 1371.57,627.663 1373.92,408.803 1376.27,317.634 1378.62,402.924 1380.97,469.738 1383.32,362.722 1385.67,350.38 1388.02,468.264 1390.38,387.785 1392.73,485.088 1395.08,649.545 1397.43,565.501 1399.78,395.393 1402.13,512.695 1404.48,562.295 1406.83,399.267 1409.18,610.264 1411.53,633.534 1413.88,473.844 1416.23,270.237 1418.58,286.906 1420.93,510.986 1423.28,525.091 1425.63,395.176 1427.98,509.561 1430.33,447.469 1432.68,331.363 1435.03,518.801 1437.38,572.574 1439.74,462.939 1442.09,310.649 1444.44,411.767 1446.79,360.963 1449.14,364.186 1451.49,504.217 1453.84,294.204 1456.19,687.726 1458.54,371.699 1460.89,461.184 1463.24,442.915 1465.59,178.523 1467.94,391.003 1470.29,441.227 1472.64,575.083 1474.99,533.579 1477.34,483.167 1479.69,514.53 1482.04,525.68 1484.39,530.7 1486.74,506.084 1489.1,283.472 1491.45,531.739 1493.8,301.176 1496.15,545.671 1498.5,427.428 1500.85,453.448 1503.2,481.98 1505.55,259.183 1507.9,424.923 1510.25,353.609 1512.6,234.944 1514.95,433.141 1517.3,302.243 1519.65,505.356 1522,442.496 1524.35,412.684 1526.7,484.384 1529.05,635.302 1531.4,353.815 1533.75,331.754 1536.1,465.206 1538.45,459.365 1540.81,295.805 1543.16,498.114 1545.51,585.436 1547.86,420.456 1550.21,444.325 1552.56,318.675 1554.91,536.356 1557.26,443.2 1559.61,384.405 1561.96,493.979 1564.31,387.806 1566.66,455.458 1569.01,488.66 1571.36,399.995 1573.71,329.017 1576.06,416.438 1578.41,417.639 1580.76,390.092 1583.11,276.118 1585.46,367.011 1587.81,545.066 1590.17,338.392 1592.52,656.609 1594.87,315.757 1597.22,425.495 1599.57,383.052 1601.92,461.113 1604.27,492.978 1606.62,246.524 1608.97,394.319 1611.32,362.064 1613.67,304.685 1616.02,406.172 1618.37,410.7 1620.72,435.324 1623.07,512.581 1625.42,548.519 1627.77,426.952 1630.12,547.495 1632.47,440.551 1634.82,468.011 1637.17,372.128 1639.53,513.327 1641.88,360.983 1644.23,436.029 1646.58,440.754 1648.93,534.711 1651.28,437.189 1653.63,344.016 1655.98,375.199 1658.33,475.124 1660.68,532.3 1663.03,432.01 1665.38,489.045 1667.73,353.565 1670.08,252.365 1672.43,501.473 1674.78,374.911 1677.13,403.261 1679.48,457.452 1681.83,423.636 1684.18,268.242 1686.53,429.288 1688.89,446.247 1691.24,372.55 1693.59,368.608 1695.94,507.509 1698.29,457.129 1700.64,292.448 1702.99,395.112 1705.34,608.649 1707.69,460.189 1710.04,389.177 1712.39,689.887 1714.74,439.672 1717.09,454.718 1719.44,413.209 1721.79,403.419 1724.14,502.789 1726.49,298.416 1728.84,535.797 1731.19,371.046 1733.54,314.054 1735.89,321.386 1738.25,407.283 1740.6,447.743 1742.95,674.53 1745.3,470.005 1747.65,324.448 1750,449.198 1752.35,356.662 1754.7,315.447 1757.05,361.158 1759.4,441.381 1761.75,381.553 1764.1,430.195 1766.45,561.67 1768.8,410.352 1771.15,514.753 1773.5,431.554 1775.85,424.839 1778.2,460.556 1780.55,508.423 1782.9,287.938 1785.25,488.433 1787.6,537.395 1789.96,544.064 1792.31,507.164 1794.66,156.186 1797.01,452.01 1799.36,499.382 1801.71,605.202 1804.06,574.643 1806.41,419.89 1808.76,391.981 1811.11,485.918 1813.46,435.278 1815.81,384.227 1818.16,288.635 1820.51,470.942 1822.86,459.496 1825.21,435.817 1827.56,271.491 1829.91,654.69 1832.26,467.834 1834.61,355.52 1836.96,576.363 1839.32,435.696 1841.67,483.19 1844.02,314.634 1846.37,486.736 1848.72,607.115 1851.07,506.173 1853.42,621.883 1855.77,599.742 1858.12,421.136 1860.47,342.456 1862.82,423.051 1865.17,424.616 1867.52,317.174 1869.87,639.407 1872.22,425.672 1874.57,371.95 1876.92,396.187 1879.27,398.571 1881.62,489.966 1883.97,553.424 1886.32,416.323 1888.68,518.777 1891.03,338.465 1893.38,365.396 1895.73,507.221 1898.08,404.844 1900.43,360.99 1902.78,484.453 1905.13,249.104 1907.48,431.39 1909.83,302.767 1912.18,405.513 1914.53,350.496 1916.88,453.951 1919.23,386.188 1921.58,157.775 1923.93,395.221 1926.28,646.442 1928.63,427.455 1930.98,514.673 1933.33,628.449 1935.68,459.493 1938.04,466.529 1940.39,363.299 1942.74,446.611 1945.09,585.628 1947.44,402.226 1949.79,411.495 1952.14,351.129 1954.49,530.795 1956.84,398.643 1959.19,433.898 1961.54,540.58 1963.89,295.396 1966.24,398.259 1968.59,489.127 1970.94,586.257 1973.29,311.541 1975.64,492.283 1977.99,445.569 1980.34,424.047 1982.69,293.683 1985.04,483.502 1987.4,444.511 1989.75,460.859 1992.1,479.781 1994.45,372.866 1996.8,352.23 1999.15,275.262 2001.5,327.833 2003.85,333.269 2006.2,560.779 2008.55,522.811 2010.9,381.876 2013.25,393.628 2015.6,213.981 2017.95,394.102 2020.3,438.255 2022.65,417.651 2025,358.682 2027.35,330.459 2029.7,480.744 2032.05,400.95 2034.4,447.655 2036.76,432.547 2039.11,409.597 2041.46,340.6 2043.81,436.969 2046.16,397.391 2048.51,468.143 2050.86,326.656 2053.21,334.3 2055.56,566.927 2057.91,501.28 2060.26,363.074 2062.61,448.336 2064.96,525.161 2067.31,648.461 2069.66,434.532 2072.01,326.488 2074.36,317.493 2076.71,399.147 2079.06,670.36 2081.41,548.704 2083.76,486.946 2086.11,512.802 2088.47,530.024 2090.82,601.274 2093.17,459.967 2095.52,446.575 2097.87,495.844 2100.22,515.004 2102.57,502.995 2104.92,590.853 2107.27,570.431 2109.62,420.523 2111.97,392.046 2114.32,485.334 2116.67,391.163 2119.02,477.8 2121.37,534.56 2123.72,336.689 2126.07,506.813 2128.42,526.215 2130.77,482.485 2133.12,359.875 2135.47,642.785 2137.83,504.811 2140.18,249.635 2142.53,445.539 2144.88,239.777 2147.23,336.307 2149.58,463.64 2151.93,448.898 2154.28,556.909 2156.63,331.212 2158.98,336.006 2161.33,600.557 2163.68,613.703 2166.03,612.576 2168.38,376.115 2170.73,498.44 2173.08,611.996 2175.43,464.433 2177.78,418.511 2180.13,394.695 2182.48,457.172 2184.83,606.932 2187.19,407.54 2189.54,409.147 2191.89,511.561 2194.24,431.863 2196.59,491.228 2198.94,441.42 2201.29,453.187 2203.64,354.509 2205.99,467.004 2208.34,233.501 2210.69,340.515 2213.04,525.209 2215.39,682.891 2217.74,652.372 2220.09,603.001 2222.44,427.897 2224.79,404.136 2227.14,528.655 2229.49,96.8724 2231.84,547.318 2234.19,514.239 2236.55,503.118 2238.9,437.583 2241.25,350.835 2243.6,379.324 2245.95,643.546 2248.3,243.677 2250.65,368.006 2253,337.89 2255.35,610.299 2257.7,400.188 2260.05,437.786 2262.4,430.709 2264.75,612.639 2267.1,277.781 2269.45,405.99 2271.8,363.464 2274.15,551.737 2276.5,541.99 2278.85,466.194 2281.2,557.185 2283.55,396.332 2285.91,610.949 2288.26,278.472 2290.61,226.139 2292.96,547.16 2295.31,483.453 2297.66,395.261 2300.01,469.139 2302.36,557.073 2304.71,377.044 2307.06,462.159 2309.41,370.457 2311.76,428.999 2314.11,483.807 2316.46,490.391 2318.81,588.713 2321.16,483.268 2323.51,528.051 2325.86,481.113 2328.21,322.705 2330.56,469.043 2332.91,581.321 2335.27,602.577 2337.62,577.428 2339.97,440.979 2342.32,496.061 2344.67,282.58 2347.02,240 2349.37,522.379 2351.72,586.678 2354.07,354.589 2356.42,444.025 2358.77,515.022 2361.12,400.253 2363.47,503.951 2365.82,535.944 2368.17,277.689 2370.52,551.554 2372.87,406.858 2375.22,533.109 2377.57,464.083 2379.92,366.28 2382.27,382.316 2384.62,227.023 2386.98,296.251 2389.33,461.357 2391.68,432.41 2394.03,429.696 2396.38,540.686 2398.73,373.913 2401.08,520.602 2403.43,198.614 2405.78,518.612 2408.13,213.741 2410.48,702.797 2412.83,566.467 2415.18,385.227 2417.53,441.186 2419.88,320.188 2422.23,259.422 2424.58,414.986 2426.93,394.743 2429.28,496.404 2431.63,378.421 2433.98,449.118 2436.34,358.128 2438.69,445.333 2441.04,351.082 2443.39,461.256 2445.74,353.732 2448.09,418.342 2450.44,490.173 2452.79,418.644 2455.14,434.77 2457.49,262.48 2459.84,462.355 2462.19,411.38 2464.54,391.87 2466.89,515.565 2469.24,310.069 2471.59,518.716 2473.94,549.552 2476.29,530.881 2478.64,267.031 2480.99,441.305 2483.34,476.952 2485.7,483.183 2488.05,342.885 2490.4,519.772 2492.75,332.671 2495.1,402.354 2497.45,492.482 2499.8,565.967 2502.15,250.042 2504.5,545.869 2506.85,358.976 2509.2,421.497 2511.55,355.096 2513.9,410.667 2516.25,393.174 2518.6,613.88 2520.95,313.799 2523.3,476.051 2525.65,586.372 2528,514.923 2530.35,286.458 2532.7,505.455 2535.06,384.287 2537.41,381.184 2539.76,520.882 2542.11,509.594 2544.46,479.105 2546.81,347.596 2549.16,382.557 2551.51,467.279 2553.86,418.286 2556.21,450.837 2558.56,459.697 2560.91,420.236 2563.26,495.621 2565.61,347.154 2567.96,511.43 2570.31,411.931 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -2.33029   -3.31953   -4.82283   …  -4.72569   -4.72569   -6.09369
  0.324508  -0.172457  -0.826462     -0.580982  -0.580982   0.787794
  2.31724    3.44265    3.06135       6.09397    6.09397    5.25619

[:, :, 2] =
 -3.57686   -5.11214   -4.39723    …  -3.90582  -5.76736    -6.77505
 -0.498302  -0.446026   0.0743065     -1.55472  -0.0955334  -0.762824
  3.29109    2.97839    3.64079        3.35983   4.17157     4.46865

[:, :, 3] =
 -2.02227   -3.94259   -2.36643    -4.56984  …  -2.91618  -5.78077  -5.18637
 -0.301776   0.541028  -0.0948241   1.34537      1.08742   2.49945   1.89437
  4.07304    3.52143    3.72786     4.7719       4.37487   5.20668   5.11504

[:, :, 4] =
 -1.87698  -3.61383  -4.13014  -4.66472  …  -4.01189  -4.01189  -5.77697
  2.10537   1.1964    1.78794   3.13453      0.61828   0.61828  -0.062726
  2.01641   3.03892   4.4662    5.82671      4.76625   4.76625   3.08776</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.99786    1.01775
 -0.0187901  1.00313
  5.00139    1.00844</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.69 seconds
Compute duration  = 2.69 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -4.9768    1.0036    0.0176   3238.1248   5580.1444    1.0004   ⋯
        x[2]    0.0013    0.9995    0.0174   3300.2784   5075.2249    1.0001   ⋯
        x[3]    4.9680    1.0034    0.0171   3456.9637   5644.3198    1.0003   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -6.9167   -5.6570   -4.9754   -4.2958   -3.0245
        x[2]   -1.9924   -0.6625    0.0034    0.6764    1.9680
        x[3]    3.0233    4.2916    4.9748    5.6380    6.9534</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.75 seconds
Compute duration  = 1.75 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.5024    0.1907    0.0029   4337.2071   5406.9358    1.0001   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1462    0.3583    0.5063    0.6468    0.8564</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.24 seconds
Compute duration  = 0.24 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.9372    0.0155    0.0004   1543.6625   1543.6625    1.0005   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.9369    0.9369    0.9369    0.9369    0.9369</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.77 seconds
Compute duration  = 2.77 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.0972    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x   -0.9256    0.0000    0.0000        NaN        NaN       NaN     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.0972    0.0972    0.0972    0.0972    0.0972
           x   -0.9256   -0.9256   -0.9256   -0.9256   -0.9256</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.57 seconds
Compute duration  = 0.57 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.1227    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x    0.9345    0.0000       NaN        NaN        NaN       NaN     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1227    0.1227    0.1227    0.1227    0.1227
           x    0.9345    0.9345    0.9345    0.9345    0.9345</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.19 seconds
Compute duration  = 3.19 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8673    0.5994    0.0425   163.4014   178.8913    1.0162     ⋯
           x    0.0766    1.2517    0.1241   138.3055    46.0032    1.0034     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1425    0.3584    0.7282    1.2023    2.2741
           x   -3.0070   -0.3610    0.0357    0.6732    3.1170</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../versions.html" class="pagination-link" aria-label="Versions">
        <span class="nav-page-text">Versions</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/TuringTutorials/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/TuringTutorials/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.52">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../versions.html" rel="next">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Library API</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">For Developers (Inference)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Documentation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Modelling Syntax and Interface</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-14-using-turing-quick-start/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quick Start</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-09-using-turing-advanced/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Usage</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Turing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">For Developers (PPL)</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">For Developers (Inference)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../versions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Versions</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../changelog.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Changelog</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/TuringTutorials/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/TuringTutorials/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">For Developers (Inference)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-30.11473838215673</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-30.11473838215673</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([-1.8575780545808604, -0.05991546362945591, -0.28469146307206167]), MALAState{Vector{Float64}}([-1.8575780545808604, -0.05991546362945591, -0.28469146307206167]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -5.59969  -4.61251  -6.81107   -4.50255   …  -5.33534    -4.90664  -6.50225
  2.09767   1.31853   0.936239   0.694021     -0.0624007  -1.84337   0.609157
  3.0528    4.65639   4.60635    3.87258       4.76393     5.67683   5.79095</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.02883     1.00286
  0.00955199  0.980287
  5.01256     0.983134</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip180">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip180)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip181">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip180)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip182">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip182)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip182)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip182)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip182)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip182)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip180)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip180)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip180)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip180)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip180)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip180)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip180)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip180)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip180)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip180)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip180)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip180)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip180)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip180)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip180)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip180)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip180)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip180)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip180)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip180)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip182)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1532.9 2640.76,1532.9 "></polyline>
<polyline clip-path="url(#clip182)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1226.3 2640.76,1226.3 "></polyline>
<polyline clip-path="url(#clip182)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,919.703 2640.76,919.703 "></polyline>
<polyline clip-path="url(#clip182)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,613.104 2640.76,613.104 "></polyline>
<polyline clip-path="url(#clip182)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,306.505 2640.76,306.505 "></polyline>
<polyline clip-path="url(#clip180)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip180)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1532.9 170.644,1532.9 "></polyline>
<polyline clip-path="url(#clip180)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1226.3 170.644,1226.3 "></polyline>
<polyline clip-path="url(#clip180)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,919.703 170.644,919.703 "></polyline>
<polyline clip-path="url(#clip180)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,613.104 170.644,613.104 "></polyline>
<polyline clip-path="url(#clip180)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,306.505 170.644,306.505 "></polyline>
<path clip-path="url(#clip180)" d="M49.5521 1533.35 L79.2279 1533.35 L79.2279 1537.29 L49.5521 1537.29 L49.5521 1533.35 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip180)" d="M99.8991 1531.04 Q96.7509 1531.04 94.8991 1533.19 Q93.0704 1535.34 93.0704 1539.09 Q93.0704 1542.82 94.8991 1545 Q96.7509 1547.15 99.8991 1547.15 Q103.047 1547.15 104.876 1545 Q106.728 1542.82 106.728 1539.09 Q106.728 1535.34 104.876 1533.19 Q103.047 1531.04 99.8991 1531.04 M109.181 1516.39 L109.181 1520.65 Q107.422 1519.81 105.617 1519.37 Q103.834 1518.93 102.075 1518.93 Q97.4454 1518.93 94.9917 1522.06 Q92.5612 1525.18 92.2139 1531.5 Q93.5797 1529.49 95.6398 1528.42 Q97.7 1527.33 100.177 1527.33 Q105.385 1527.33 108.394 1530.51 Q111.427 1533.65 111.427 1539.09 Q111.427 1544.42 108.279 1547.64 Q105.131 1550.85 99.8991 1550.85 Q93.9037 1550.85 90.7325 1546.27 Q87.5612 1541.66 87.5612 1532.94 Q87.5612 1524.74 91.45 1519.88 Q95.3389 1515 101.89 1515 Q103.649 1515 105.431 1515.34 Q107.237 1515.69 109.181 1516.39 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip180)" d="M50.3623 1226.75 L80.0381 1226.75 L80.0381 1230.69 L50.3623 1230.69 L50.3623 1226.75 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip180)" d="M104.297 1224.95 Q107.654 1225.67 109.529 1227.93 Q111.427 1230.2 111.427 1233.54 Q111.427 1238.65 107.908 1241.45 Q104.39 1244.25 97.9083 1244.25 Q95.7324 1244.25 93.4176 1243.81 Q91.126 1243.4 88.6723 1242.54 L88.6723 1238.03 Q90.6167 1239.16 92.9315 1239.74 Q95.2463 1240.32 97.7695 1240.32 Q102.168 1240.32 104.459 1238.58 Q106.774 1236.85 106.774 1233.54 Q106.774 1230.48 104.621 1228.77 Q102.492 1227.03 98.6722 1227.03 L94.6445 1227.03 L94.6445 1223.19 L98.8574 1223.19 Q102.306 1223.19 104.135 1221.82 Q105.964 1220.43 105.964 1217.84 Q105.964 1215.18 104.066 1213.77 Q102.191 1212.33 98.6722 1212.33 Q96.7509 1212.33 94.5519 1212.75 Q92.3528 1213.17 89.7139 1214.05 L89.7139 1209.88 Q92.376 1209.14 94.6908 1208.77 Q97.0287 1208.4 99.0889 1208.4 Q104.413 1208.4 107.515 1210.83 Q110.617 1213.24 110.617 1217.36 Q110.617 1220.23 108.973 1222.22 Q107.33 1224.18 104.297 1224.95 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip180)" d="M99.4824 905.502 Q95.8713 905.502 94.0426 909.067 Q92.2371 912.609 92.2371 919.738 Q92.2371 926.845 94.0426 930.409 Q95.8713 933.951 99.4824 933.951 Q103.117 933.951 104.922 930.409 Q106.751 926.845 106.751 919.738 Q106.751 912.609 104.922 909.067 Q103.117 905.502 99.4824 905.502 M99.4824 901.798 Q105.293 901.798 108.348 906.405 Q111.427 910.988 111.427 919.738 Q111.427 928.465 108.348 933.071 Q105.293 937.655 99.4824 937.655 Q93.6723 937.655 90.5936 933.071 Q87.538 928.465 87.538 919.738 Q87.538 910.988 90.5936 906.405 Q93.6723 901.798 99.4824 901.798 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip180)" d="M104.297 611.75 Q107.654 612.468 109.529 614.736 Q111.427 617.005 111.427 620.338 Q111.427 625.454 107.908 628.255 Q104.39 631.056 97.9083 631.056 Q95.7324 631.056 93.4176 630.616 Q91.126 630.199 88.6723 629.343 L88.6723 624.829 Q90.6167 625.963 92.9315 626.542 Q95.2463 627.12 97.7695 627.12 Q102.168 627.12 104.459 625.384 Q106.774 623.648 106.774 620.338 Q106.774 617.282 104.621 615.569 Q102.492 613.833 98.6722 613.833 L94.6445 613.833 L94.6445 609.991 L98.8574 609.991 Q102.306 609.991 104.135 608.625 Q105.964 607.236 105.964 604.644 Q105.964 601.982 104.066 600.57 Q102.191 599.134 98.6722 599.134 Q96.7509 599.134 94.5519 599.551 Q92.3528 599.968 89.7139 600.847 L89.7139 596.681 Q92.376 595.94 94.6908 595.57 Q97.0287 595.199 99.0889 595.199 Q104.413 595.199 107.515 597.63 Q110.617 600.037 110.617 604.158 Q110.617 607.028 108.973 609.019 Q107.33 610.986 104.297 611.75 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip180)" d="M99.8991 304.642 Q96.7509 304.642 94.8991 306.794 Q93.0704 308.947 93.0704 312.697 Q93.0704 316.424 94.8991 318.6 Q96.7509 320.753 99.8991 320.753 Q103.047 320.753 104.876 318.6 Q106.728 316.424 106.728 312.697 Q106.728 308.947 104.876 306.794 Q103.047 304.642 99.8991 304.642 M109.181 289.989 L109.181 294.248 Q107.422 293.415 105.617 292.975 Q103.834 292.535 102.075 292.535 Q97.4454 292.535 94.9917 295.66 Q92.5612 298.785 92.2139 305.104 Q93.5797 303.091 95.6398 302.026 Q97.7 300.938 100.177 300.938 Q105.385 300.938 108.394 304.109 Q111.427 307.257 111.427 312.697 Q111.427 318.021 108.279 321.239 Q105.131 324.456 99.8991 324.456 Q93.9037 324.456 90.7325 319.873 Q87.5612 315.266 87.5612 306.54 Q87.5612 298.345 91.45 293.484 Q95.3389 288.6 101.89 288.6 Q103.649 288.6 105.431 288.947 Q107.237 289.294 109.181 289.989 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip182)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1491.99 224.541,1299.61 226.891,1296.3 229.242,1677.48 231.592,1488.72 233.943,1379.91 236.293,1304.67 238.644,1338.19 240.994,1492.63 243.345,1352.36 245.695,1490.85 248.046,1410.8 250.396,1447.96 252.747,1356.63 255.097,1402.96 257.448,1304.43 259.798,1454.06 262.148,1346.07 264.499,1400.2 266.849,1594.48 269.2,1483.46 271.55,1366.25 273.901,1343.25 276.251,1447.29 278.602,1334.62 280.952,1509.73 283.303,1366.77 285.653,1538.73 288.004,1533.13 290.354,1370.75 292.705,1578.95 295.055,1441.92 297.406,1442.33 299.756,1479.04 302.107,1434 304.457,1331.47 306.807,1445.37 309.158,1352.24 311.508,1568.07 313.859,1542.85 316.209,1560.36 318.56,1271.22 320.91,1483.9 323.261,1480.7 325.611,1285.03 327.962,1441.19 330.312,1266.68 332.663,1418.52 335.013,1583.23 337.364,1472.62 339.714,1263.92 342.065,1607.88 344.415,1310.31 346.765,1451.22 349.116,1583.85 351.466,1289.8 353.817,1436.17 356.167,1195.1 358.518,1567.75 360.868,1250.21 363.219,1248.92 365.569,1693.52 367.92,1255.49 370.27,1385.16 372.621,1413.65 374.971,1661.23 377.322,1505.29 379.672,1274.23 382.023,1338.52 384.373,1532.66 386.724,1435.11 389.074,1460.52 391.424,1435.81 393.775,1477.27 396.125,1380.96 398.476,1413.34 400.826,1504.78 403.177,1539.87 405.527,1409.25 407.878,1420.96 410.228,1400.9 412.579,1258.82 414.929,1459.48 417.28,1456.24 419.63,1723.38 421.981,1478.45 424.331,1567.66 426.682,1409.66 429.032,1617.76 431.382,1401.48 433.733,1511.63 436.083,1408.36 438.434,1378.39 440.784,1391.46 443.135,1560.58 445.485,1487.08 447.836,1470.34 450.186,1263.12 452.537,1425.96 454.887,1487.99 457.238,1507.97 459.588,1425.18 461.939,1200.31 464.289,1377.48 466.64,1361.61 468.99,1458.58 471.341,1450.97 473.691,1462.24 476.041,1606.14 478.392,1444.11 480.742,1421.51 483.093,1477.33 485.443,1368.91 487.794,1265.43 490.144,1427.25 492.495,1426.05 494.845,1393.49 497.196,1398.88 499.546,1475.96 501.897,1463.04 504.247,1424.1 506.598,1350.83 508.948,1396.67 511.299,1417.62 513.649,1611.46 515.999,1312.7 518.35,1405.3 520.7,1268.81 523.051,1435.24 525.401,1482.37 527.752,1632.22 530.102,1408.83 532.453,1320.79 534.803,1430.99 537.154,1524.4 539.504,1550.73 541.855,1498.68 544.205,1363 546.556,1381.34 548.906,1404.06 551.257,1276.57 553.607,1449.17 555.958,1382.59 558.308,1275.06 560.658,1531.6 563.009,1539.14 565.359,1243.75 567.71,1507.64 570.06,1428.77 572.411,1351 574.761,1263.39 577.112,1576.52 579.462,1472.85 581.813,1476.42 584.163,1501.98 586.514,1390.4 588.864,1418.89 591.215,1390.38 593.565,1361.77 595.916,1336.74 598.266,1308.4 600.616,1429.95 602.967,1508.79 605.317,1512.62 607.668,1432.28 610.018,1335.45 612.369,1458.11 614.719,1576.78 617.07,1572.56 619.42,1541.44 621.771,1551.77 624.121,1402.15 626.472,1169.23 628.822,1484.45 631.173,1478.4 633.523,1551.96 635.874,1487.86 638.224,1535.53 640.575,1474.43 642.925,1450.78 645.275,1546.28 647.626,1501.12 649.976,1430.84 652.327,1319.12 654.677,1293.48 657.028,1509.38 659.378,1444.88 661.729,1399.14 664.079,1460.36 666.43,1470.77 668.78,1458.3 671.131,1338.45 673.481,1415.32 675.832,1370.99 678.182,1476.01 680.533,1422.89 682.883,1309.33 685.233,1488.02 687.584,1276.91 689.934,1504.04 692.285,1337.98 694.635,1413.79 696.986,1508.13 699.336,1460.6 701.687,1382.31 704.037,1554.66 706.388,1396.02 708.738,1285.09 711.089,1505.16 713.439,1580.46 715.79,1482.69 718.14,1406.51 720.491,1433.72 722.841,1389.88 725.192,1487.28 727.542,1425.16 729.892,1327.24 732.243,1369.7 734.593,1577.63 736.944,1426.22 739.294,1562.87 741.645,1349.15 743.995,1549.18 746.346,1476.16 748.696,1298.18 751.047,1486.67 753.397,1335.53 755.748,1485.31 758.098,1543.58 760.449,1437.36 762.799,1426.38 765.15,1321.26 767.5,1486.88 769.85,1304.2 772.201,1402.86 774.551,1373.73 776.902,1377.25 779.252,1601.35 781.603,1479.97 783.953,1599.2 786.304,1390.97 788.654,1610.15 791.005,1286.45 793.355,1462.71 795.706,1423.02 798.056,1295.89 800.407,1412.26 802.757,1351.43 805.108,1416.62 807.458,1367.93 809.809,1545.7 812.159,1237.22 814.509,1558.64 816.86,1356.92 819.21,1468.91 821.561,1381.37 823.911,1542.01 826.262,1515.41 828.612,1527.12 830.963,1536.69 833.313,1396.69 835.664,1297.99 838.014,1589.41 840.365,1466.32 842.715,1381.65 845.066,1433.47 847.416,1345.13 849.767,1575.38 852.117,1348.96 854.467,1309.94 856.818,1503.85 859.168,1596.85 861.519,1501.06 863.869,1447.81 866.22,1558.94 868.57,1391.85 870.921,1404.4 873.271,1640.62 875.622,1254.67 877.972,1363.24 880.323,1511.65 882.673,1567.07 885.024,1382.58 887.374,1383.85 889.725,1343.56 892.075,1621.78 894.426,1289.78 896.776,1470.07 899.126,1355.13 901.477,1439.99 903.827,1214.44 906.178,1249.85 908.528,1320.11 910.879,1625.68 913.229,1493.19 915.58,1446.78 917.93,1410.98 920.281,1359.49 922.631,1672.15 924.982,1404.44 927.332,1312.08 929.683,1362.87 932.033,1443.67 934.384,1563.78 936.734,1465 939.084,1479.6 941.435,1511.44 943.785,1578.29 946.136,1387.43 948.486,1435.16 950.837,1485.73 953.187,1530.23 955.538,1373.96 957.888,1413.97 960.239,1530.98 962.589,1519.92 964.94,1396.24 967.29,1556.2 969.641,1493.53 971.991,1467.14 974.342,1394.45 976.692,1453.87 979.043,1442.89 981.393,1325.89 983.743,1387.58 986.094,1500.29 988.444,1275.58 990.795,1419.34 993.145,1419.81 995.496,1377.17 997.846,1333.39 1000.2,1385.8 1002.55,1467.86 1004.9,1430.98 1007.25,1410.77 1009.6,1451.01 1011.95,1505.63 1014.3,1266.6 1016.65,1615.45 1019,1542.67 1021.35,1418.74 1023.7,1333.11 1026.05,1562.33 1028.4,1495.3 1030.75,1486.49 1033.1,1625.11 1035.45,1358.91 1037.8,1402.87 1040.15,1537.11 1042.51,1260.42 1044.86,1483.02 1047.21,1297.51 1049.56,1446.34 1051.91,1495.89 1054.26,1369.76 1056.61,1565.26 1058.96,1619.09 1061.31,1549.32 1063.66,1477.89 1066.01,1407.96 1068.36,1297.34 1070.71,1447.28 1073.06,1421.96 1075.41,1381.03 1077.76,1491.68 1080.11,1354.15 1082.46,1574.57 1084.81,1472.13 1087.16,1559.36 1089.51,1345.19 1091.87,1516.95 1094.22,1226.9 1096.57,1385.17 1098.92,1271.82 1101.27,1406.64 1103.62,1499.33 1105.97,1411.17 1108.32,1385.79 1110.67,1538.02 1113.02,1399.13 1115.37,1386.65 1117.72,1587.34 1120.07,1558.17 1122.42,1404.89 1124.77,1344.16 1127.12,1438.79 1129.47,1476.11 1131.82,1197.29 1134.17,1417.03 1136.52,1384.57 1138.87,1537.07 1141.23,1367.98 1143.58,1350.8 1145.93,1594.72 1148.28,1377.92 1150.63,1422.77 1152.98,1307.4 1155.33,1302.07 1157.68,1285.23 1160.03,1654.05 1162.38,1371.22 1164.73,1543.34 1167.08,1532.28 1169.43,1520.41 1171.78,1562.17 1174.13,1558.33 1176.48,1553.32 1178.83,1428.21 1181.18,1482.66 1183.53,1344.94 1185.88,1504.82 1188.23,1374.95 1190.59,1501.24 1192.94,1378.17 1195.29,1464.04 1197.64,1297.35 1199.99,1327.81 1202.34,1346.2 1204.69,1384.06 1207.04,1387.65 1209.39,1461.16 1211.74,1584.42 1214.09,1289.58 1216.44,1385.92 1218.79,1481.76 1221.14,1318.41 1223.49,1431.81 1225.84,1327.18 1228.19,1370.43 1230.54,1556.88 1232.89,1299.72 1235.24,1383.75 1237.59,1304.53 1239.94,1518.66 1242.3,1406.1 1244.65,1175.25 1247,1299.65 1249.35,1444.74 1251.7,1530.04 1254.05,1337.59 1256.4,1492.93 1258.75,1551.84 1261.1,1424.3 1263.45,1535.83 1265.8,1412.78 1268.15,1521.21 1270.5,1351.37 1272.85,1567.06 1275.2,1647.56 1277.55,1535.58 1279.9,1270.75 1282.25,1458.74 1284.6,1571.83 1286.95,1410.68 1289.3,1259.73 1291.66,1482.95 1294.01,1352.4 1296.36,1409.35 1298.71,1380.34 1301.06,1235.07 1303.41,1485.94 1305.76,1602.8 1308.11,1367.26 1310.46,1499.68 1312.81,1493.04 1315.16,1570.15 1317.51,1521.32 1319.86,1439.44 1322.21,1342.06 1324.56,1561.92 1326.91,1425.39 1329.26,1541.75 1331.61,1456.99 1333.96,1522.92 1336.31,1408.46 1338.66,1327.39 1341.02,1523.83 1343.37,1399.06 1345.72,1433.09 1348.07,1468.69 1350.42,1399.64 1352.77,1401.12 1355.12,1226.4 1357.47,1521.59 1359.82,1226.27 1362.17,1260.65 1364.52,1446.18 1366.87,1418.67 1369.22,1607.18 1371.57,1451.51 1373.92,1432.25 1376.27,1506.14 1378.62,1653.31 1380.97,1581.36 1383.32,1445.57 1385.67,1439.81 1388.02,1415.39 1390.38,1584.88 1392.73,1572.37 1395.08,1320.54 1397.43,1286.34 1399.78,1337.93 1402.13,1421.37 1404.48,1301.43 1406.83,1338.76 1409.18,1273.81 1411.53,1304.06 1413.88,1617.24 1416.23,1494.44 1418.58,1582.37 1420.93,1551.16 1423.28,1497.13 1425.63,1585.18 1427.98,1395.42 1430.33,1481.1 1432.68,1451.27 1435.03,1592.51 1437.38,1566.67 1439.74,1296.25 1442.09,1384.6 1444.44,1418.1 1446.79,1472.02 1449.14,1636.54 1451.49,1570.78 1453.84,1254.35 1456.19,1540.77 1458.54,1512.79 1460.89,1306.03 1463.24,1496.83 1465.59,1450.79 1467.94,1369.76 1470.29,1590.53 1472.64,1367.93 1474.99,1478.76 1477.34,1496.25 1479.69,1462.23 1482.04,1449.74 1484.39,1398.12 1486.74,1353.58 1489.1,1345.8 1491.45,1393.36 1493.8,1499.78 1496.15,1221.25 1498.5,1390.21 1500.85,1304.39 1503.2,1751.15 1505.55,1245.44 1507.9,1647.06 1510.25,1326.86 1512.6,1519.49 1514.95,1465.52 1517.3,1399.48 1519.65,1380.64 1522,1355.56 1524.35,1197.53 1526.7,1565.85 1529.05,1530.26 1531.4,1415.48 1533.75,1564.69 1536.1,1282.87 1538.45,1562.33 1540.81,1263.26 1543.16,1404.94 1545.51,1343.59 1547.86,1182.97 1550.21,1417.68 1552.56,1463.76 1554.91,1468.59 1557.26,1456.89 1559.61,1258.53 1561.96,1446.79 1564.31,1462.14 1566.66,1549.3 1569.01,1408.19 1571.36,1202.15 1573.71,1335.36 1576.06,1422.43 1578.41,1367.14 1580.76,1424.49 1583.11,1341.72 1585.46,1440.23 1587.81,1536.09 1590.17,1467.65 1592.52,1458.02 1594.87,1468.8 1597.22,1681.22 1599.57,1390.11 1601.92,1392.6 1604.27,1340.12 1606.62,1364.3 1608.97,1274.41 1611.32,1387.17 1613.67,1475.83 1616.02,1400.46 1618.37,1256.38 1620.72,1350.34 1623.07,1289.75 1625.42,1503.75 1627.77,1357.59 1630.12,1361.67 1632.47,1474.24 1634.82,1566.81 1637.17,1482.26 1639.53,1536.39 1641.88,1407.98 1644.23,1356.67 1646.58,1405.38 1648.93,1420.37 1651.28,1356.14 1653.63,1398.86 1655.98,1464.37 1658.33,1350.42 1660.68,1406.84 1663.03,1434.95 1665.38,1452.84 1667.73,1346.86 1670.08,1326.08 1672.43,1521.56 1674.78,1514.16 1677.13,1355.26 1679.48,1598.78 1681.83,1491.86 1684.18,1440.21 1686.53,1428.32 1688.89,1437.91 1691.24,1470.56 1693.59,1639.91 1695.94,1445.64 1698.29,1506.34 1700.64,1139.13 1702.99,1456.81 1705.34,1260.89 1707.69,1545.42 1710.04,1435.55 1712.39,1349.27 1714.74,1450.36 1717.09,1367.97 1719.44,1506.16 1721.79,1463.08 1724.14,1237.42 1726.49,1440.9 1728.84,1568.19 1731.19,1384.66 1733.54,1441.82 1735.89,1331.59 1738.25,1340.34 1740.6,1445.82 1742.95,1344.2 1745.3,1449.51 1747.65,1519.95 1750,1425.03 1752.35,1176.68 1754.7,1620.66 1757.05,1277.26 1759.4,1582.23 1761.75,1402.85 1764.1,1434.81 1766.45,1510.37 1768.8,1437.91 1771.15,1449.49 1773.5,1403.66 1775.85,1406.19 1778.2,1422.79 1780.55,1455.49 1782.9,1452.48 1785.25,1215.09 1787.6,1454.33 1789.96,1438.25 1792.31,1373.95 1794.66,1367.64 1797.01,1301.1 1799.36,1458.06 1801.71,1481.5 1804.06,1579.91 1806.41,1380.2 1808.76,1521.88 1811.11,1538.34 1813.46,1437.68 1815.81,1335.88 1818.16,1360.37 1820.51,1362.33 1822.86,1544.25 1825.21,1397.2 1827.56,1395.49 1829.91,1461.74 1832.26,1300.34 1834.61,1462.98 1836.96,1362.41 1839.32,1533.45 1841.67,1473.27 1844.02,1356.89 1846.37,1572.62 1848.72,1433.2 1851.07,1408.88 1853.42,1327.43 1855.77,1362.25 1858.12,1391.38 1860.47,1368.75 1862.82,1464.04 1865.17,1464.41 1867.52,1378.85 1869.87,1471.3 1872.22,1251.72 1874.57,1425.81 1876.92,1553.66 1879.27,1495.13 1881.62,1561.56 1883.97,1440.84 1886.32,1537.15 1888.68,1352.79 1891.03,1524.64 1893.38,1579.27 1895.73,1616.29 1898.08,1360.72 1900.43,1344.33 1902.78,1283.93 1905.13,1624.27 1907.48,1324.06 1909.83,1400.01 1912.18,1506.67 1914.53,1277.23 1916.88,1408.4 1919.23,1471.91 1921.58,1171.07 1923.93,1441.48 1926.28,1528.97 1928.63,1309.88 1930.98,1588.89 1933.33,1451.2 1935.68,1321.19 1938.04,1427.53 1940.39,1306.31 1942.74,1442.48 1945.09,1391.89 1947.44,1416.64 1949.79,1366.54 1952.14,1310.55 1954.49,1260.46 1956.84,1580.37 1959.19,1513.32 1961.54,1612.7 1963.89,1526.74 1966.24,1494.01 1968.59,1517.57 1970.94,1521.31 1973.29,1470.99 1975.64,1484.78 1977.99,1309.88 1980.34,1417.25 1982.69,1351.82 1985.04,1553.43 1987.4,1373.56 1989.75,1386.85 1992.1,1552.65 1994.45,1589.28 1996.8,1472.21 1999.15,1332.35 2001.5,1346.94 2003.85,1499.62 2006.2,1232.22 2008.55,1368.28 2010.9,1386.07 2013.25,1435.52 2015.6,1491.62 2017.95,1494.75 2020.3,1391.27 2022.65,1522.3 2025,1396.26 2027.35,1369.79 2029.7,1353.86 2032.05,1514.41 2034.4,1406.32 2036.76,1346.8 2039.11,1344.97 2041.46,1398.08 2043.81,1466.4 2046.16,1370.53 2048.51,1463.12 2050.86,1460 2053.21,1317.24 2055.56,1530.35 2057.91,1342.09 2060.26,1407.04 2062.61,1418.56 2064.96,1489.44 2067.31,1414.36 2069.66,1461.63 2072.01,1369.47 2074.36,1455.87 2076.71,1482.67 2079.06,1310.6 2081.41,1419.54 2083.76,1511.21 2086.11,1526.91 2088.47,1723.66 2090.82,1308.61 2093.17,1180.27 2095.52,1406.19 2097.87,1429.16 2100.22,1189.6 2102.57,1327.21 2104.92,1380.02 2107.27,1291.49 2109.62,1436.43 2111.97,1383.45 2114.32,1556.42 2116.67,1291.42 2119.02,1394.02 2121.37,1267.11 2123.72,1550.87 2126.07,1463.39 2128.42,1320.28 2130.77,1327.95 2133.12,1385.32 2135.47,1451.97 2137.83,1463.28 2140.18,1352.39 2142.53,1320.7 2144.88,1416.53 2147.23,1402.86 2149.58,1474.62 2151.93,1567.14 2154.28,1400.94 2156.63,1368.83 2158.98,1602.47 2161.33,1552.21 2163.68,1419.42 2166.03,1516.89 2168.38,1330.9 2170.73,1465.01 2173.08,1469.73 2175.43,1642.06 2177.78,1403.33 2180.13,1469.48 2182.48,1413.06 2184.83,1397.56 2187.19,1330.09 2189.54,1378.72 2191.89,1461.24 2194.24,1539.17 2196.59,1243.45 2198.94,1561.34 2201.29,1422.98 2203.64,1374.02 2205.99,1381.94 2208.34,1409.72 2210.69,1393.37 2213.04,1421.22 2215.39,1405.32 2217.74,1368.64 2220.09,1356.49 2222.44,1217.04 2224.79,1453.59 2227.14,1438.95 2229.49,1531.27 2231.84,1420.59 2234.19,1542.15 2236.55,1439.21 2238.9,1509.22 2241.25,1481.6 2243.6,1466.29 2245.95,1191.73 2248.3,1468.13 2250.65,1424.11 2253,1385.11 2255.35,1423.9 2257.7,1563.89 2260.05,1379.31 2262.4,1571.1 2264.75,1273.17 2267.1,1509.14 2269.45,1461.08 2271.8,1639.44 2274.15,1347.44 2276.5,1460 2278.85,1514.54 2281.2,1479.11 2283.55,1226.16 2285.91,1582.26 2288.26,1694.16 2290.61,1543.68 2292.96,1606.72 2295.31,1472.61 2297.66,1476.64 2300.01,1535.56 2302.36,1353.84 2304.71,1509.72 2307.06,1387.88 2309.41,1559.34 2311.76,1424.16 2314.11,1284.82 2316.46,1286.68 2318.81,1490.25 2321.16,1544.28 2323.51,1494.6 2325.86,1316.3 2328.21,1305.97 2330.56,1549.04 2332.91,1470.57 2335.27,1325.44 2337.62,1361.91 2339.97,1358.7 2342.32,1296.81 2344.67,1462.53 2347.02,1444.29 2349.37,1393.3 2351.72,1502.71 2354.07,1339.25 2356.42,1482.66 2358.77,1294.61 2361.12,1537.98 2363.47,1548.46 2365.82,1314.81 2368.17,1529.57 2370.52,1563.46 2372.87,1357.96 2375.22,1487.33 2377.57,1319.76 2379.92,1456.12 2382.27,1488.81 2384.62,1269.69 2386.98,1493.49 2389.33,1531.89 2391.68,1301.43 2394.03,1355.07 2396.38,1546.14 2398.73,1564.93 2401.08,1435.67 2403.43,1626.93 2405.78,1577.38 2408.13,1511.35 2410.48,1450.32 2412.83,1497.75 2415.18,1422.45 2417.53,1153.93 2419.88,1495.59 2422.23,1409.69 2424.58,1483.59 2426.93,1509.07 2429.28,1623.72 2431.63,1326.66 2433.98,1395.76 2436.34,1347.23 2438.69,1495.79 2441.04,1513.05 2443.39,1279.76 2445.74,1554.73 2448.09,1498.96 2450.44,1640.58 2452.79,1550.84 2455.14,1420.91 2457.49,1508.62 2459.84,1334.6 2462.19,1474.88 2464.54,1431.56 2466.89,1549.59 2469.24,1291.55 2471.59,1478.91 2473.94,1616.93 2476.29,1400.81 2478.64,1485.18 2480.99,1418.43 2483.34,1432.58 2485.7,1449.96 2488.05,1541.55 2490.4,1447.76 2492.75,1487.29 2495.1,1306.61 2497.45,1389.02 2499.8,1434.79 2502.15,1486.09 2504.5,1353.9 2506.85,1494.55 2509.2,1434.64 2511.55,1476.76 2513.9,1376.36 2516.25,1351.09 2518.6,1415.59 2520.95,1380.94 2523.3,1545.09 2525.65,1568.81 2528,1384.42 2530.35,1493.37 2532.7,1378.91 2535.06,1438.7 2537.41,1457.76 2539.76,1615.35 2542.11,1456.56 2544.46,1546.24 2546.81,1459.69 2549.16,1345.35 2551.51,1479.42 2553.86,1315.01 2556.21,1431.39 2558.56,1330.85 2560.91,1325.62 2563.26,1194.73 2565.61,1358.31 2567.96,1519.1 2570.31,1404.01 "></polyline>
<polyline clip-path="url(#clip182)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,705.322 224.541,984.229 226.891,839.343 229.242,786.877 231.592,784.68 233.943,965.373 236.293,896.717 238.644,819.997 240.994,938.488 243.345,1053.94 245.695,903.995 248.046,965.947 250.396,953.952 252.747,1130.17 255.097,650.726 257.448,863.573 259.798,988.176 262.148,1075.7 264.499,934.714 266.849,974.914 269.2,1006.98 271.55,971.433 273.901,933.155 276.251,820.726 278.602,940.723 280.952,957.288 283.303,849.854 285.653,1064.85 288.004,765.343 290.354,1035.04 292.705,895.514 295.055,874.725 297.406,850.406 299.756,941.884 302.107,855.469 304.457,1183.17 306.807,822.65 309.158,788.87 311.508,986.681 313.859,864.686 316.209,1000.24 318.56,821.419 320.91,936.207 323.261,907.905 325.611,992.773 327.962,842.792 330.312,824.357 332.663,826.042 335.013,1067.92 337.364,1073.31 339.714,826.01 342.065,848.358 344.415,1091.22 346.765,951.331 349.116,927.046 351.466,948.925 353.817,869.16 356.167,902.49 358.518,849.196 360.868,885.081 363.219,918.667 365.569,1039.16 367.92,857.152 370.27,920.395 372.621,887.443 374.971,1024.96 377.322,1027.45 379.672,1011.51 382.023,973.348 384.373,1040.14 386.724,917.19 389.074,904.427 391.424,863.301 393.775,926.746 396.125,894.643 398.476,835.884 400.826,841.653 403.177,891.521 405.527,847.294 407.878,926.548 410.228,851.164 412.579,1025.98 414.929,862.401 417.28,872.368 419.63,965.554 421.981,830.223 424.331,948.541 426.682,1100.24 429.032,1006.77 431.382,944.073 433.733,651.844 436.083,897.217 438.434,1013.45 440.784,808.727 443.135,770.103 445.485,880.618 447.836,926.743 450.186,1088.48 452.537,1121.62 454.887,1015.03 457.238,820.493 459.588,1033.2 461.939,831.375 464.289,889.374 466.64,925.351 468.99,998.601 471.341,861.477 473.691,913.589 476.041,988.519 478.392,891.753 480.742,1021.96 483.093,850.288 485.443,937.781 487.794,941.681 490.144,873.856 492.495,996.525 494.845,769.631 497.196,855.918 499.546,864.632 501.897,845.482 504.247,891.514 506.598,880.817 508.948,876.323 511.299,872.241 513.649,1012.8 515.999,894.377 518.35,853.413 520.7,986.453 523.051,916.975 525.401,790.959 527.752,960.978 530.102,819.055 532.453,1007.04 534.803,1096.96 537.154,1043.56 539.504,731.912 541.855,1007.44 544.205,937.799 546.556,956.971 548.906,1036.08 551.257,945.199 553.607,873.711 555.958,808.356 558.308,1038.37 560.658,839.814 563.009,1082.17 565.359,931.389 567.71,789.734 570.06,827.107 572.411,863.284 574.761,1043.3 577.112,855.343 579.462,873.845 581.813,939.872 584.163,995.219 586.514,863.814 588.864,920.325 591.215,768.727 593.565,811.208 595.916,1030.97 598.266,1015.23 600.616,876.241 602.967,860.633 605.317,857.278 607.668,693.419 610.018,769.914 612.369,741.16 614.719,995.863 617.07,797.154 619.42,1037.22 621.771,767.916 624.121,1120.98 626.472,925.152 628.822,893.891 631.173,871.307 633.523,838.545 635.874,1054.48 638.224,878.924 640.575,1009.65 642.925,881.728 645.275,730.397 647.626,942.188 649.976,771.48 652.327,855.149 654.677,910.37 657.028,849.322 659.378,742.868 661.729,834.695 664.079,952.307 666.43,908.892 668.78,999.999 671.131,701.563 673.481,1010.19 675.832,874.322 678.182,888.847 680.533,1024.64 682.883,959.311 685.233,1032.25 687.584,797.242 689.934,774.216 692.285,923.6 694.635,885.677 696.986,968.797 699.336,943.34 701.687,839.787 704.037,841.546 706.388,929.36 708.738,947.505 711.089,895.329 713.439,986.141 715.79,948.248 718.14,969.996 720.491,909.461 722.841,828.821 725.192,956.616 727.542,983.314 729.892,976.122 732.243,1052.67 734.593,802.543 736.944,913.532 739.294,871.565 741.645,1033.13 743.995,956.614 746.346,1114.33 748.696,847.826 751.047,1076.62 753.397,980.374 755.748,875.871 758.098,908.317 760.449,936.072 762.799,901.573 765.15,919.003 767.5,831.681 769.85,949.039 772.201,924.166 774.551,1021.76 776.902,813.056 779.252,1012.94 781.603,884.996 783.953,922.869 786.304,876.4 788.654,790.551 791.005,694.549 793.355,843.386 795.706,825.903 798.056,994.129 800.407,843.561 802.757,979.79 805.108,842.945 807.458,950.397 809.809,913.225 812.159,1060.01 814.509,925.424 816.86,1055.85 819.21,803.272 821.561,978.771 823.911,896.342 826.262,1190.23 828.612,1017.7 830.963,922.702 833.313,921.811 835.664,722.812 838.014,762.499 840.365,852.225 842.715,965.084 845.066,759.024 847.416,966.284 849.767,984.819 852.117,904.86 854.467,938.219 856.818,899.631 859.168,785.532 861.519,847.519 863.869,902.202 866.22,944.895 868.57,853.305 870.921,896.177 873.271,861.493 875.622,913.941 877.972,837.045 880.323,993.643 882.673,815.623 885.024,839.763 887.374,909.645 889.725,1316.09 892.075,1033.37 894.426,839.241 896.776,912.326 899.126,1186.18 901.477,976.304 903.827,1026.2 906.178,964.352 908.528,888.427 910.879,861.789 913.229,872.556 915.58,1050.21 917.93,841.448 920.281,1057.02 922.631,1053.46 924.982,1065.24 927.332,1062.12 929.683,1117.64 932.033,947.224 934.384,921.013 936.734,805.62 939.084,854.676 941.435,898.795 943.785,794.821 946.136,913.918 948.486,869.054 950.837,1018.35 953.187,982.315 955.538,923.128 957.888,1045.47 960.239,832.379 962.589,1018.18 964.94,1167.88 967.29,900.151 969.641,1139.94 971.991,794.351 974.342,734.046 976.692,845.995 979.043,887.145 981.393,1116.77 983.743,858.798 986.094,1148.7 988.444,1093.51 990.795,962.531 993.145,944.919 995.496,993.069 997.846,809.585 1000.2,798.855 1002.55,887.172 1004.9,1036.07 1007.25,962.675 1009.6,1013.88 1011.95,869.227 1014.3,831.329 1016.65,950.185 1019,924.366 1021.35,962.143 1023.7,1005.16 1026.05,814.386 1028.4,858.245 1030.75,963.518 1033.1,813.868 1035.45,985.901 1037.8,954.196 1040.15,905.445 1042.51,972.489 1044.86,969.225 1047.21,968.009 1049.56,935.087 1051.91,879.146 1054.26,864.806 1056.61,1063.56 1058.96,1048.55 1061.31,894.302 1063.66,1063.79 1066.01,856.83 1068.36,1128.34 1070.71,1035.57 1073.06,948.137 1075.41,891.949 1077.76,864.692 1080.11,981.182 1082.46,910.728 1084.81,1016.85 1087.16,945.516 1089.51,992.986 1091.87,948.602 1094.22,697.403 1096.57,800.027 1098.92,958.882 1101.27,1099.14 1103.62,860.756 1105.97,860.492 1108.32,940.808 1110.67,1063.62 1113.02,1072.86 1115.37,883.784 1117.72,1036.33 1120.07,925.617 1122.42,859.408 1124.77,775.542 1127.12,932.715 1129.47,735.441 1131.82,860.337 1134.17,958.62 1136.52,999.992 1138.87,774.865 1141.23,822.377 1143.58,1131.91 1145.93,795.047 1148.28,933.099 1150.63,914.675 1152.98,996.537 1155.33,983.199 1157.68,918.634 1160.03,889.303 1162.38,756.578 1164.73,857.881 1167.08,717.134 1169.43,968.201 1171.78,907.625 1174.13,871.571 1176.48,970.809 1178.83,1034.33 1181.18,685.607 1183.53,951.396 1185.88,1018.94 1188.23,811.049 1190.59,856.763 1192.94,857.043 1195.29,1243.41 1197.64,912.339 1199.99,960.512 1202.34,957.338 1204.69,1063.42 1207.04,881.997 1209.39,836.796 1211.74,868.297 1214.09,902.255 1216.44,1001.09 1218.79,991.656 1221.14,758.349 1223.49,878.336 1225.84,982.425 1228.19,927.989 1230.54,1054.35 1232.89,1043.11 1235.24,983.217 1237.59,803.981 1239.94,880.384 1242.3,845.15 1244.65,965.809 1247,784.659 1249.35,910.11 1251.7,938.181 1254.05,1044.55 1256.4,1064.44 1258.75,918.899 1261.1,941.768 1263.45,976.124 1265.8,889.899 1268.15,761.319 1270.5,760.554 1272.85,925.115 1275.2,687.942 1277.55,874.754 1279.9,877.338 1282.25,1020.55 1284.6,915.644 1286.95,988.969 1289.3,885.257 1291.66,1011.47 1294.01,865.193 1296.36,889.048 1298.71,840.18 1301.06,880.524 1303.41,968.174 1305.76,959.733 1308.11,806.547 1310.46,1023.76 1312.81,957.729 1315.16,889.443 1317.51,882.072 1319.86,542.852 1322.21,1093.92 1324.56,1005.08 1326.91,839.729 1329.26,806.651 1331.61,1021.68 1333.96,882.591 1336.31,953.719 1338.66,875.155 1341.02,982.701 1343.37,1148.26 1345.72,1054.37 1348.07,842.22 1350.42,977.968 1352.77,895.695 1355.12,742.893 1357.47,946.805 1359.82,980.002 1362.17,728.157 1364.52,828.843 1366.87,614.795 1369.22,959.469 1371.57,966.674 1373.92,888.314 1376.27,923.194 1378.62,817.211 1380.97,940.676 1383.32,838.873 1385.67,895.483 1388.02,804.658 1390.38,824.66 1392.73,997.584 1395.08,839.738 1397.43,858.509 1399.78,934.263 1402.13,695.29 1404.48,836.417 1406.83,963.861 1409.18,1036.76 1411.53,1046.95 1413.88,1021.47 1416.23,1106.19 1418.58,963.209 1420.93,816.767 1423.28,1076.94 1425.63,857.955 1427.98,940.117 1430.33,1091.43 1432.68,841.868 1435.03,948.655 1437.38,794.395 1439.74,1115.03 1442.09,947.316 1444.44,919.472 1446.79,895.474 1449.14,956.23 1451.49,859.089 1453.84,942.019 1456.19,1072.11 1458.54,791.584 1460.89,985.812 1463.24,937.782 1465.59,925.132 1467.94,883.01 1470.29,1010.84 1472.64,827.609 1474.99,774.846 1477.34,918.75 1479.69,913.759 1482.04,864.091 1484.39,777.554 1486.74,940.019 1489.1,914.554 1491.45,937.268 1493.8,933.408 1496.15,904.426 1498.5,983.878 1500.85,1140.85 1503.2,846.899 1505.55,1028.66 1507.9,745.535 1510.25,954.482 1512.6,903.222 1514.95,968.211 1517.3,1100.86 1519.65,954.074 1522,873.77 1524.35,987.094 1526.7,904.511 1529.05,853.897 1531.4,921.95 1533.75,852.542 1536.1,980.759 1538.45,879.66 1540.81,955.428 1543.16,882.023 1545.51,1106.31 1547.86,917.781 1550.21,778.108 1552.56,1037.34 1554.91,1035.53 1557.26,877.67 1559.61,830.25 1561.96,966.592 1564.31,829.086 1566.66,804.112 1569.01,952.236 1571.36,1051.11 1573.71,717.369 1576.06,880.489 1578.41,1046.69 1580.76,1070.08 1583.11,708.121 1585.46,1161.3 1587.81,962.314 1590.17,921.483 1592.52,1067.81 1594.87,891.256 1597.22,698.863 1599.57,900.664 1601.92,705.546 1604.27,757.867 1606.62,972.802 1608.97,919.474 1611.32,829.369 1613.67,1016.4 1616.02,865.302 1618.37,899.739 1620.72,905.415 1623.07,834.663 1625.42,809.464 1627.77,977.061 1630.12,972.979 1632.47,956.379 1634.82,994.228 1637.17,1007.93 1639.53,948.626 1641.88,996.036 1644.23,868.092 1646.58,1157.83 1648.93,952.201 1651.28,886.751 1653.63,946.383 1655.98,918.358 1658.33,905.908 1660.68,1170.15 1663.03,988.516 1665.38,896.03 1667.73,941.267 1670.08,905.613 1672.43,842.146 1674.78,903.082 1677.13,919.051 1679.48,1122.56 1681.83,739.961 1684.18,1090.82 1686.53,1024.1 1688.89,930.171 1691.24,936.309 1693.59,907.003 1695.94,981.906 1698.29,1006.32 1700.64,1091.92 1702.99,956.842 1705.34,1184.33 1707.69,938.472 1710.04,968.076 1712.39,1051.91 1714.74,823.643 1717.09,1072.86 1719.44,922.222 1721.79,1024.46 1724.14,988.261 1726.49,973.029 1728.84,824.633 1731.19,861.623 1733.54,992.337 1735.89,845.33 1738.25,926.237 1740.6,879.178 1742.95,906.656 1745.3,893.468 1747.65,856.155 1750,929.461 1752.35,933.467 1754.7,1063.3 1757.05,813.912 1759.4,841.424 1761.75,1094.89 1764.1,756.547 1766.45,1026.69 1768.8,751.304 1771.15,765.072 1773.5,812.058 1775.85,910.257 1778.2,917.351 1780.55,975.535 1782.9,914.374 1785.25,626.398 1787.6,954.638 1789.96,845.247 1792.31,1163.18 1794.66,967.223 1797.01,779.113 1799.36,1030.25 1801.71,992.061 1804.06,955.547 1806.41,845.098 1808.76,888.333 1811.11,903.539 1813.46,754.292 1815.81,815.469 1818.16,699.677 1820.51,827.546 1822.86,1004.42 1825.21,1030.56 1827.56,902.406 1829.91,969.351 1832.26,1007.17 1834.61,1004.96 1836.96,1052.98 1839.32,1171.96 1841.67,843.697 1844.02,887.698 1846.37,857.054 1848.72,951.786 1851.07,1041.59 1853.42,903.093 1855.77,898.252 1858.12,1052.93 1860.47,749.349 1862.82,1041.93 1865.17,888.248 1867.52,853.595 1869.87,1060.58 1872.22,993.266 1874.57,783.112 1876.92,1129.46 1879.27,837.089 1881.62,964.973 1883.97,877.88 1886.32,849.087 1888.68,997.349 1891.03,895.475 1893.38,915.694 1895.73,893.581 1898.08,729.104 1900.43,965.004 1902.78,667.366 1905.13,1112.75 1907.48,914.557 1909.83,900.647 1912.18,1002.29 1914.53,1041.33 1916.88,1088.32 1919.23,830.223 1921.58,999.167 1923.93,838.883 1926.28,819.185 1928.63,956.073 1930.98,920.074 1933.33,1008.12 1935.68,802.806 1938.04,779.761 1940.39,809.538 1942.74,1059.79 1945.09,1016.68 1947.44,1083.28 1949.79,1019.32 1952.14,972.69 1954.49,866.835 1956.84,1010.54 1959.19,842.75 1961.54,984.58 1963.89,872.362 1966.24,1032.08 1968.59,859.55 1970.94,958.483 1973.29,985.498 1975.64,892.915 1977.99,831.269 1980.34,854.243 1982.69,885.475 1985.04,750.595 1987.4,838.984 1989.75,1065.75 1992.1,777.698 1994.45,982.179 1996.8,805.144 1999.15,966.012 2001.5,762.036 2003.85,759.338 2006.2,840.352 2008.55,960.375 2010.9,822.454 2013.25,1022.69 2015.6,872.254 2017.95,847.168 2020.3,956.189 2022.65,923.356 2025,856.013 2027.35,999.202 2029.7,823.565 2032.05,836.991 2034.4,790.079 2036.76,1022.48 2039.11,886.049 2041.46,957.111 2043.81,953.76 2046.16,959.89 2048.51,753.023 2050.86,813.337 2053.21,995.93 2055.56,1018.68 2057.91,895.625 2060.26,682.388 2062.61,952.315 2064.96,924.256 2067.31,795.044 2069.66,884.924 2072.01,890.99 2074.36,853.321 2076.71,815.574 2079.06,864.446 2081.41,1081.52 2083.76,968.534 2086.11,975.065 2088.47,1003.5 2090.82,872.133 2093.17,854.665 2095.52,792.945 2097.87,824.183 2100.22,1018.29 2102.57,898.811 2104.92,886.674 2107.27,1079.33 2109.62,789.198 2111.97,912.782 2114.32,941.037 2116.67,1017.91 2119.02,912.995 2121.37,834.544 2123.72,957.651 2126.07,825.429 2128.42,947.677 2130.77,827.693 2133.12,1061.58 2135.47,938.893 2137.83,903.519 2140.18,1031.39 2142.53,1083.85 2144.88,976.972 2147.23,938.308 2149.58,916.838 2151.93,967.993 2154.28,934.553 2156.63,1134.86 2158.98,1095.37 2161.33,877.858 2163.68,924.549 2166.03,793.065 2168.38,953.923 2170.73,885.383 2173.08,790.862 2175.43,945.594 2177.78,821.396 2180.13,1157.53 2182.48,752.708 2184.83,895.805 2187.19,986.995 2189.54,1055.65 2191.89,931.331 2194.24,1039.55 2196.59,1014.06 2198.94,805.747 2201.29,809.952 2203.64,833.799 2205.99,887.674 2208.34,777.155 2210.69,785.854 2213.04,912.484 2215.39,755.048 2217.74,859.285 2220.09,951.165 2222.44,938.411 2224.79,917.786 2227.14,726.832 2229.49,1051.88 2231.84,843.193 2234.19,968.719 2236.55,1035.84 2238.9,1083.49 2241.25,977.439 2243.6,783.779 2245.95,813.847 2248.3,1071.2 2250.65,933.022 2253,794.68 2255.35,856.052 2257.7,925.731 2260.05,911.83 2262.4,982.058 2264.75,794.606 2267.1,1039.77 2269.45,1032.78 2271.8,778.592 2274.15,863.338 2276.5,905.013 2278.85,750.643 2281.2,938.437 2283.55,856.649 2285.91,882.104 2288.26,1089.71 2290.61,980.287 2292.96,954.669 2295.31,827.015 2297.66,735.138 2300.01,895.897 2302.36,866.348 2304.71,1008.83 2307.06,1172.91 2309.41,865.545 2311.76,786.133 2314.11,905.449 2316.46,848.551 2318.81,757.807 2321.16,987.204 2323.51,873.518 2325.86,967.563 2328.21,1000.47 2330.56,775.371 2332.91,974.2 2335.27,1125.01 2337.62,1068.72 2339.97,871.015 2342.32,1007.24 2344.67,938.665 2347.02,786.996 2349.37,877.596 2351.72,1017.18 2354.07,933.248 2356.42,743.217 2358.77,1037.97 2361.12,876.398 2363.47,958.481 2365.82,1067.98 2368.17,858.547 2370.52,796.256 2372.87,1007.82 2375.22,1100.42 2377.57,932.172 2379.92,959.883 2382.27,866.464 2384.62,1013.48 2386.98,1141.62 2389.33,837.657 2391.68,846.429 2394.03,849.739 2396.38,754.059 2398.73,971.258 2401.08,927.307 2403.43,862.335 2405.78,1057.36 2408.13,953.111 2410.48,775.943 2412.83,875.82 2415.18,996.232 2417.53,1018.59 2419.88,845.047 2422.23,947.241 2424.58,1067.75 2426.93,1103.73 2429.28,829.842 2431.63,887.154 2433.98,1083.07 2436.34,1022.7 2438.69,814.184 2441.04,925.865 2443.39,823.49 2445.74,1014.23 2448.09,843.793 2450.44,1019.03 2452.79,819.5 2455.14,869.57 2457.49,808.418 2459.84,813.481 2462.19,1006.33 2464.54,1060.24 2466.89,1081.56 2469.24,925.885 2471.59,1029.14 2473.94,838.549 2476.29,834.536 2478.64,1011.94 2480.99,942.523 2483.34,1109.81 2485.7,980.309 2488.05,934.997 2490.4,889.035 2492.75,895.301 2495.1,991.981 2497.45,1091.61 2499.8,847.599 2502.15,737.921 2504.5,896.978 2506.85,911.521 2509.2,875.489 2511.55,967.991 2513.9,922.083 2516.25,1000.62 2518.6,954.815 2520.95,706.593 2523.3,853.864 2525.65,894.234 2528,941.634 2530.35,989.375 2532.7,952.912 2535.06,988.85 2537.41,845.307 2539.76,927.723 2542.11,932.961 2544.46,890.948 2546.81,1119.11 2549.16,913.367 2551.51,1002.42 2553.86,776.31 2556.21,892.224 2558.56,686.244 2560.91,932.969 2563.26,935.89 2565.61,919.704 2567.96,903.276 2570.31,849.613 "></polyline>
<polyline clip-path="url(#clip182)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,607.708 224.541,518.375 226.891,458.644 229.242,384.575 231.592,357.748 233.943,521.515 236.293,446.333 238.644,483.586 240.994,356.809 243.345,461.362 245.695,213.067 248.046,676.31 250.396,273.978 252.747,456.102 255.097,500.739 257.448,474.826 259.798,455.065 262.148,416.133 264.499,251.615 266.849,448.564 269.2,475.965 271.55,290.91 273.901,302.569 276.251,406.657 278.602,415.712 280.952,143.318 283.303,535.258 285.653,356.507 288.004,523.461 290.354,285.71 292.705,361.465 295.055,550.89 297.406,540.861 299.756,480.245 302.107,598.086 304.457,355.183 306.807,462.409 309.158,491.039 311.508,453.614 313.859,458.244 316.209,237.845 318.56,440.144 320.91,321.568 323.261,336.768 325.611,431.302 327.962,612.917 330.312,344.738 332.663,284.112 335.013,359.994 337.364,556.712 339.714,281.147 342.065,359.502 344.415,366.852 346.765,479.955 349.116,332.652 351.466,308.465 353.817,497.533 356.167,404.354 358.518,331.571 360.868,305.832 363.219,462.154 365.569,393.095 367.92,232.641 370.27,266.59 372.621,411.377 374.971,410.582 377.322,456.155 379.672,534.162 382.023,314.827 384.373,378.686 386.724,304.04 389.074,304.049 391.424,528.48 393.775,350.307 396.125,483.401 398.476,423.349 400.826,283.405 403.177,399.853 405.527,258.21 407.878,411.854 410.228,460.713 412.579,439.358 414.929,630.716 417.28,451.96 419.63,287.519 421.981,367.461 424.331,392.7 426.682,367.856 429.032,327.517 431.382,472.3 433.733,430.184 436.083,522.703 438.434,311.571 440.784,506.59 443.135,421.517 445.485,505.835 447.836,370.878 450.186,425.002 452.537,229.639 454.887,532.537 457.238,349.034 459.588,347.17 461.939,380.597 464.289,240.343 466.64,458.545 468.99,481.686 471.341,448.429 473.691,529.051 476.041,449.439 478.392,362.846 480.742,275.612 483.093,469.566 485.443,471.78 487.794,324.503 490.144,280.574 492.495,602.621 494.845,283.095 497.196,414.569 499.546,609.506 501.897,460.104 504.247,312.439 506.598,485.824 508.948,583.279 511.299,440.366 513.649,275.943 515.999,503.915 518.35,502.137 520.7,456.884 523.051,444.918 525.401,340.703 527.752,407.587 530.102,413.348 532.453,177.414 534.803,375.24 537.154,462.497 539.504,473.658 541.855,367.227 544.205,395.778 546.556,265.813 548.906,317.666 551.257,399.569 553.607,425.824 555.958,392.233 558.308,455.761 560.658,383.926 563.009,425.394 565.359,504.163 567.71,352.977 570.06,465.686 572.411,463.581 574.761,331.662 577.112,549.528 579.462,327.535 581.813,516.942 584.163,641.769 586.514,502.13 588.864,622.552 591.215,348.121 593.565,497.515 595.916,286.711 598.266,430.29 600.616,319.464 602.967,433.569 605.317,347.436 607.668,481.22 610.018,463.632 612.369,552.951 614.719,397.976 617.07,501.28 619.42,420.819 621.771,375.218 624.121,293.125 626.472,347.59 628.822,349.554 631.173,431.845 633.523,326.332 635.874,411.155 638.224,386.73 640.575,375.402 642.925,493.53 645.275,447.436 647.626,526.966 649.976,367.759 652.327,547.324 654.677,381.39 657.028,379.149 659.378,556.213 661.729,381.557 664.079,313.761 666.43,567.928 668.78,237.169 671.131,324.995 673.481,475.3 675.832,400.45 678.182,375.134 680.533,370.663 682.883,354.396 685.233,353.778 687.584,384.581 689.934,340.838 692.285,336.51 694.635,339.242 696.986,609.167 699.336,441.024 701.687,594.048 704.037,540.158 706.388,432.936 708.738,333.073 711.089,409.153 713.439,532.256 715.79,269.625 718.14,337.834 720.491,338.597 722.841,572.122 725.192,478.127 727.542,369.273 729.892,379.598 732.243,383.283 734.593,374.332 736.944,396.646 739.294,427.003 741.645,513.295 743.995,387.983 746.346,378.363 748.696,453.241 751.047,366.905 753.397,528.385 755.748,339.225 758.098,441.37 760.449,383.13 762.799,396.11 765.15,565.57 767.5,328.033 769.85,341.892 772.201,481.421 774.551,409.782 776.902,287.688 779.252,458.108 781.603,376.757 783.953,501.646 786.304,386.084 788.654,483.778 791.005,331.228 793.355,389.992 795.706,364.952 798.056,470.427 800.407,270.653 802.757,356.464 805.108,252.726 807.458,709.61 809.809,560.536 812.159,395.222 814.509,264.339 816.86,413.458 819.21,565.798 821.561,335.588 823.911,460.35 826.262,456.355 828.612,224.346 830.963,396.054 833.313,414.236 835.664,551.604 838.014,398.968 840.365,345.935 842.715,307.136 845.066,314.57 847.416,468.211 849.767,461.765 852.117,363.543 854.467,435.957 856.818,469.534 859.168,150.693 861.519,424.859 863.869,438.168 866.22,423.515 868.57,509.427 870.921,350.877 873.271,367.768 875.622,617.234 877.972,143.444 880.323,495.036 882.673,394.514 885.024,574.91 887.374,412.018 889.725,367.938 892.075,335.204 894.426,291.287 896.776,314.704 899.126,533.146 901.477,443.869 903.827,540.505 906.178,571.577 908.528,492.053 910.879,382.395 913.229,351.347 915.58,351.232 917.93,208.641 920.281,390.687 922.631,483.963 924.982,450.674 927.332,225.455 929.683,468.975 932.033,507.216 934.384,454.667 936.734,499.016 939.084,425.345 941.435,301.223 943.785,534.719 946.136,445.271 948.486,375.93 950.837,346.792 953.187,695.292 955.538,422.214 957.888,296.845 960.239,265.481 962.589,444.806 964.94,490.322 967.29,402.021 969.641,440.391 971.991,236.132 974.342,399.754 976.692,522.502 979.043,349.572 981.393,422.038 983.743,545.959 986.094,464.073 988.444,541.772 990.795,432.553 993.145,414.411 995.496,350.334 997.846,126.522 1000.2,441.411 1002.55,387.509 1004.9,407.905 1007.25,405.648 1009.6,415.109 1011.95,380.865 1014.3,582.868 1016.65,506.896 1019,557.001 1021.35,568.577 1023.7,337.582 1026.05,409.76 1028.4,531.778 1030.75,182.751 1033.1,361.788 1035.45,460.153 1037.8,282.137 1040.15,292.884 1042.51,397.331 1044.86,276.81 1047.21,327.445 1049.56,429.988 1051.91,345.311 1054.26,592.689 1056.61,468.792 1058.96,363.321 1061.31,352.623 1063.66,373.202 1066.01,586.061 1068.36,478.734 1070.71,306.869 1073.06,463.637 1075.41,620.879 1077.76,551.559 1080.11,393.396 1082.46,485.601 1084.81,420.903 1087.16,441.224 1089.51,384.254 1091.87,552.744 1094.22,401.388 1096.57,331.473 1098.92,250.74 1101.27,410.019 1103.62,464.567 1105.97,314.792 1108.32,436.873 1110.67,174.025 1113.02,344.206 1115.37,478.342 1117.72,448.674 1120.07,296.089 1122.42,421.901 1124.77,327.531 1127.12,394.423 1129.47,310.37 1131.82,416.73 1134.17,246.39 1136.52,485.614 1138.87,423.039 1141.23,323.664 1143.58,383.504 1145.93,434.5 1148.28,274.462 1150.63,511.835 1152.98,324.954 1155.33,333.84 1157.68,310.929 1160.03,411.247 1162.38,455.855 1164.73,355.098 1167.08,497.473 1169.43,432.599 1171.78,179.62 1174.13,414.343 1176.48,371.756 1178.83,463.06 1181.18,408.02 1183.53,470.34 1185.88,364.109 1188.23,246.254 1190.59,400.278 1192.94,569.746 1195.29,451.652 1197.64,334.746 1199.99,316.003 1202.34,492.335 1204.69,667.787 1207.04,275.65 1209.39,424.11 1211.74,521.212 1214.09,611.515 1216.44,457.728 1218.79,349.99 1221.14,304.098 1223.49,509.625 1225.84,498.076 1228.19,463.311 1230.54,499.491 1232.89,339.035 1235.24,535.199 1237.59,571.827 1239.94,374.671 1242.3,414.35 1244.65,486.814 1247,408.024 1249.35,291.404 1251.7,291.982 1254.05,298.976 1256.4,332.808 1258.75,512.112 1261.1,262.738 1263.45,392.578 1265.8,358.666 1268.15,450.02 1270.5,463.845 1272.85,364.685 1275.2,514.724 1277.55,517.112 1279.9,287.173 1282.25,409.424 1284.6,397.858 1286.95,332.003 1289.3,456.585 1291.66,504.738 1294.01,360.545 1296.36,229.347 1298.71,454.749 1301.06,404.586 1303.41,583.368 1305.76,401.689 1308.11,308.797 1310.46,591.178 1312.81,215.526 1315.16,347.931 1317.51,410.354 1319.86,241.095 1322.21,354.256 1324.56,441.901 1326.91,404.542 1329.26,365.87 1331.61,373.675 1333.96,440.971 1336.31,532.201 1338.66,319.403 1341.02,537.597 1343.37,456.787 1345.72,369.203 1348.07,360.019 1350.42,327.945 1352.77,411.982 1355.12,221.953 1357.47,385.089 1359.82,222.393 1362.17,571.376 1364.52,408.462 1366.87,460.811 1369.22,295.502 1371.57,484.705 1373.92,524.145 1376.27,520.361 1378.62,490.824 1380.97,389.262 1383.32,300.91 1385.67,426.219 1388.02,545.796 1390.38,553.905 1392.73,570.833 1395.08,436.28 1397.43,404.626 1399.78,334.657 1402.13,513.435 1404.48,443.942 1406.83,275.459 1409.18,265.317 1411.53,260.42 1413.88,245.081 1416.23,472.154 1418.58,600.075 1420.93,314.785 1423.28,282.204 1425.63,459.566 1427.98,321.482 1430.33,366.478 1432.68,344.618 1435.03,323.314 1437.38,407.387 1439.74,444.761 1442.09,345.25 1444.44,464.166 1446.79,382.474 1449.14,500.175 1451.49,477.141 1453.84,448.663 1456.19,388.583 1458.54,446.185 1460.89,325.41 1463.24,319.538 1465.59,472.679 1467.94,420.894 1470.29,467.507 1472.64,449.171 1474.99,504.586 1477.34,434.907 1479.69,397.339 1482.04,207.75 1484.39,453.228 1486.74,429.277 1489.1,374.961 1491.45,409.339 1493.8,397.021 1496.15,332.331 1498.5,391.109 1500.85,325.519 1503.2,474.322 1505.55,315.262 1507.9,281.155 1510.25,289.093 1512.6,493.796 1514.95,427.318 1517.3,238.666 1519.65,293.015 1522,379.039 1524.35,392.366 1526.7,472.212 1529.05,191.351 1531.4,387.141 1533.75,421.706 1536.1,257.801 1538.45,351.677 1540.81,387.708 1543.16,233.865 1545.51,491.924 1547.86,481.11 1550.21,370.046 1552.56,335.419 1554.91,396.67 1557.26,480.093 1559.61,467.142 1561.96,507.362 1564.31,465.943 1566.66,238.334 1569.01,159.288 1571.36,306.783 1573.71,647.798 1576.06,314.087 1578.41,344.94 1580.76,399.137 1583.11,362.51 1585.46,523.394 1587.81,435.346 1590.17,242.392 1592.52,637.399 1594.87,407.622 1597.22,432.99 1599.57,522.707 1601.92,367.577 1604.27,376.249 1606.62,212.195 1608.97,228.17 1611.32,470.745 1613.67,375.561 1616.02,461.104 1618.37,375.236 1620.72,257.819 1623.07,501.671 1625.42,501.096 1627.77,695.346 1630.12,309.074 1632.47,512.684 1634.82,370.848 1637.17,404.592 1639.53,356.913 1641.88,497.752 1644.23,389.204 1646.58,466.164 1648.93,390.849 1651.28,346.054 1653.63,290.294 1655.98,297.644 1658.33,339.002 1660.68,478.191 1663.03,472.672 1665.38,467.957 1667.73,377.289 1670.08,641.458 1672.43,399.505 1674.78,366.404 1677.13,343.063 1679.48,296.755 1681.83,287.771 1684.18,465.484 1686.53,431.643 1688.89,514.377 1691.24,385.501 1693.59,431.639 1695.94,369.609 1698.29,255.139 1700.64,369.045 1702.99,517.059 1705.34,391.156 1707.69,394.87 1710.04,308.204 1712.39,369.427 1714.74,445.12 1717.09,408.663 1719.44,374.91 1721.79,504.623 1724.14,519.091 1726.49,402.748 1728.84,480.1 1731.19,423.217 1733.54,375.318 1735.89,173.42 1738.25,432.527 1740.6,330.801 1742.95,375.789 1745.3,498.207 1747.65,337.302 1750,296.928 1752.35,654.018 1754.7,318.697 1757.05,213.742 1759.4,237.883 1761.75,375.308 1764.1,391.152 1766.45,455.23 1768.8,397.171 1771.15,507.237 1773.5,310.362 1775.85,600.57 1778.2,441.369 1780.55,613.208 1782.9,602.402 1785.25,562.651 1787.6,474.851 1789.96,353.18 1792.31,440.039 1794.66,318.208 1797.01,412.55 1799.36,402.797 1801.71,512.819 1804.06,450.747 1806.41,410.917 1808.76,571.08 1811.11,135.711 1813.46,284.017 1815.81,391.47 1818.16,471.747 1820.51,278.476 1822.86,387.986 1825.21,301.862 1827.56,388.296 1829.91,548.409 1832.26,447.645 1834.61,348.668 1836.96,477.211 1839.32,498.246 1841.67,177.994 1844.02,610.104 1846.37,438.018 1848.72,432.896 1851.07,384.64 1853.42,428.154 1855.77,436.609 1858.12,411.234 1860.47,297.068 1862.82,344.372 1865.17,259.497 1867.52,291.671 1869.87,330.933 1872.22,608.148 1874.57,399.671 1876.92,314.709 1879.27,461.297 1881.62,418.107 1883.97,332.571 1886.32,177.519 1888.68,354.604 1891.03,376.955 1893.38,527.501 1895.73,268.313 1898.08,309.443 1900.43,261.824 1902.78,338.239 1905.13,268.753 1907.48,400.655 1909.83,370.09 1912.18,337.168 1914.53,346.536 1916.88,341.851 1919.23,434.888 1921.58,409.616 1923.93,484.25 1926.28,387.686 1928.63,203.072 1930.98,429.793 1933.33,455.05 1935.68,353.09 1938.04,227.517 1940.39,470.494 1942.74,344.304 1945.09,426.126 1947.44,344.999 1949.79,438.579 1952.14,470.501 1954.49,288.347 1956.84,310.584 1959.19,515.336 1961.54,333.961 1963.89,604.275 1966.24,492.155 1968.59,375.608 1970.94,535.553 1973.29,402.206 1975.64,294.683 1977.99,468.356 1980.34,433.136 1982.69,347.25 1985.04,247.801 1987.4,480.251 1989.75,322.895 1992.1,515.019 1994.45,238.492 1996.8,421.53 1999.15,321.835 2001.5,345.053 2003.85,273.456 2006.2,463.877 2008.55,387.671 2010.9,496.994 2013.25,453.381 2015.6,295.21 2017.95,439.963 2020.3,693.188 2022.65,352.905 2025,234.074 2027.35,309.207 2029.7,288.013 2032.05,556.638 2034.4,507.716 2036.76,552.207 2039.11,392.448 2041.46,403.848 2043.81,456.076 2046.16,496.298 2048.51,358.086 2050.86,511.27 2053.21,328.936 2055.56,449.495 2057.91,533.711 2060.26,257.677 2062.61,466.146 2064.96,338.878 2067.31,307.876 2069.66,329.722 2072.01,456.968 2074.36,353.612 2076.71,404.921 2079.06,363.705 2081.41,377.859 2083.76,608.107 2086.11,531.51 2088.47,397.825 2090.82,369.244 2093.17,417.167 2095.52,489.494 2097.87,374.706 2100.22,458.356 2102.57,344.527 2104.92,480.656 2107.27,383.12 2109.62,450.045 2111.97,254.235 2114.32,376.052 2116.67,413.012 2119.02,487.875 2121.37,560.855 2123.72,352.128 2126.07,385.403 2128.42,442.666 2130.77,261.092 2133.12,444.019 2135.47,600.176 2137.83,269.086 2140.18,481.413 2142.53,465.686 2144.88,361.025 2147.23,559.331 2149.58,347.343 2151.93,415.504 2154.28,237.023 2156.63,475.259 2158.98,622.015 2161.33,259.963 2163.68,365.432 2166.03,304.835 2168.38,438.571 2170.73,531.545 2173.08,302.052 2175.43,503.522 2177.78,389.267 2180.13,430.087 2182.48,487.275 2184.83,342.845 2187.19,190.785 2189.54,436.096 2191.89,344.101 2194.24,543.566 2196.59,170.259 2198.94,350.533 2201.29,498.023 2203.64,400.015 2205.99,393.374 2208.34,438.259 2210.69,537.541 2213.04,364.232 2215.39,349.286 2217.74,433.02 2220.09,502.604 2222.44,483.767 2224.79,464.267 2227.14,399.819 2229.49,410.589 2231.84,471.775 2234.19,514.499 2236.55,354.463 2238.9,553.315 2241.25,561.409 2243.6,265.814 2245.95,398.72 2248.3,542.402 2250.65,447.895 2253,467.307 2255.35,380.251 2257.7,395.361 2260.05,287.003 2262.4,625.451 2264.75,384.609 2267.1,462.62 2269.45,581.51 2271.8,505.951 2274.15,537.741 2276.5,421.518 2278.85,341.259 2281.2,308.388 2283.55,500.483 2285.91,311.534 2288.26,492.387 2290.61,366.304 2292.96,367.786 2295.31,383.483 2297.66,508.468 2300.01,413.171 2302.36,374.095 2304.71,311.643 2307.06,455.413 2309.41,436.869 2311.76,428.317 2314.11,427.062 2316.46,407.042 2318.81,513.362 2321.16,448.232 2323.51,245.436 2325.86,395.743 2328.21,502.01 2330.56,393.951 2332.91,446.773 2335.27,519.191 2337.62,405.523 2339.97,430.397 2342.32,417.165 2344.67,249.933 2347.02,367.909 2349.37,318.375 2351.72,361.883 2354.07,576.332 2356.42,376.149 2358.77,328.288 2361.12,287.034 2363.47,575.848 2365.82,397.139 2368.17,337.573 2370.52,262.107 2372.87,447.283 2375.22,268.692 2377.57,465.549 2379.92,337.727 2382.27,284.928 2384.62,394.887 2386.98,452.216 2389.33,245.914 2391.68,294.012 2394.03,394.98 2396.38,220.895 2398.73,416.332 2401.08,618.863 2403.43,522.561 2405.78,415.55 2408.13,636.318 2410.48,410.149 2412.83,475.688 2415.18,436.951 2417.53,468.95 2419.88,486.56 2422.23,416.36 2424.58,460.791 2426.93,288.512 2429.28,352.411 2431.63,360.144 2433.98,367.333 2436.34,440.639 2438.69,373.814 2441.04,504.002 2443.39,445.328 2445.74,252.317 2448.09,297.24 2450.44,478.095 2452.79,365.697 2455.14,523.66 2457.49,275.977 2459.84,437.656 2462.19,423.856 2464.54,498.43 2466.89,307.996 2469.24,339.985 2471.59,537.815 2473.94,390.726 2476.29,369.156 2478.64,319.052 2480.99,481.089 2483.34,417.317 2485.7,410.488 2488.05,96.8724 2490.4,480.7 2492.75,418.364 2495.1,483.029 2497.45,219.491 2499.8,451.096 2502.15,422.961 2504.5,369.717 2506.85,257.679 2509.2,407.923 2511.55,289.465 2513.9,428.429 2516.25,453.418 2518.6,394.571 2520.95,361.2 2523.3,346.135 2525.65,430.646 2528,348.854 2530.35,440.421 2532.7,375.809 2535.06,554.091 2537.41,357.706 2539.76,486.355 2542.11,351.187 2544.46,327.011 2546.81,654.489 2549.16,244.193 2551.51,394.082 2553.86,490.823 2556.21,290.128 2558.56,396.626 2560.91,392.429 2563.26,398.607 2565.61,409.068 2567.96,294.327 2570.31,306.363 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -0.776132  -2.92692   -4.35472   -6.22558   …  -6.3699   -5.20238  -4.98445
  0.661956  -0.611051   0.494897   0.611317     -1.10556  -2.31201  -1.63373
  3.40933    4.67937    5.19583    4.33925       4.7022    5.25825   5.67666

[:, :, 2] =
 -3.78419  -4.534    -5.97101   -4.07177   …  -2.17008  -3.75502  -3.77389
 -1.65165  -1.26824  -0.591863   0.357077     -2.65697  -2.15655  -2.01405
  3.59344   4.78498   2.98948    3.97004       4.97535   5.7443    5.32953

[:, :, 3] =
 -2.24412   -3.046    -5.36442  -4.6666    …  -5.28851  -5.28851  -5.84354
  0.839422   1.04381   1.1946   -0.218325      1.05153   1.05153   0.299278
  3.34554    3.41846   3.77044   4.60829       5.46843   5.46843   5.37556

[:, :, 4] =
 -2.96408  -5.35073     -5.47301  -5.47301  …  -6.03622  -3.70266  -3.8336
 -2.07876  -0.00231667   1.37687   1.37687      1.33082   2.2223    1.81725
  2.96709   4.28428      4.05985   4.05985      5.35179   3.09425   3.84189</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.03556    1.00284
 -0.0103804  0.994139
  4.98691    1.00173</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.54 seconds
Compute duration  = 2.54 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -5.0014    1.0071    0.0182   3077.0084   5555.2446    1.0003   ⋯
        x[2]    0.0315    1.0060    0.0184   2991.0455   4836.9107    0.9999   ⋯
        x[3]    5.0100    1.0056    0.0171   3457.0985   5463.2163    1.0016   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -6.9684   -5.6841   -4.9978   -4.3264   -3.0354
        x[2]   -1.9680   -0.6510    0.0272    0.7087    2.0076
        x[3]    3.0413    4.3239    5.0189    5.6747    6.9819</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.62 seconds
Compute duration  = 1.62 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.5008    0.1911    0.0030   3929.7734   5701.8711    1.0000   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1446    0.3596    0.5004    0.6390    0.8626</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.24 seconds
Compute duration  = 0.24 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

           x    0.4835    0.1563    0.0178    77.8557    23.7387    1.0255     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1984    0.3636    0.4859    0.6239    0.7242</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(-1.0361129180461053, "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with -1.0361129180461053:
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/ji8PW/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/E4kDs/src/compiler.jl:579 [inlined]
  [7] demo(__model__::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, __varinfo__::DynamicPPL.ThreadSafeVarInfo{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, Vector{Base.RefValue{Float64}}}, __context__::DynamicPPL.ValuesAsInModelContext{OrderedDict{Any, Any}, DynamicPPL.DefaultContext})
    @ Main.Notebook ~/work/turing-docs/turing-docs/tutorials/docs-17-implementing-samplers/index.qmd:592
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/E4kDs/src/model.jl:963 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, context::DynamicPPL.ValuesAsInModelContext{OrderedDict{Any, Any}, DynamicPPL.DefaultContext})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/E4kDs/src/model.jl:952
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/E4kDs/src/model.jl:887 [inlined]
 [11] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/E4kDs/src/values_as_in_model.jl:196 [inlined]
 [12] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/E4kDs/src/values_as_in_model.jl:195 [inlined]
 [13] getparams(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64})
    @ Turing.Inference ~/.julia/packages/Turing/aAIq7/src/mcmc/Inference.jl:328
 [14] Turing.Inference.Transition(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, t::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/aAIq7/src/mcmc/Inference.jl:224
 [15] transition_to_turing
    @ ~/.julia/packages/Turing/aAIq7/src/mcmc/abstractmcmc.jl:12 [inlined]
 [16] transition_to_turing(f::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, transition::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/aAIq7/src/mcmc/abstractmcmc.jl:17
 [17] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}; initial_state::Nothing, initial_params::Nothing, kwargs::@Kwargs{})
    @ Turing.Inference ~/.julia/packages/Turing/aAIq7/src/mcmc/abstractmcmc.jl:76
 [18] step
    @ ~/.julia/packages/Turing/aAIq7/src/mcmc/abstractmcmc.jl:36 [inlined]
 [19] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:130 [inlined]
 [20] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/logging.jl:16 [inlined]
 [21] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:120
 [22] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/E4kDs/src/sampler.jl:93
 [23] sample
    @ ~/.julia/packages/DynamicPPL/E4kDs/src/sampler.jl:83 [inlined]
 [24] #sample#4
    @ ~/.julia/packages/Turing/aAIq7/src/mcmc/Inference.jl:263 [inlined]
 [25] sample
    @ ~/.julia/packages/Turing/aAIq7/src/mcmc/Inference.jl:256 [inlined]
 [26] #sample#3
    @ ~/.julia/packages/Turing/aAIq7/src/mcmc/Inference.jl:253 [inlined]
 [27] top-level scope
    @ ~/work/turing-docs/turing-docs/tutorials/docs-17-implementing-samplers/index.qmd:594</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.59 seconds
Compute duration  = 1.59 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8494    0.5618    0.0253   263.9477    99.5831    1.0008     ⋯
           x   -0.0057    0.9727    0.0452   596.8733   396.7863    1.0004     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.0794    0.4051    0.7439    1.1819    2.1892
           x   -2.1345   -0.3933   -0.0001    0.4088    2.0805</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.83 seconds
Compute duration  = 2.83 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8673    0.5427    0.0213   456.9516   207.9832    0.9999     ⋯
           x    0.0415    0.9783    0.0505   479.6075   270.8203    1.0098     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1370    0.4252    0.7619    1.1831    2.1605
           x   -2.0929   -0.4064    0.0023    0.4622    2.2905</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../versions.html" class="pagination-link" aria-label="Versions">
        <span class="nav-page-text">Versions</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/TuringTutorials/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/TuringTutorials/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>